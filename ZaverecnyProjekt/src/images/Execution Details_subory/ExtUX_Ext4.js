/*
 * This code is for Internal Salesforce use only, and subject to change without notice.
 * Customers shouldn't reference this file in any web pages.
 */
Ext.define("Ext.tab.TabCloseMenu",{alias:"plugin.tabclosemenu",alternateClassName:"Ext.ux.TabCloseMenu",mixins:{observable:"Ext.util.Observable"},closeTabText:"Close Tab",showCloseOthers:!0,closeOthersTabsText:"Close Other Tabs",showCloseAll:!0,closeAllTabsText:"Close All Tabs",extraItemsHead:null,extraItemsTail:null,constructor:function(b){this.addEvents("aftermenu","beforemenu");this.mixins.observable.constructor.call(this,b)},init:function(b){this.tabPanel=b;this.tabBar=b.down("tabbar");this.mon(this.tabPanel,
{scope:this,afterlayout:this.onAfterLayout,single:!0})},onAfterLayout:function(){this.mon(this.tabBar.el,{scope:this,contextmenu:this.onContextMenu,delegate:"div.x-tab"})},onBeforeDestroy:function(){Ext.destroy(this.menu);this.callParent(arguments)},onContextMenu:function(b,d){var a=this,c=a.createMenu(),f=!0,g=!0,e=a.tabBar.getChildByElement(d),e=a.tabBar.items.indexOf(e);a.item=a.tabPanel.getComponent(e);c.child('*[text\x3d"'+a.closeTabText+'"]').setDisabled(!a.item.closable);if(a.showCloseAll||
a.showCloseOthers)a.tabPanel.items.each(function(b){return b.closable&&(f=!1,b!=a.item)?g=!1:!0}),a.showCloseAll&&c.child('*[text\x3d"'+a.closeAllTabsText+'"]').setDisabled(f),a.showCloseOthers&&c.child('*[text\x3d"'+a.closeOthersTabsText+'"]').setDisabled(g);b.preventDefault();a.fireEvent("beforemenu",c,a.item,a);c.showAt(b.getXY())},createMenu:function(){if(!this.menu){var b=[{text:this.closeTabText,scope:this,handler:this.onClose}];(this.showCloseAll||this.showCloseOthers)&&b.push("-");this.showCloseOthers&&
b.push({text:this.closeOthersTabsText,scope:this,handler:this.onCloseOthers});this.showCloseAll&&b.push({text:this.closeAllTabsText,scope:this,handler:this.onCloseAll});this.extraItemsHead&&(b=this.extraItemsHead.concat(b));this.extraItemsTail&&(b=b.concat(this.extraItemsTail));this.menu=Ext.create("Ext.menu.Menu",{items:b,listeners:{hide:this.onHideMenu,scope:this}})}return this.menu},onHideMenu:function(){this.item=null;this.fireEvent("aftermenu",this.menu,this)},onClose:function(){this.tabPanel.remove(this.item)},
onCloseOthers:function(){this.doClose(!0)},onCloseAll:function(){this.doClose(!1)},doClose:function(b){var d=[];this.tabPanel.items.each(function(a){a.closable&&(!b||a!=this.item)&&d.push(a)},this);Ext.each(d,function(a){this.tabPanel.remove(a)},this)}});
Ext.require("Ext.form.TextArea");
Ext.define("Ext.ux.form.CodeMirror",{extend:"Ext.form.TextArea",alias:"widget.ux-codemirror",language:"txt",codeMirrorHidden:!1,codeEditor:null,initialized:!1,constructor:function(a){this.addEvents({addBreakpoint:!0,removeBreakpoint:!0,initialized:!0});this.listeners=a.listeners;Ext.ux.form.CodeMirror.superclass.constructor.call(this,a)},lastScrollPosition:0,initComponent:function(){Ext.ux.form.CodeMirror.superclass.initComponent.apply(this,arguments);this.BREAKPOINT="DevConsole-gutter-breakpoint";
this.ERROR="DevConsole-gutter-error";this.FOLD="CodeMirror-foldgutter";this.on({resize:function(a,b,c){this.codeEditor&&(this.codeEditor.setSize(b,c),this.codeEditor.refresh())},afterrender:function(){if(!this.codeEditor){var a=this.container.dom.firstChild;a.value="";var b={lineNumbers:!0,mode:this.mode?this.mode:"text/apex",gutters:[this.ERROR,this.BREAKPOINT,"CodeMirror-linenumbers","CodeMirror-foldgutter"],editor:this,loaded:!1,theme:SfdcDevConsole.Themes.getTheme(),indentUnit:4},c=this.getAddons?
this.getAddons():this.editor.getAddons();Sfdc.apply(b,c,!0);this.codeEditor=new CodeMirror.fromTextArea(a,b);this.initialized=!0;this.fireEvent("initialized",this)}if(this.hasBreakpoints)this.codeEditor.on("gutterClick",function(a,b,c,d){c!==this.FOLD&&this.toggleBreakpoint(b+1)}.bind(this))},show:function(){this.initialized&&(0!==this.lastScrollPosition&&(this.codeEditor.getScrollerElement().scrollTop=this.lastScrollPosition),Ext.defer(this.focus,50,this))},beforehide:function(){this.initialized&&
(this.lastScrollPosition=this.codeEditor.getScrollerElement().scrollTop)}})},focus:function(){this.initialized&&this.codeEditor.focus()},scrollToLine:function(a){if(this.initialized){var b=document.createElement("div");this.codeEditor.addWidget({line:a,ch:0},b,!0);b.parentElement.removeChild(b)}},getValue:function(){return this.initialized?this.codeEditor.getValue():this.value},getSelection:function(){return this.initialized?this.codeEditor.getSelection():""},setValue:function(a){this.initialized&&
this.codeEditor.setValue(a)},clearHistory:function(){this.initialized&&this.codeEditor.clearHistory()},setMarkerText:function(a,b,c){return this.initialized&&0<a&&a<=this.codeEditor.lineCount()?this.codeEditor.setGutterMarker(a-1,b,c):null},getLine:function(a){return(a=this.codeEditor.lineInfo(a))?a.line+1:-1},getLineInfo:function(a){return this.codeEditor.lineInfo(a-1)},isError:function(a){return(a=Sfdc.isNumber(a)?this.getLineInfo(a):a)&&a.gutterMarkers&&a.gutterMarkers.hasOwnProperty(this.ERROR)},
hasErrors:function(){return!!this.errors},setError:function(a){this.errors=!0;var b=document.createTextNode("!");return this.setMarkerText(a,this.ERROR,b)},clearErrors:function(){this.errors=!1;this.initialized&&this.codeEditor.clearGutter(this.ERROR)},isBreakpoint:function(a){return(a=Sfdc.isNumber(a)?this.getLineInfo(a):a)&&a.gutterMarkers&&a.gutterMarkers.hasOwnProperty(this.BREAKPOINT)},toggleBreakpoint:function(a){var b=this.getLineInfo(a);this.isBreakpoint(b)?(this.fireEvent("removeBreakpoint",
this,a,b),this.setBreakpointMarker(a,!1)):!1!==this.fireEvent("addBreakpoint",this,a,b.handle)&&this.setBreakpointMarker(a,!0)},setBreakpointMarker:function(a,b){if(b){var c=document.createTextNode("\u25cf");return this.setMarkerText(a,this.BREAKPOINT,c)}return this.setMarkerText(a,this.BREAKPOINT,null)},setLineClass:function(a,b){return this.initialized?Sfdc.isDefAndNotNull(b)?this.codeEditor.addLineClass(a,"text",b):this.codeEditor.removeLineClass(a,"text"):null},highlights:null,highlightLine:function(a,
b){this.highlights||(this.highlights=[]);var c=null;"number"===typeof a?(c=a-1,this.setLineClass(c,null),c=this.setLineClass(c,b)):(this.setLineClass(a,null),c=this.setLineClass(a,b));null!==c&&(this.highlights||(this.highlights=[]),this.highlights.push(c));return c},clearHighlights:function(){if(this.initialized&&this.highlights)for(;0<this.highlights.length;){var a=this.highlights.pop();(a=this.codeEditor.lineInfo(a))&&this.setLineClass(a.line,null)}},select:function(a,b){this.initialized&&this.codeEditor.setSelection(a,
b)},setMarker:function(a,b,c){return this.codeEditor.markText({line:a.line-1,ch:a.column-1},{line:b.line-1,ch:b.column-1},c)}});
Ext.define("Sch.util.Patch",{target:null,minVersion:null,maxVersion:null,reportUrl:null,description:null,applyFn:null,ieOnly:!1,onClassExtended:function(a,b){if(!Sch.disableOverrides&&(!b.ieOnly||Ext.isIE))b.applyFn?b.applyFn():(!b.minVersion||Ext.versions.extjs.equals(b.minVersion)||Ext.versions.extjs.isGreaterThan(b.minVersion))&&(!b.maxVersion||Ext.versions.extjs.equals(b.maxVersion)||Ext.versions.extjs.isLessThan(b.maxVersion))&&b.requires[0].override(b.overrides)}});
Ext.define("Sch.patches.LoadMask",{extend:"Sch.util.Patch",requires:["Ext.view.AbstractView"],minVersion:"4.1.0b3",reportURL:"http://www.sencha.com/forum/showthread.php?187700-4.1.0-B3-Ext.AbstractView-no-longer-binds-its-store-to-load-mask",description:"In Ext4.1 loadmask no longer bind the store",overrides:{}});
Ext.define("Sch.patches.TreeView",{extend:"Sch.util.Patch",requires:["Ext.tree.View"],applyFn:function(){Ext.tree.View.addMembers({providedStore:null,initComponent:function(){var a=this.panel.getStore();void 0===this.initialConfig.animate&&(this.animate=Ext.enableFx);this.store=this.providedStore||new Ext.data.NodeStore({treeStore:a,recursive:!0,rootVisible:this.rootVisible});this.store.on({beforeexpand:this.onBeforeExpand,expand:this.onExpand,beforecollapse:this.onBeforeCollapse,collapse:this.onCollapse,
write:this.onStoreWrite,datachanged:this.onStoreDataChanged,scope:this});this.node&&!this.store.node&&this.setRootNode(this.node);this.animQueue={};this.animWraps={};this.addEvents("afteritemexpand","afteritemcollapse");this.callParent(arguments);this.on({element:"el",scope:this,delegate:this.expanderSelector,mouseover:this.onExpanderMouseOver,mouseout:this.onExpanderMouseOut});this.on({element:"el",scope:this,delegate:this.checkboxSelector,click:this.onCheckboxChange})}})}});
Ext.define("Sch.patches.DataOperation",{extend:"Sch.util.Patch",requires:["Ext.data.Operation"],reportURL:"http://www.sencha.com/forum/showthread.php?198894-4.1-Ext.data.TreeStore-CRUD-regression.",description:"In Ext 4.1.0 newly created records do not get the Id returned by server applied",maxVersion:"4.1.0",overrides:{commitRecords:function(a){var b,c,d,e,f;if(!this.actionSkipSyncRe.test(this.action)&&(c=this.records)&&c.length){if(1<c.length)if("update"==this.action||c[0].clientIdProperty){b=new Ext.util.MixedCollection;
b.addAll(a);for(a=c.length;a--;)e=c[a],d=b.findBy(this.matchClientRec,e),e.copyFrom(d)}else{b=0;for(f=c.length;b<f;++b)e=c[b],d=a[b],e&&d&&this.updateRecord(e,d)}else this.updateRecord(c[0],a[0]);if(this.actionCommitRecordsRe.test(this.action))for(a=c.length;a--;)c[a].commit()}},updateRecord:function(a,b){b&&(a.phantom||a.getId()===b.getId())&&a.copyFrom(b)}}});
Ext.define("Sch.patches.TreeStore",{extend:"Sch.util.Patch",requires:["Ext.data.TreeStore"],description:"http://www.sencha.com/forum/showthread.php?208602-Model-s-Id-field-not-defined-after-sync-in-TreeStore-%28CRUD%29",maxVersion:"4.1.0",overrides:{onCreateRecords:function(a){this.callParent(arguments);for(var b=0,c=a.length,d=this.tree,e;b<c;++b)e=a[b],d.onNodeIdChanged(e,null,e.getId())},setRootNode:function(a,b){var c=this.model,d=c.prototype.idProperty;a=a||{};a.isModel?a.isModel&&!a.isNode&&
Ext.data.NodeInterface.decorate(c):(Ext.applyIf(a,{text:"Root",allowDrag:!1}),void 0===a[d]&&(a[d]=this.defaultRootId),Ext.data.NodeInterface.decorate(c),a=Ext.ModelManager.create(a,c));this.getProxy().getReader().buildExtractors(!0);this.tree.setRootNode(a);!0!==b&&(!a.isLoaded()&&(!0===this.autoLoad||a.isExpanded()))&&this.load({node:a});return a}}});
Ext.define("Sch.view.Locking",{extend:"Ext.grid.LockingView",scheduleEventRelayRe:/^(schedule|event|beforeevent|afterevent|dragcreate|beforedragcreate|afterdragcreate|beforetooltipshow)/,constructor:function(a){this.callParent(arguments);var b=[],c=this.scheduleEventRelayRe,d=a.normal.getView(),e=d.events,f;for(f in e)e.hasOwnProperty(f)&&c.test(f)&&b.push(f);this.relayEvents(d,b)},getElementFromEventRecord:function(a){return this.normal.getView().getElementFromEventRecord(a)},onClear:function(){this.relayFn("onClear",
arguments)},beginBulkUpdate:function(){this.relayFn("beginBulkUpdate",arguments)},endBulkUpdate:function(){this.relayFn("endBulkUpdate",arguments)},refreshKeepingScroll:function(){this.locked.getView().refresh();this.normal.getView().refreshKeepingScroll()}});
Ext.define("Sch.tooltip.ClockTemplate",{constructor:function(){function a(a){var b=a*d,c=e(b),b=f(b),g=l*f((90-a)*d),h=l*e((90-a)*d),g=Math.min(l,l-g);return Ext.String.format("filter:{0};-ms-filter:{0};top:{1}px;left:{2}px;","progid:DXImageTransform.Microsoft.Matrix(sizingMethod\x3d'auto expand', M11 \x3d "+c+", M12 \x3d "+-b+", M21 \x3d "+b+", M22 \x3d "+c+")",g+p,(180<a?h:0)+m)}function b(a){var b=a*d,c=e(b),b=f(b),l=g*f((90-a)*d),m=g*e((90-a)*d),l=Math.min(g,g-l);return Ext.String.format("filter:{0};-ms-filter:{0};top:{1}px;left:{2}px;",
"progid:DXImageTransform.Microsoft.Matrix(sizingMethod\x3d'auto expand', M11 \x3d "+c+", M12 \x3d "+-b+", M21 \x3d "+b+", M22 \x3d "+c+")",l+h,(180<a?m:0)+k)}function c(a){return Ext.String.format("transform:rotate({0}deg);-moz-transform: rotate({0}deg);-webkit-transform: rotate({0}deg);-o-transform:rotate({0}deg);",a)}var d=Math.PI/180,e=Math.cos,f=Math.sin,g=7,h=2,k=10,l=6,p=3,m=10;return new Ext.XTemplate('\x3cdiv class\x3d"sch-clockwrap {cls}"\x3e\x3cdiv class\x3d"sch-clock"\x3e\x3cdiv class\x3d"sch-hourIndicator" style\x3d"{[this.getHourStyle((values.date.getHours()%12) * 30)]}"\x3e{[Ext.Date.monthNames[values.date.getMonth()].substr(0,3)]}\x3c/div\x3e\x3cdiv class\x3d"sch-minuteIndicator" style\x3d"{[this.getMinuteStyle(values.date.getMinutes() * 6)]}"\x3e{[values.date.getDate()]}\x3c/div\x3e\x3c/div\x3e\x3cspan class\x3d"sch-clock-text"\x3e{text}\x3c/span\x3e\x3c/div\x3e',
{compiled:!0,disableFormats:!0,getMinuteStyle:Ext.isIE?b:c,getHourStyle:Ext.isIE?a:c})}});
Ext.define("Sch.tooltip.Tooltip",{extend:"Ext.tip.ToolTip",requires:["Sch.tooltip.ClockTemplate"],autoHide:!1,anchor:"b",padding:"0 3 0 0",showDelay:0,hideDelay:0,quickShowInterval:0,dismissDelay:0,trackMouse:!1,valid:!0,anchorOffset:5,shadow:!1,frame:!1,constructor:function(a){var b=Ext.create("Sch.tooltip.ClockTemplate");this.renderTo=document.body;this.startDate=this.endDate=new Date;this.template||(this.template=Ext.create("Ext.XTemplate",'\x3cdiv class\x3d"{[values.valid ? "sch-tip-ok" : "sch-tip-notok"]}"\x3e',
'{[this.renderClock(values.startDate, values.startText, "sch-tooltip-startdate")]}','{[this.renderClock(values.endDate, values.endText, "sch-tooltip-enddate")]}',"\x3c/div\x3e",{compiled:!0,disableFormats:!0,renderClock:function(a,d,e){return b.apply({date:a,text:d,cls:e})}}));this.callParent(arguments)},update:function(a,b,c){if(0!==this.startDate-a||0!==this.endDate-b||this.valid!==c){this.startDate=a;this.endDate=b;this.valid=c;var d=this.schedulerView.getFormattedDate(a),e=this.schedulerView.getFormattedEndDate(b,
a);"calendar"===this.mode&&(0===b.getHours()&&0===b.getMinutes()&&!(b.getYear()===a.getYear()&&b.getMonth()===a.getMonth()&&b.getDate()===a.getDate()))&&(b=Sch.util.Date.add(b,Sch.util.Date.DAY,-1));this.callParent([this.template.apply({valid:c,startDate:a,startText:d,endText:e,endDate:b})])}},show:function(a,b){a&&(0<=Sch.util.Date.compareUnits(this.schedulerView.getTimeResolution().unit,Sch.util.Date.DAY)?(this.mode="calendar",this.addCls("sch-day-resolution")):(this.mode="clock",this.removeCls("sch-day-resolution")),
this.mouseOffsets=[b-18,-7],this.setTarget(a),this.callParent(),this.alignTo(a,"bl-tl",this.mouseOffsets))},onMouseMove:function(){this.el.alignTo(this.target,"bl-tl",this.mouseOffsets);this.callParent(arguments)},afterRender:function(){this.callParent(arguments);this.el.on("mouseenter",this.onElMouseEnter,this)},onElMouseEnter:function(){this.alignTo(this.target,"bl-tl",this.mouseOffsets)}});
Ext.define("Sch.util.Date",{requires:"Ext.Date",singleton:!0,constructor:function(){var a=Ext.Date,a={MILLI:a.MILLI,SECOND:a.SECOND,MINUTE:a.MINUTE,HOUR:a.HOUR,DAY:a.DAY,WEEK:"w",MONTH:a.MONTH,QUARTER:"q",YEAR:a.YEAR};Ext.apply(this,a);this.units=[this.MILLI,this.SECOND,this.MINUTE,this.HOUR,this.DAY,this.WEEK,this.MONTH,this.QUARTER,this.YEAR];for(var b in a)a.hasOwnProperty(b)&&(this.unitNames[a[b]]=this.unitNames[b])},betweenLesser:function(a,b,c){a=a.getTime();return b.getTime()<=a&&a<c.getTime()},
constrain:function(a,b,c){return this.min(this.max(a,b),c)},compareUnits:function(a,b){var c=Ext.Array.indexOf(this.units,a),d=Ext.Array.indexOf(this.units,b);return c>d?1:c<d?-1:0},isUnitGreater:function(a,b){return 0<this.compareUnits(a,b)},copyTimeValues:function(a,b){a.setHours(b.getHours());a.setMinutes(b.getMinutes());a.setSeconds(b.getSeconds());a.setMilliseconds(b.getMilliseconds())},add:function(a,b,c){var d=Ext.Date.clone(a);if(!b||0===c)return d;switch(b.toLowerCase()){case this.MILLI:d=
new Date(a.getTime()+c);break;case this.SECOND:d=new Date(a.getTime()+1E3*c);break;case this.MINUTE:d=new Date(a.getTime()+6E4*c);break;case this.HOUR:d=new Date(a.getTime()+36E5*c);break;case this.DAY:d.setDate(a.getDate()+c);break;case this.WEEK:d.setDate(a.getDate()+7*c);break;case this.MONTH:b=a.getDate();28<b&&(b=Math.min(b,Ext.Date.getLastDateOfMonth(this.add(Ext.Date.getFirstDateOfMonth(a),this.MONTH,c)).getDate()));d.setDate(b);d.setMonth(d.getMonth()+c);break;case this.QUARTER:d=this.add(a,
this.MONTH,3*c);break;case this.YEAR:d.setFullYear(a.getFullYear()+c)}return d},getMeasuringUnit:function(a){return a===this.WEEK?this.DAY:a},getDurationInUnit:function(a,b,c){var d;switch(c){case this.YEAR:d=Math.round(this.getDurationInYears(a,b));break;case this.QUARTER:d=Math.round(this.getDurationInMonths(a,b)/3);break;case this.MONTH:d=Math.round(this.getDurationInMonths(a,b));break;case this.WEEK:d=Math.round(this.getDurationInDays(a,b))/7;break;case this.DAY:d=Math.round(this.getDurationInDays(a,
b));break;case this.HOUR:d=Math.round(this.getDurationInHours(a,b));break;case this.MINUTE:d=Math.round(this.getDurationInMinutes(a,b));break;case this.SECOND:d=Math.round(this.getDurationInSeconds(a,b));break;case this.MILLI:d=Math.round(this.getDurationInMilliseconds(a,b))}return d},getUnitToBaseUnitRatio:function(a,b){if(a===b)return 1;switch(a){case this.YEAR:switch(b){case this.QUARTER:return 0.25;case this.MONTH:return 1/12}break;case this.QUARTER:switch(b){case this.YEAR:return 4;case this.MONTH:return 1/
3}break;case this.MONTH:switch(b){case this.YEAR:return 12;case this.QUARTER:return 3}break;case this.WEEK:switch(b){case this.DAY:return 1/7;case this.HOUR:return 1/168}break;case this.DAY:switch(b){case this.WEEK:return 7;case this.HOUR:return 1/24;case this.MINUTE:return 1/1440}break;case this.HOUR:switch(b){case this.DAY:return 24;case this.MINUTE:return 1/60}break;case this.MINUTE:switch(b){case this.HOUR:return 60;case this.SECOND:return 1/60;case this.MILLI:return 1/6E4}break;case this.SECOND:switch(b){case this.MILLI:return 0.001}break;
case this.MILLI:switch(b){case this.SECOND:return 1E3}}return-1},getDurationInMilliseconds:function(a,b){return b-a},getDurationInSeconds:function(a,b){return(b-a)/1E3},getDurationInMinutes:function(a,b){return(b-a)/6E4},getDurationInHours:function(a,b){return(b-a)/36E5},getDurationInDays:function(a,b){return(b-a)/864E5},getDurationInBusinessDays:function(a,b){for(var c=Math.round((b-a)/864E5),d=0,e,f=0;f<c;f++)e=this.add(a,this.DAY,f).getDay(),6!==e&&0!==e&&d++;return d},getDurationInMonths:function(a,
b){return 12*(b.getFullYear()-a.getFullYear())+(b.getMonth()-a.getMonth())},getDurationInYears:function(a,b){return this.getDurationInMonths(a,b)/12},min:function(a,b){return a<b?a:b},max:function(a,b){return a>b?a:b},intersectSpans:function(a,b,c,d){return this.betweenLesser(a,c,d)||this.betweenLesser(c,a,b)},getNameOfUnit:function(a){switch(a.toLowerCase()){case this.YEAR:return"YEAR";case this.QUARTER:return"QUARTER";case this.MONTH:return"MONTH";case this.WEEK:return"WEEK";case this.DAY:return"DAY";
case this.HOUR:return"HOUR";case this.MINUTE:return"MINUTE";case this.SECOND:return"SECOND";case this.MILLI:return"MILLI"}throw"Incorrect UnitName";},unitNames:{YEAR:{single:"year",plural:"years",abbrev:"yr"},QUARTER:{single:"quarter",plural:"quarters",abbrev:"q"},MONTH:{single:"month",plural:"months",abbrev:"mon"},WEEK:{single:"week",plural:"weeks",abbrev:"w"},DAY:{single:"day",plural:"days",abbrev:"d"},HOUR:{single:"hour",plural:"hours",abbrev:"h"},MINUTE:{single:"minute",plural:"minutes",abbrev:"min"},
SECOND:{single:"second",plural:"seconds",abbrev:"s"},MILLI:{single:"ms",plural:"ms",abbrev:"ms"}},getReadableNameOfUnit:function(a,b){return this.unitNames[a][b?"plural":"single"]},getShortNameOfUnit:function(a){return this.unitNames[a.toUpperCase()].abbrev},getUnitByName:function(a){a=a.toUpperCase();this[a]||Ext.Error.raise("Unknown unit name");return this[a]},getNext:function(a,b,c,d){var e=Ext.Date.clone(a);c=c||1;switch(b){case this.DAY:Ext.Date.clearTime(e);e=this.add(e,this.DAY,c);break;case this.WEEK:a=
e.getDay();e=this.add(e,this.DAY,7*(c-1)+(a<d?d-a:7-a+d));break;case this.MONTH:e=this.add(e,this.MONTH,c);e.setDate(1);break;case this.QUARTER:e=this.add(e,this.MONTH,3*(c-1)+(3-e.getMonth()%3));break;case this.YEAR:e=new Date(e.getFullYear()+c,0,1);break;default:e=this.add(a,b,c)}return e},getNumberOfMsFromTheStartOfDay:function(a){return a-Ext.Date.clearTime(a,!0)||864E5},getNumberOfMsTillTheEndOfDay:function(a){return this.getStartOfNextDay(a,!0)-a},getStartOfNextDay:function(a,b){var c=this.add(Ext.Date.clearTime(a,
b),this.DAY,1);if(c.getDate()==a.getDate())var d=this.add(Ext.Date.clearTime(a,b),this.DAY,2).getTimezoneOffset(),e=a.getTimezoneOffset(),c=this.add(c,this.MINUTE,e-d);return c},getEndOfPreviousDay:function(a){var b=Ext.Date.clearTime(a,!0);return b-a?b:this.add(b,this.DAY,-1)},timeSpanContains:function(a,b,c,d){return 0<=c-a&&0<=b-d}});
Ext.define("Sch.util.Debug",{singleton:!0,runDiagnostics:function(){var a,b=console;b&&b.log?a=function(){b.log.apply(console,arguments)}:(window.schedulerDebugWin||(window.schedulerDebugWin=new Ext.Window({height:400,width:500,bodyStyle:"padding:10px",closeAction:"hide",autoScroll:!0})),window.schedulerDebugWin.show(),schedulerDebugWin.update(""),a=function(a){schedulerDebugWin.update((schedulerDebugWin.body.dom.innerHTML||"")+a+"\x3cbr/\x3e")});var c=Ext.select(".sch-schedulerpanel");0===c.getCount()&&
a("No scheduler component found");var d=Ext.getCmp(c.elements[0].id),c=d.getResourceStore(),e=d.getEventStore();e instanceof Sch.data.EventStore||a("Your event store must be or extend Sch.data.EventStore");a("Scheduler view start: "+d.getStart()+", end: "+d.getEnd());if(c)if(e){a(c.getCount()+" records in the resource store");a(e.getCount()+" records in the eventStore");var f=e.model.prototype.idProperty,g=c.model.prototype.idProperty,h=e.model.prototype.fields.getByKey(f),k=c.model.prototype.fields.getByKey(g);
e.model.prototype instanceof Sch.model.Event||a("Your event model must extend Sch.model.Event");c.model.prototype instanceof Sch.model.Resource||a("Your event model must extend Sch.model.Resource");h||a("idProperty on the event model is incorrectly setup, value: "+f);k||a("idProperty on the resource model is incorrectly setup, value: "+g);d=d.getSchedulingView();a(d.el.select(d.eventSelector).getCount()+" events present in the DOM");if(0<e.getCount()){if(!e.first().getStartDate()||!(e.first().getStartDate()instanceof
Date))a("The eventStore reader is misconfigured - The StartDate field is not setup correctly, please investigate"),a("StartDate is configured with dateFormat: "+e.model.prototype.fields.getByKey("StartDate").dateFormat),a("See Ext JS docs for information about different date formats: http://docs.sencha.com/ext-js/4-0/#!/api/Ext.Date");if(!e.first().getEndDate()||!(e.first().getEndDate()instanceof Date))a("The eventStore reader is misconfigured - The EndDate field is not setup correctly, please investigate"),
a("EndDate is configured with dateFormat: "+e.model.prototype.fields.getByKey("EndDate").dateFormat),a("See Ext JS docs for information about different date formats: http://docs.sencha.com/ext-js/4-0/#!/api/Ext.Date");e.proxy&&(e.proxy.reader&&e.proxy.reader.jsonData)&&(a("Dumping jsonData to console"),console.dir(e.proxy.reader.jsonData));a("Records in the event store:");e.each(function(b,c){a(c+1+". "+b.startDateField+":"+b.getStartDate()+", "+b.endDateField+":"+b.getEndDate()+", "+b.resourceIdField+
":"+b.getResourceId());b.getStartDate()||a(b.getStartDate())})}else a("Event store has no data. Has it been loaded properly?");0<c.getCount()?(a("Records in the resource store:"),c.each(function(b,c){a(c+1+". "+b.idProperty+":"+b.getId())}),a("Everything seems to be setup ok!")):a("Resource store has no data.")}else a("No event store configured");else a("No store configured")}});
Ext.define("Sch.util.HeaderRenderers",{singleton:!0,requires:["Sch.util.Date","Ext.XTemplate"],constructor:function(){var a=Ext.create("Ext.XTemplate",'\x3ctable class\x3d"sch-nested-hdr-tbl '+Ext.baseCSSPrefix+'column-header-text" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\x3ctr\x3e\x3ctpl for\x3d"."\x3e\x3ctd style\x3d"width:{[100/xcount]}%" class\x3d"{cls} sch-dayheadercell-{dayOfWeek}"\x3e{text}\x3c/td\x3e\x3c/tpl\x3e\x3c/tr\x3e\x3c/table\x3e').compile(),b=Ext.create("Ext.XTemplate",'\x3ctable class\x3d"sch-nested-hdr-tbl" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\x3ctr\x3e\x3ctpl for\x3d"."\x3e\x3ctd style\x3d"width:{[100/xcount]}%" class\x3d"{cls}"\x3e{text}\x3c/td\x3e\x3c/tpl\x3e\x3c/tr\x3e\x3c/table\x3e').compile();
return{quarterMinute:function(a,b,e,f){e.headerCls="sch-nested-hdr-pad";return'\x3ctable class\x3d"sch-nested-hdr-tbl" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\x3ctr\x3e\x3ctd\x3e00\x3c/td\x3e\x3ctd\x3e15\x3c/td\x3e\x3ctd\x3e30\x3c/td\x3e\x3ctd\x3e45\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e'},dateCells:function(a,d,e){return function(f,g,h){h.headerCls="sch-nested-hdr-nopad";h=[];for(f=Ext.Date.clone(f);f<g;)h.push({text:Ext.Date.format(f,e)}),f=Sch.util.Date.add(f,a,d);h[0].cls="sch-nested-hdr-cell-first";
h[h.length-1].cls="sch-nested-hdr-cell-last";return b.apply(h)}},dateNumber:function(b,d,e){e.headerCls="sch-nested-hdr-nopad";e=[];for(b=Ext.Date.clone(b);b<d;)e.push({dayOfWeek:b.getDay(),text:b.getDate()}),b=Sch.util.Date.add(b,Sch.util.Date.DAY,1);return a.apply(e)},dayLetter:function(b,d,e){e.headerCls="sch-nested-hdr-nopad";for(e=[];b<d;)e.push({dayOfWeek:b.getDay(),text:Ext.Date.dayNames[b.getDay()].substr(0,1)}),b=Sch.util.Date.add(b,Sch.util.Date.DAY,1);e[0].cls="sch-nested-hdr-cell-first";
e[e.length-1].cls="sch-nested-hdr-cell-last";return a.apply(e)},dayStartEndHours:function(a,b,e){e.headerCls="sch-hdr-startend";return Ext.String.format('\x3cspan class\x3d"sch-hdr-start"\x3e{0}\x3c/span\x3e\x3cspan class\x3d"sch-hdr-end"\x3e{1}\x3c/span\x3e',Ext.Date.format(a,"G"),Ext.Date.format(b,"G"))}}}});
Ext.define("Sch.util.DragTracker",{extend:"Ext.dd.DragTracker",xStep:1,yStep:1,setXStep:function(a){this.xStep=a},setYStep:function(a){this.yStep=a},getRegion:function(){var a=this.startXY,b=this.getXY(),c=Math.min(a[0],b[0]),d=Math.min(a[1],b[1]),e=Math.abs(a[0]-b[0]),a=Math.abs(a[1]-b[1]);return new Ext.util.Region(d,c+e,d+a,c)},onMouseDown:function(a,b){if(!this.disabled&&!a.dragTracked){var c=a.getXY(),d,e=c[0],c=c[1];1<this.xStep&&(d=this.el.getX(),e=Math.round((e-d)/this.xStep)*this.xStep,e+=
d);1<this.yStep&&(d=this.el.getY(),c=Math.round((c-d)/this.yStep)*this.yStep,c+=d);this.dragTarget=this.delegate?b:this.handle.dom;this.startXY=this.lastXY=[e,c];this.startRegion=Ext.fly(this.dragTarget).getRegion();!1===this.fireEvent("mousedown",this,a)||(!1===this.fireEvent("beforedragstart",this,a)||!1===this.onBeforeStart(a))||(this.mouseIsDown=!0,a.dragTracked=!0,!1!==this.preventDefault&&a.preventDefault(),Ext.getDoc().on({scope:this,mouseup:this.onMouseUp,mousemove:this.onMouseMove,selectstart:this.stopSelect}),
this.autoStart&&(this.timer=Ext.defer(this.triggerStart,!0===this.autoStart?1E3:this.autoStart,this,[a])))}},onMouseMove:function(a,b){if(this.active&&Ext.isIE&&!a.browserEvent.button)a.preventDefault(),this.onMouseUp(a);else{a.preventDefault();var c=a.getXY(),d=this.startXY;if(!this.active)if(Math.max(Math.abs(d[0]-c[0]),Math.abs(d[1]-c[1]))>this.tolerance)this.triggerStart(a);else return;var d=c[0],e=c[1];1<this.xStep&&(d-=this.startXY[0],d=Math.round(d/this.xStep)*this.xStep,d+=this.startXY[0]);
1<this.yStep&&(e-=this.startXY[1],e=Math.round(e/this.yStep)*this.yStep,e+=this.startXY[1]);if(!(1<this.xStep||1<this.yStep)||d!==c[0]||e!==c[1])if(this.lastXY=[d,e],!1===this.fireEvent("mousemove",this,a))this.onMouseUp(a);else this.onDrag(a),this.fireEvent("drag",this,a)}}});
Ext.define("Sch.preset.Manager",{extend:"Ext.util.MixedCollection",requires:["Sch.util.Date","Sch.util.HeaderRenderers"],singleton:!0,constructor:function(){this.callParent(arguments);this.registerDefaults()},registerPreset:function(a,b){if(b){var c=b.headerConfig,d=Sch.util.Date,e;for(e in c)c.hasOwnProperty(e)&&d[c[e].unit]&&(c[e].unit=d[c[e].unit.toUpperCase()]);b.timeColumnWidth||(b.timeColumnWidth=50);b.timeResolution&&d[b.timeResolution.unit]&&(b.timeResolution.unit=d[b.timeResolution.unit.toUpperCase()]);
b.shiftUnit&&d[b.shiftUnit]&&(b.shiftUnit=d[b.shiftUnit.toUpperCase()])}if(this.isValidPreset(b))this.containsKey(a)&&this.removeAtKey(a),this.add(a,b);else throw"Invalid preset, please check your configuration";},isValidPreset:function(a){var b=!0,c=Sch.util.Date.units,d;for(d in a.headerConfig)a.headerConfig.hasOwnProperty(d)&&(b=b&&0<=Ext.Array.indexOf(c,a.headerConfig[d].unit));a.timeResolution&&(b=b&&0<=Ext.Array.indexOf(c,a.timeResolution.unit));a.shiftUnit&&(b=b&&0<=Ext.Array.indexOf(c,a.shiftUnit));
return b},getPreset:function(a){return this.get(a)},deletePreset:function(a){this.removeAtKey(a)},registerDefaults:function(){var a=this.defaultPresets,b;for(b in a)this.registerPreset(b,a[b])},defaultPresets:{hourAndDay:{timeColumnWidth:60,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"G:i",shiftIncrement:1,shiftUnit:"DAY",defaultSpan:12,timeResolution:{unit:"MINUTE",increment:15},headerConfig:{middle:{unit:"HOUR",dateFormat:"G:i"},top:{unit:"DAY",dateFormat:"D d/m"}}},dayAndWeek:{timeColumnWidth:100,
rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d G:i",shiftUnit:"DAY",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"HOUR",increment:1},headerConfig:{middle:{unit:"DAY",dateFormat:"D d M"},top:{unit:"WEEK",renderer:function(a,b,c){return Sch.util.Date.getShortNameOfUnit("WEEK")+"."+Ext.Date.format(a,"W M Y")}}}},weekAndDay:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"DAY",
increment:1},headerConfig:{bottom:{unit:"DAY",increment:1,dateFormat:"d/m"},middle:{unit:"WEEK",dateFormat:"D d M",align:"left"}}},weekAndMonth:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"WEEK",renderer:function(a,b,c){c.align="left";return Ext.Date.format(a,"d M")}},top:{unit:"MONTH",dateFormat:"M Y"}}},monthAndYear:{timeColumnWidth:110,rowHeight:24,
resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftIncrement:3,shiftUnit:"MONTH",defaultSpan:12,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"MONTH",dateFormat:"M Y"},top:{unit:"YEAR",dateFormat:"Y"}}},year:{timeColumnWidth:100,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"YEAR",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"MONTH",increment:1},headerConfig:{bottom:{unit:"QUARTER",renderer:function(a,b,c){return Ext.String.format(Sch.util.Date.getShortNameOfUnit("QUARTER").toUpperCase()+
"{0}",Math.floor(a.getMonth()/3)+1)}},middle:{unit:"YEAR",dateFormat:"Y"}}},weekAndDayLetter:{timeColumnWidth:20,rowHeight:24,resourceColumnWidth:100,displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"DAY",increment:1},headerConfig:{bottom:{unit:"DAY",increment:1,renderer:function(a){return Ext.Date.dayNames[a.getDay()].substring(0,1)}},middle:{unit:"WEEK",dateFormat:"D d M Y",align:"left"}}},weekDateAndMonth:{timeColumnWidth:30,rowHeight:24,resourceColumnWidth:100,
displayDateFormat:"Y-m-d",shiftUnit:"WEEK",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"WEEK",dateFormat:"d"},top:{unit:"MONTH",dateFormat:"Y F",align:"left"}}}}});Ext.define("Sch.preset.ViewPreset",{});Ext.define("Sch.preset.ViewPresetHeaderRow",{});
Ext.define("Sch.feature.AbstractTimeSpan",{extend:"Ext.AbstractPlugin",lockableScope:"normal",schedulerView:null,timeAxis:null,containerEl:null,expandToFitView:!1,disabled:!1,cls:null,template:null,store:null,renderElementsBuffered:!1,renderDelay:15,constructor:function(a){this.uniqueCls=this.uniqueCls||"sch-timespangroup-"+Ext.id();Ext.apply(this,a)},setDisabled:function(a){a&&this.removeElements();this.disabled=a},getElements:function(){return this.containerEl?this.containerEl.select("."+this.uniqueCls):
null},removeElements:function(){var a=this.getElements();a&&a.remove()},init:function(a){this.timeAxis=a.getTimeAxis();this.schedulerView=a.getSchedulingView();this.store||Ext.Error.raise("Error: You must define a store for this plugin");this.schedulerView.on({afterrender:this.onAfterRender,destroy:this.onDestroy,scope:this})},onAfterRender:function(a){a=this.schedulerView;this.containerEl=a.el;a.mon(this.store,{load:this.renderElements,datachanged:this.renderElements,clear:this.renderElements,add:this.renderElements,
remove:this.renderElements,update:this.refreshSingle,scope:this});Ext.data.NodeStore&&a.store instanceof Ext.data.NodeStore&&!a.animate&&a.mon(a.store,{expand:this.renderElements,collapse:this.renderElements,scope:this});a.on({refresh:this.renderElements,itemadd:this.renderElements,itemremove:this.renderElements,itemupdate:this.renderElements,groupexpand:this.renderElements,groupcollapse:this.renderElements,columnwidthchange:this.renderElements,resize:this.renderElements,scope:this});a.headerCt.on({add:this.renderElements,
remove:this.renderElements,scope:this});a.ownerCt.up("panel").on({viewchange:this.renderElements,orientationchange:this.renderElements,scope:this});this.renderElements()},renderElements:function(){if(!this.renderElementsBuffered&&!(this.disabled||0===this.schedulerView.headerCt.getColumnCount()))this.renderElementsBuffered=!0,Ext.Function.defer(this.renderElementsInternal,this.renderDelay,this)},renderElementsInternal:function(){this.renderElementsBuffered=!1;if(!this.disabled&&!(this.schedulerView.isDestroyed||
0===this.schedulerView.headerCt.getColumnCount())){this.removeElements();var a=this.timeAxis.getStart(),b=this.timeAxis.getEnd(),a=this.getElementData(a,b);this.template.insertFirst(this.containerEl,a)}},getElementData:function(a,b){throw"Abstract method call";},onDestroy:function(){this.store.autoDestroy&&this.store.destroy()},refreshSingle:function(a,b){var c=Ext.get(this.uniqueCls+"-"+b.internalId);if(c){var d=this.timeAxis.getStart(),e=this.timeAxis.getEnd(),d=this.getElementData(d,e,[b])[0];
c.setTop(d.top);c.setLeft(d.left);c.setSize(d.width,d.height)}else this.renderElements()}});
Ext.define("Sch.feature.DragCreator",{requires:["Ext.XTemplate","Sch.util.Date","Sch.util.DragTracker","Sch.tooltip.Tooltip","Sch.tooltip.ClockTemplate"],disabled:!1,showHoverTip:!0,showDragTip:!0,dragTolerance:2,validatorFn:Ext.emptyFn,validatorFnScope:null,constructor:function(a){Ext.apply(this,a||{});this.lastTime=new Date;this.template=this.template||Ext.create("Ext.Template",'\x3cdiv class\x3d"sch-dragcreator-proxy sch-event"\x3e\x3cdiv class\x3d"sch-event-inner"\x3e\x26#160;\x3c/div\x3e\x3c/div\x3e',{compiled:!0,
disableFormats:!0});this.schedulerView.on("destroy",this.onSchedulerDestroy,this);this.schedulerView.el.on("mousemove",this.setupTooltips,this,{single:!0});this.callParent([a])},setDisabled:function(a){this.disabled=a;this.hoverTip&&this.hoverTip.setDisabled(a);this.dragTip&&this.dragTip.setDisabled(a)},getProxy:function(){this.proxy||(this.proxy=this.template.append(this.schedulerView.panel.el,{},!0));return this.proxy},onMouseMove:function(a){var b=this.hoverTip;!b.disabled&&!this.dragging&&(a.getTarget("."+
this.schedulerView.timeCellCls,2)?(a=this.schedulerView.getDateFromDomEvent(a,"floor"))?0!==a-this.lastTime&&(this.updateHoverTip(a),b.hidden&&(b[0<=Sch.util.Date.compareUnits(this.schedulerView.getTimeResolution().unit,Sch.util.Date.DAY)?"addCls":"removeCls"]("sch-day-resolution"),b.show())):(b.hide(),this.lastTime=null):(b.hide(),this.lastTime=null))},updateHoverTip:function(a){if(a){var b=this.schedulerView.getFormattedDate(a);this.hoverTip.update(this.hoverTipTemplate.apply({date:a,text:b}));
this.lastTime=a}},onBeforeDragStart:function(a,b){var c=this.schedulerView,d=b.getTarget("."+c.timeCellCls,2);if(d){var e=c.resolveResource(d),f=c.getDateFromDomEvent(b);if(!this.disabled&&d&&!1!==c.fireEvent("beforedragcreate",c,e,f,b))return this.resourceRecord=e,this.originalStart=f,this.resourceRegion=c.getScheduleRegion(this.resourceRecord,this.originalStart),this.dateConstraints=c.getDateConstraints(this.resourceRecord,this.originalStart),!0}return!1},onDragStart:function(){var a=this.schedulerView,
b=this.getProxy();this.dragging=!0;this.hoverTip&&this.hoverTip.disable();this.end=this.start=this.originalStart;"horizontal"===a.getOrientation()?(this.rowBoundaries={top:this.resourceRegion.top,bottom:this.resourceRegion.bottom},b.setRegion({top:this.rowBoundaries.top,right:this.tracker.startXY[0],bottom:this.rowBoundaries.bottom,left:this.tracker.startXY[0]})):(this.rowBoundaries={left:this.resourceRegion.left,right:this.resourceRegion.right},b.setRegion({top:this.tracker.startXY[1],right:this.resourceRegion.right,
bottom:this.tracker.startXY[1],left:this.resourceRegion.left}));b.show();this.schedulerView.fireEvent("dragcreatestart",this.schedulerView);this.showDragTip&&(this.dragTip.enable(),this.dragTip.update(this.start,this.end,!0),this.dragTip.show(b),this.dragTip.el.setStyle("visibility","visible"))},onDrag:function(a,b){var c=this.schedulerView,d=this.tracker.getRegion().constrainTo(this.resourceRegion);if(c=c.getStartEndDatesFromRegion(d,"round")){this.start=c.start||this.start;this.end=c.end||this.end;
if(c=this.dateConstraints)this.end=Sch.util.Date.constrain(this.end,c.start,c.end),this.start=Sch.util.Date.constrain(this.start,c.start,c.end);this.valid=!1!==this.validatorFn.call(this.validatorFnScope||this,this.resourceRecord,this.start,this.end);this.showDragTip&&this.dragTip.update(this.start,this.end,this.valid);Ext.apply(d,this.rowBoundaries);this.getProxy().setRegion(d)}},onDragEnd:function(a,b){this.dragging=!1;var c=this.schedulerView;this.showDragTip&&this.dragTip.disable();if(!this.start||
!this.end||0>=this.end-this.start)this.valid=!1;if(this.valid){var d=Ext.create(this.schedulerView.eventStore.model);d.assign(this.resourceRecord);d.setStartDate(this.start);d.setEndDate(this.end);c.fireEvent("dragcreateend",c,d,this.resourceRecord,b)}else this.proxy.hide();this.schedulerView.fireEvent("afterdragcreate",c);this.hoverTip&&this.hoverTip.enable()},tipCfg:{trackMouse:!0,bodyCssClass:"sch-hovertip",autoHide:!1,dismissDelay:1E3,showDelay:300},dragging:!1,setupTooltips:function(){var a=
this,b=a.schedulerView;a.tracker=new Sch.util.DragTracker({el:b.el,tolerance:a.dragTolerance,listeners:{beforedragstart:a.onBeforeDragStart,dragstart:a.onDragStart,drag:a.onDrag,dragend:a.onDragEnd,scope:a}});this.showDragTip&&(this.dragTip=Ext.create("Sch.tooltip.Tooltip",{cls:"sch-dragcreate-tip",schedulerView:b,listeners:{beforeshow:function(){return a.dragging}}}));if(a.showHoverTip){var c=b.el;a.hoverTipTemplate=a.hoverTipTemplate||Ext.create("Sch.tooltip.ClockTemplate");a.hoverTip=new Ext.ToolTip(Ext.applyIf({renderTo:document.body,
target:c,disabled:a.disabled},a.tipCfg));a.hoverTip.on("beforeshow",a.tipOnBeforeShow,a);b.mon(c,{mouseleave:function(){a.hoverTip.hide()},mousemove:a.onMouseMove,scope:a})}},onSchedulerDestroy:function(){this.hoverTip&&this.hoverTip.destroy();this.dragTip&&this.dragTip.destroy();this.tracker&&this.tracker.destroy();this.proxy&&(Ext.destroy(this.proxy),this.proxy=null)},tipOnBeforeShow:function(a){return!this.disabled&&!this.dragging&&null!==this.lastTime}});
Ext.define("Sch.feature.DragZone",{extend:"Ext.dd.DragZone",containerScroll:!0,onStartDrag:function(){var a=this.schedulerView;a.fireEvent("eventdragstart",a,this.dragData.records)},getDragData:function(a){var b=this.schedulerView,c=a.getTarget(b.eventSelector);if(c){b.getSelectionModel();var d=Ext.get(c),d=d.is(b.eventSelector)?c:d.up(b.eventSelector).dom,d=b.getEventRecordFromDomId(d.id);if(!1===b.fireEvent("beforeeventdrag",b,d,a))return null;a=d.getStartDate();for(var e=[d],f,g=Ext.get(Ext.core.DomHelper.createDom({cls:"sch-dd-wrap",
children:[{cls:"sch-dd-proxy-hd",html:"\x26nbsp"}]})),h=0,k=e.length;h<k;h++)f=b.getElementFromEventRecord(e[h]).dom.cloneNode(!0),f.id=Ext.id(),g.appendChild(f);return{repairXY:Ext.fly(c).getXY(),ddel:g.dom,sourceEventRecord:d,records:e,duration:d.getEndDate()-a}}return null},afterRepair:function(){this.dragging=!1;var a=this.schedulerView;a.fireEvent("aftereventdrop",a)},getRepairXY:function(){return this.dragData.repairXY},onDragKeyDown:function(a){var b=this.getProxy();a.ctrlKey&&(b.dropStatus===
b.dropAllowed||b.dropStatus===b.dropAllowed+" add")&&b.setStatus(b.dropAllowed+" add")},onDragKeyUp:function(a){a.ctrlKey||(a=this.getProxy(),a.setStatus(a.dropStatus.replace(" add","")))},onMouseDown:function(){if(this.enableCopy)Ext.getBody().on({keydown:this.onDragKeyDown,keyup:this.onDragKeyUp,scope:this})},onMouseUp:function(){var a=Ext.getBody();a.un("keydown",this.onDragKeyDown,this);a.un("keyup",this.onDragKeyUp,this)}});
Ext.define("Sch.feature.DropZone",{extend:"Ext.dd.DropZone",constructor:function(){this.callParent(arguments);var a=this.schedulerView;this.proxyTpl=this.proxyTpl||new Ext.XTemplate('\x3cspan class\x3d"sch-dd-newtime"\x3e{[ this.getText(values) ]}\x3c/span\x3e',{getText:function(b){var c=a.getFormattedDate(b.StartDate);b.Duration&&(c+=" - "+a.getFormattedEndDate(Sch.util.Date.add(b.StartDate,Sch.util.Date.MILLI,b.Duration),b.StartDate));return c}})},validatorFn:Ext.emptyFn,getTargetFromEvent:function(a){return a.getTarget("."+
this.schedulerView.timeCellCls)},onNodeEnter:function(a,b,c,d){Ext.fly(a).addCls("sch-dd-cellover")},onNodeOut:function(a,b,c,d){Ext.fly(a).removeCls("sch-dd-cellover")},onNodeOver:function(a,b,c,d){var e=this.schedulerView;a=e.getDateFromDomEvent(c,"round");if(!a)return this.dropNotAllowed;this.proxyTpl.overwrite(b.proxy.el.down(".sch-dd-proxy-hd"),{StartDate:a,Duration:d.duration});b=e.resolveResource(c.getTarget("."+e.timeCellCls));return!1!==this.validatorFn.call(this.validatorFnScope||this,d.records,
b,a,d.duration,c)?this.dropAllowed+(this.enableCopy&&c.ctrlKey?" add":""):this.dropNotAllowed},onNodeDrop:function(a,b,c,d){b=this.schedulerView;a=b.resolveResource(a);var e=b.getDateFromDomEvent(c,"round"),f=!1,g=this.enableCopy&&c.ctrlKey;if(e&&!1!==this.validatorFn.call(this.validatorFnScope||this,d.records,a,e,d.duration,c)){var h;c=b.resourceStore.indexOf(a);g?(h=this.copyRecords(d.records,e,a,d.sourceEventRecord,c),f=!0):f=this.updateRecords(d.records,e,a,d.sourceEventRecord,c,d);f&&b.getSelectionModel().deselectAll();
b.fireEvent("eventdrop",b,g?h:d.records,g)}b.fireEvent("aftereventdrop",b);return f},updateRecords:function(a,b,c,d,e,f){if(1===a.length)return d.beginEdit(),d.assign(c),d.setStartDate(b),d.setEndDate(Sch.util.Date.add(b,Sch.util.Date.MILLI,f.duration)),d.endEdit(),!0;f=d.getStartDate();c=this.schedulerView.resourceStore;b-=f;d=c.indexOf(d.getResource());var g,h,k;g=c.getCount();for(f=0;f<a.length;f++)if(k=a[f],h=c.indexOf(k.getResource()),k=h-d+e,0>k||k>g)return!1;for(f=0;f<a.length;f++)k=a[f],h=
c.indexOf(k.getResource()),g=h-d,g=c.getAt(e+g),k.beginEdit(),k.assign(g),k.setStartDate(Sch.util.Date.add(k.getStartDate(),Sch.util.Date.MILLI,b)),k.setEndDate(Sch.util.Date.add(k.getEndDate(),Sch.util.Date.MILLI,b)),k.endEdit();return!0},copyRecords:function(a,b,c,d,e){a=a[0].copy();d=d.getEndDate()-d.getStartDate();a.assign(c);a.setStartDate(b);a.setEndDate(Sch.util.Date.add(b,Sch.util.Date.MILLI,d));return[a]}});
Ext.define("Sch.feature.PointDragZone",{extend:"Ext.dd.DragZone",requires:["Sch.tooltip.Tooltip"],repairHighlight:!1,containerScroll:!0,dropAllowed:"sch-dragproxy",dropNotAllowed:"sch-dragproxy",constructor:function(a,b){this.proxy=this.proxy||Ext.create("Ext.dd.StatusProxy",{shadow:!1,dropAllowed:"sch-dragproxy",dropNotAllowed:"sch-dragproxy"});this.callParent(arguments);this.isTarget=!0;this.ignoreSelf=this.scroll=!1;Ext.dd.ScrollManager.register(this.el)},destroy:function(){this.callParent(arguments);
Ext.dd.ScrollManager.unregister(this.el)},autoOffset:function(a,b){var c=this.dragData.repairXY;this.setDelta(a-c[0],b-c[1])},constrainTo:function(a,b){this.resetConstraints();this.initPageX=a.left;this.initPageY=a.top;this.setXConstraint(a.left,a.right-(b.right-b.left),this.xTickSize);this.setYConstraint(a.top,a.bottom-(b.bottom-b.top),this.yTickSize)},constrainToResource:function(a,b,c){this.resetConstraints();this.initPageX=a.left;this.initPageY=a.top;"horizontal"===c?(this.setXConstraint(a.left,
a.right-(b.right-b.left),this.xTickSize),this.setYConstraint(b.top,b.top,this.yTickSize)):(this.setXConstraint(b.left,b.left,this.xTickSize),this.setYConstraint(a.top,a.bottom-(b.bottom-b.top),this.yTickSize))},setXConstraint:function(a,b,c){this.leftConstraint=a;this.rightConstraint=b;this.minX=a;this.maxX=b;c&&this.setXTicks(this.initPageX,c);this.constrainX=!0},setYConstraint:function(a,b,c){this.topConstraint=a;this.bottomConstraint=b;this.minY=a;this.maxY=b;c&&this.setYTicks(this.initPageY,c);
this.constrainY=!0},onDragEnter:Ext.emptyFn,onDragOut:Ext.emptyFn,resolveStartEndDates:function(a){var b=this.dragData,c=b.origStart,d=b.origEnd;if(b.startsOutsideView){if(!b.endsOutsideView&&(a=this.schedulerView.getStartEndDatesFromRegion(a,"round")))d=a.end||b.end,c=Sch.util.Date.add(d,Sch.util.Date.MILLI,-b.duration)}else if(a=this.schedulerView.getStartEndDatesFromRegion(a,"round"))c=a.start||b.start,d=Sch.util.Date.add(c,Sch.util.Date.MILLI,b.duration);return{startDate:c,endDate:d}},onDragOver:function(a,
b){var c=this.dragData;c.originalHidden||(Ext.each(c.eventEls,function(a){a.hide()}),c.originalHidden=!0,c.refElement=this.proxy.el.down("#sch-id-dd-ref"));this.showTooltip&&(c=this.getDragContext(a))&&this.tip.update(c.startDate,c.endDate,c.valid)},getDragContext:function(a){var b=this.dragData;if(b.refElement){var c=this.schedulerView,d=b.refElement.getRegion(),e=this.resolveStartEndDates(d);e.resource=c.constrainDragToResource?b.resourceRecord:this.resolveResource([d.left+b.offsets[0],d.top+b.offsets[1]],
a);e.valid=e.resource?this.validatorFn.call(this.validatorFnScope||this,b.eventRecords,e.resource,e.startDate,b.duration,a):!1;return e}},onStartDrag:function(a,b){var c=this.schedulerView,d=this.dragData;this.start=d.origStart;this.end=d.origEnd;c.fireEvent("eventdragstart",c,d.eventRecords)},startDrag:function(){var a=this.callParent(arguments);if(this.showTooltip){var b=this.schedulerView;this.tip||(this.tip=Ext.create("Sch.tooltip.Tooltip",{schedulerView:b,cls:"sch-dragdrop-tip"}));this.tip.update(this.start,
this.end,!0);this.tip.el.setStyle("visibility");this.tip.show(this.proxy.el,this.dragData.offsets[0])}return a},getDragData:function(a){var b=this.schedulerView,c=a.getTarget(b.eventSelector);if(c){var d=b.resolveEventRecord(c);if(!1===d.isDraggable()||!1===b.fireEvent("beforeeventdrag",b,d,a))return null;var e=a.getXY(),c=Ext.get(c),f=c.getXY(),e=[e[0]-f[0],e[1]-f[1]],g=d.getResource(),h=c.getRegion(),k=b.getSnapPixelAmount();this.clearTicks();b.constrainDragToResource?this.constrainToResource(b.getScheduleRegion(g,
d),h,b.getOrientation()):this.constrainTo(b.getScheduleRegion(null,d),h);1<=k&&("horizontal"===b.getOrientation()?this.setXConstraint(this.leftConstraint,this.rightConstraint,k):this.setYConstraint(this.topConstraint,this.bottomConstraint,k));var h=d.getStartDate(),k=b.timeAxis,l=k.getStart(),p=k.getEnd(),k=d.getEndDate(),l=h<l,p=k>p,m=Ext.getBody().getScroll(),n=this.getRelatedRecords(d),q=[c];Ext.Array.each(n,function(a){(a=b.getElementFromEventRecord(a))&&q.push(a)});a={offsets:e,eventEls:q,repairXY:f,
eventRecords:[d].concat(n),relatedEventRecords:n,resourceRecord:g,origStart:h,origEnd:k,duration:k-h,startsOutsideView:l,endsOutsideView:p,bodyScroll:m,eventObj:a};a.ddel=this.getDragElement(c,a);return a}},getRelatedRecords:function(a){var b=this.schedulerView.panel.up("tablepanel").getEventSelectionModel(),c=[];1<b.selected.getCount()&&b.selected.each(function(b){b!==a&&!1!==b.isDraggable()&&c.push(b)});return c},getDragElement:function(a,b){var c=b.eventEls,d;if(1<c.length){var e=Ext.get(Ext.core.DomHelper.createDom({tag:"div",
cls:"sch-dd-wrap",style:{overflow:"visible"}}));Ext.Array.each(c,function(b){d=b.dom.cloneNode(!0);d.id=b.dom===a.dom?"sch-id-dd-ref":Ext.id();e.appendChild(d);b=b.getOffsetsTo(a);Ext.fly(d).setStyle({left:b[0]+"px",top:b[1]+"px"})});return e.dom}d=a.dom.cloneNode(!0);d.id="sch-id-dd-ref";d.style.left=0;d.style.top=0;return d},onDragDrop:function(a,b){var c=this.schedulerView,d=c.resourceStore,e=this.cachedTarget||Ext.dd.DragDropMgr.getDDById(b),f=this.dragData,g=this.getDragContext(a),h=!1;if(g&&
g.valid&&g.startDate&&g.endDate&&this.isValidDrop(f.resourceRecord,g.resource,f.relatedEventRecords)){var k=f.eventRecords[0],l=f.relatedEventRecords,p=g.startDate-f.origStart,m=g.resource,h=0!==g.startDate-f.origStart||m!==f.resourceRecord;k.beginEdit();m!==f.resourceRecord&&(k.unassign(f.resourceRecord),k.assign(m));k.setStartEndDate(g.startDate,g.endDate);k.endEdit();var n,q=Ext.data.TreeStore&&d instanceof Ext.data.TreeStore;n=q?c.indexOf(f.resourceRecord)-c.indexOf(m):d.indexOf(f.resourceRecord)-
d.indexOf(m);Ext.each(l,function(a){a.shift(Ext.Date.MILLI,p);if(q){var b=c.store.indexOf(a.getResource())-n;a.setResource(c.store.getAt(b))}else a.setResource(d.getAt(d.indexOf(a.getResource())-n))});c.fireEvent("eventdrop",c,[k].concat(l),!1)}this.tip&&this.tip.hide();if(g&&g.valid&&h){if(Ext.isIE9)this.proxy.el.setStyle("visibility","hidden"),Ext.Function.defer(this.onValidDrop,10,this,[e,a,b]);else this.onValidDrop(e,a,b);c.fireEvent("aftereventdrop",c)}else this.onInvalidDrop(e,a,b)},isValidDrop:function(a,
b,c){if(a===b||0===c.length)return!0;var d=this.schedulerView,e=!0,f,g=d.resourceStore,h,k=Ext.data.TreeStore&&g instanceof Ext.data.TreeStore;f=k?d.indexOf(a)-d.indexOf(b):g.indexOf(a)-g.indexOf(b);Ext.each(c,function(b){if(k){if(h=d.store.indexOf(a)-f,0>h||h>=d.store.getCount())return e=!1}else if(h=g.indexOf(a)-f,0>h||h>=g.getCount())return e=!1});return e},onInvalidDrop:function(){var a=this.schedulerView;this.tip&&this.tip.hide();Ext.each(this.dragData.eventEls,function(a){a.show()});this.callParent(arguments);
a.fireEvent("aftereventdrop",a)},resolveResource:function(a,b){var c=this.proxy.el.dom;c.style.display="none";var d=document.elementFromPoint(a[0]-this.dragData.bodyScroll.left,a[1]-this.dragData.bodyScroll.top);Ext.isIE8&&(b&&b.browserEvent.synthetic)&&(d=document.elementFromPoint(a[0]-this.dragData.bodyScroll.left,a[1]-this.dragData.bodyScroll.top));c.style.display="block";return!d?null:!d.className.match(this.schedulerView.timeCellCls)?(c=Ext.fly(d).up("."+this.schedulerView.timeCellCls))?(d=c.dom,
this.schedulerView.resolveResource(d)):null:this.schedulerView.resolveResource(d)}});
Ext.define("Sch.feature.DragDrop",{requires:["Ext.XTemplate","Sch.feature.PointDragZone","Sch.feature.DragZone","Sch.feature.DropZone"],validatorFn:function(a,b,c,d,e){return!0},enableCopy:!1,useDragProxy:!1,showTooltip:!0,constructor:function(a,b){Ext.apply(this,b);this.schedulerView=a;var c=!!document.elementFromPoint;!this.useDragProxy&&!this.dragConfig.useDragProxy&&c?this.initProxyLessDD():this.initProxyDD();this.schedulerView.on("destroy",this.cleanUp,this);this.callParent([b])},cleanUp:function(){this.schedulerView.dragZone&&
this.schedulerView.dragZone.destroy();this.schedulerView.dropZone&&this.schedulerView.dropZone.destroy();this.tip&&this.tip.destroy()},initProxyLessDD:function(){var a=this.schedulerView;a.dragZone=Ext.create("Sch.feature.PointDragZone",a.el,Ext.apply({ddGroup:a.id,schedulerView:a,enableCopy:this.enableCopy,validatorFn:this.validatorFn,validatorFnScope:this.validatorFnScope,showTooltip:this.showTooltip},this.dragConfig))},initProxyDD:function(){var a=this.schedulerView,b=a.el;a.dragZone=Ext.create("Sch.feature.DragZone",
b,Ext.apply({ddGroup:a.id,schedulerView:a,enableCopy:this.enableCopy},this.dragConfig));a.dropZone=Ext.create("Sch.feature.DropZone",b,Ext.apply({ddGroup:a.id,schedulerView:a,enableCopy:this.enableCopy,validatorFn:this.validatorFn,validatorFnScope:this.validatorFnScope},this.dropConfig))}});
Ext.define("Sch.feature.ResizeZone",{extend:"Ext.util.Observable",requires:["Ext.resizer.Resizer","Sch.tooltip.Tooltip"],showTooltip:!0,validatorFn:Ext.emptyFn,validatorFnScope:null,constructor:function(a){Ext.apply(this,a);var b=this.schedulerView;b.on({destroy:this.cleanUp,scope:this});b.mon(b.el,{mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,delegate:".sch-resizable-handle"});this.callParent(arguments)},onMouseDown:function(a,b){var c=this.schedulerView,d=this.eventRec=c.resolveEventRecord(b),
e=this.getHandlePosition(b),f=d.isResizable();!1===f||"string"===typeof f&&!b.className.match(f)||(this.eventRec=d,this.handlePos=e,c.el.on({mousemove:this.onMouseMove,scope:this,single:!0}))},onMouseUp:function(a,b){this.schedulerView.el.un({mousemove:this.onMouseMove,scope:this,single:!0})},onMouseMove:function(a,b){var c=this.schedulerView,d=this.eventRec;if(d&&!1!==c.fireEvent("beforeeventresize",c,d,a)){delete this.eventRec;a.stopEvent();var e=this.handlePos,f=Ext.get(c.getElementFromEventRecord(d));
this.resizer=this.createResizer(f,d,e,a,b);this.resizer.resizeTracker.onMouseDown(a,this.resizer[e].dom);this.showTooltip&&(this.tip||(this.tip=Ext.create("Sch.tooltip.Tooltip",{schedulerView:c,cls:"sch-resize-tip"})),this.tip.update(d.getStartDate(),d.getEndDate(),!0),this.tip.show(f));c.fireEvent("eventresizestart",c,d)}},getHandlePosition:function(a){return"horizontal"===this.schedulerView.getOrientation()?a.className.match("start")?"west":"east":a.className.match("start")?"north":"south"},createResizer:function(a,
b,c){var d=this.schedulerView,e=b.getResource(),f=d.getSnapPixelAmount(),g=d.getScheduleRegion(e,b),h=d.getDateConstraints(e,b);b={target:a,dateConstraints:h,resourceRecord:e,eventRecord:b,handles:c.substring(0,1),minHeight:a.getHeight(),constrainTo:g,listeners:{resizedrag:this.partialResize,resize:this.afterResize,scope:this}};"vertical"===d.getOrientation()?0<f&&Ext.apply(b,{minHeight:f,heightIncrement:f}):0<f&&Ext.apply(b,{minWidth:f,widthIncrement:f});d=Ext.create("Ext.resizer.Resizer",b);a.setStyle("z-index",
parseInt(a.getStyle("z-index"),10)+1);return d},getStartEndDates:function(a){a=this.resizer;var b=a.el,c=this.schedulerView,d,e;"w"===a.handles[0]||"n"===a.handles[0]?(e=a.eventRecord.getEndDate(),d=c.getDateFromXY([b.getLeft(),b.getTop()],"round")):(d=a.eventRecord.getStartDate(),e=c.getDateFromXY([b.getRight(),b.getBottom()],"round"));a.dateConstraints&&(d=Sch.util.Date.constrain(d,a.dateConstraints.start,a.dateConstraints.end),e=Sch.util.Date.constrain(e,a.dateConstraints.start,a.dateConstraints.end));
return{start:d,end:e}},partialResize:function(a,b,c,d){b=this.schedulerView;c=this.getStartEndDates(d.getXY());d=c.start;c=c.end;if(d&&c&&!(0===a.start-d&&0===a.end-c)){var e=!1!==this.validatorFn.call(this.validatorFnScope||this,a.resourceRecord,a.eventRecord,d,c);a.end=c;a.start=d;b.fireEvent("eventpartialresize",b,a.eventRecord,d,c,a.el);this.showTooltip&&this.tip.update(d,c,e)}},afterResize:function(a,b,c,d){this.showTooltip&&this.tip.hide();b=a.resourceRecord;c=a.eventRecord;var e=c.getStartDate(),
f=c.getEndDate(),g=a.start||e;a=a.end||f;var h=this.schedulerView;g&&a&&0<a-g&&(0!==g-e||0!==a-f)&&!1!==this.validatorFn.call(this.validatorFnScope||this,b,c,g,a,d)?c.setStartEndDate(g,a):h.refreshKeepingScroll();this.resizer.destroy();h.fireEvent("eventresizeend",h,c)},cleanUp:function(){this.tip&&this.tip.destroy()}});Ext.define("Sch.feature.Scheduling",{extend:"Ext.grid.feature.Feature",alias:"feature.scheduling",getMetaRowTplFragments:function(){return{embedRowAttr:function(){return'style\x3d"height:{rowHeight}px"'}}}});
Ext.define("Sch.column.Time",{extend:"Ext.grid.column.Column",alias:"timecolumn",draggable:!1,groupable:!1,hideable:!1,sortable:!1,fixed:!0,align:"center",tdCls:"sch-timetd",menuDisabled:!0,initComponent:function(){this.addEvents("timeheaderdblclick");this.enableBubble("timeheaderdblclick");this.callParent()},initRenderData:function(){this.renderData.headerCls=this.renderData.headerCls||this.headerCls;return this.callParent(arguments)},onElDblClick:function(a,b){this.callParent(arguments);this.fireEvent("timeheaderdblclick",
this,this.startDate,this.endDate,a)}},function(){Sch.column.Time.prototype.renderTpl=Sch.column.Time.prototype.renderTpl.replace("column-header-inner","column-header-inner sch-timeheader {headerCls}")});Ext.define("Sch.column.Resource",{extend:"Ext.grid.Column",alias:"widget.resourcecolumn",cls:"sch-resourcecolumn-header",align:"center",menuDisabled:!0,hideable:!1,sortable:!1,initComponent:function(){this.callParent(arguments);this.minWidth=void 0}});
Ext.define("Sch.column.timeAxis.Horizontal",{extend:"Ext.grid.column.Column",alias:"widget.timeaxiscolumn",requires:["Ext.Date","Ext.XTemplate","Sch.column.Time","Sch.preset.Manager"],cls:"sch-timeaxiscolumn",timeAxis:null,renderTpl:'\x3cdiv id\x3d"{id}-titleEl" class\x3d"'+Ext.baseCSSPrefix+'column-header-inner"\x3e\x3cspan id\x3d"{id}-textEl" style\x3d"display:none" class\x3d"'+Ext.baseCSSPrefix+'column-header-text"\x3e\x3c/span\x3e\x3ctpl if\x3d"topHeaderCells"\x3e{topHeaderCells}\x3c/tpl\x3e\x3ctpl if\x3d"middleHeaderCells"\x3e{middleHeaderCells}\x3c/tpl\x3e\x3c/div\x3e{%this.renderContainer(out,values)%}',
headerRowTpl:'\x3ctable border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" style\x3d"{tstyle}" class\x3d"sch-header-row sch-header-row-{position}"\x3e\x3cthead\x3e\x3ctr\x3e{cells}\x3c/tr\x3e\x3c/thead\x3e\x3c/table\x3e',headerCellTpl:'\x3ctpl for\x3d"."\x3e\x3ctd class\x3d"sch-column-header x-column-header {headerCls}" style\x3d"position : static; text-align: {align}; {style}" tabIndex\x3d"0" id\x3d"{headerId}" headerPosition\x3d"{position}" headerIndex\x3d"{index}"\x3e\x3cdiv class\x3d"x-column-header-inner"\x3e{header}\x3c/div\x3e\x3c/td\x3e\x3c/tpl\x3e',
columnConfig:{},timeCellRenderer:null,timeCellRendererScope:null,columnWidth:null,previousWidth:null,previousHeight:null,initComponent:function(){this.headerRowTpl instanceof Ext.Template||(this.headerRowTpl=Ext.create("Ext.XTemplate",this.headerRowTpl));this.headerCellTpl instanceof Ext.Template||(this.headerCellTpl=Ext.create("Ext.XTemplate",this.headerCellTpl));this.columns=[{}];this.addEvents("timeheaderdblclick","timeaxiscolumnreconfigured");this.enableBubble("timeheaderdblclick");this.stubForResizer=
new Ext.Component({isOnLeftEdge:function(){return!1},isOnRightEdge:function(){return!1},el:{dom:{style:{}}}});this.callParent(arguments);this.onTimeAxisReconfigure();this.mon(this.timeAxis,"reconfigure",this.onTimeAxisReconfigure,this)},getSchedulingView:function(){return this.getOwnerHeaderCt().view},onTimeAxisReconfigure:function(){var a=this.timeAxis,b=a.preset.timeColumnWidth,c=this.rendered&&this.getSchedulingView(),d=a.headerConfig;a.getStart();a.getEnd();a={renderer:this.timeColumnRenderer,
scope:this,width:this.rendered?c.calculateTimeColumnWidth(b):b};delete this.previousWidth;delete this.previousHeight;d=this.columnConfig=this.createColumns(this.timeAxis,d,a);Ext.suspendLayouts();this.removeAll();this.rendered&&(a=this.el.child(".x-column-header-inner"),a.select("table").remove(),b=this.initRenderData(),d.top&&Ext.core.DomHelper.append(a,b.topHeaderCells),d.middle&&Ext.core.DomHelper.append(a,b.middleHeaderCells),!d.top&&!d.middle?this.addCls("sch-header-single-row"):this.removeCls("sch-header-single-row"));
Ext.resumeLayouts();this.add(d.bottom);this.rendered&&!1!==this.fireEvent("timeaxiscolumnreconfigured",this)&&c.refresh()},beforeRender:function(){var a=this.columnConfig;!a.middle&&!a.top&&this.addCls("sch-header-single-row");this.callParent(arguments)},timeColumnRenderer:function(a,b,c,d,e,f,g){a="";Ext.isIE&&(b.style+=";z-index:"+(this.items.getCount()-e));this.timeCellRenderer&&(a=this.timeAxis.getAt(e),a=this.timeCellRenderer.call(this.timeCellRendererScope||this,b,c,d,e,f,a.start,a.end));return a},
initRenderData:function(){var a=this.columnConfig,b=a.top?this.headerRowTpl.apply({cells:this.headerCellTpl.apply(a.top),position:"top",tstyle:"border-top : 0; width : 100px"}):"",a=a.middle?this.headerRowTpl.apply({cells:this.headerCellTpl.apply(a.middle),position:"middle",tstyle:a.top?"width : 100px":"border-top : 0; width : 100px"}):"";return Ext.apply(this.callParent(arguments),{topHeaderCells:b,middleHeaderCells:a})},defaultRenderer:function(a,b,c){return Ext.Date.format(a,c)},createColumns:function(a,
b,c){if(!a||!b)throw"Invalid parameters passed to createColumns";var d=[],e=b.bottom||b.middle,f,g=this;a.forEachInterval(b.bottom?"bottom":"middle",function(a,b,l){f={align:e.align||"center",headerCls:"",startDate:a,endDate:b};f.header=e.renderer?e.renderer.call(e.scope||g,a,b,f,l):g.defaultRenderer(a,b,e.dateFormat);d[d.length]=Ext.create("Sch.column.Time",Ext.apply(f,c))});a=this.createHeaderRows(a,b);return{bottom:d,middle:a.middle,top:a.top}},createHeaderRows:function(a,b){var c={};if(b.top){var d;
d=b.top.cellGenerator?b.top.cellGenerator.call(this,a.getStart(),a.getEnd()):this.createHeaderRow(a,b.top);c.top=this.processHeaderRow(d,"top")}b.bottom&&(d=b.middle.cellGenerator?b.middle.cellGenerator.call(this,a.getStart(),a.getEnd()):this.createHeaderRow(a,b.middle),c.middle=this.processHeaderRow(d,"middle"));return c},processHeaderRow:function(a,b){var c=this;Ext.each(a,function(a,e){a.index=e;a.position=b;a.headerId=c.stubForResizer.id});return a},createHeaderRow:function(a,b){var c=[],d;d=
a.getStart();for(var e=a.getEnd(),f=d,g=0,h=b.align||"center",k;f<e;)k=Sch.util.Date.min(a.getNext(f,b.unit,b.increment||1),e),d={align:h,start:f,end:k,headerCls:""},d.header=b.renderer?b.renderer.call(b.scope||this,f,k,d,g):this.defaultRenderer(f,k,b.dateFormat,d,g),c.push(d),f=k,g++;return c},afterLayout:function(){delete this.columnWidth;this.callParent(arguments);var a=this.getWidth(),b=this.getHeight();if(!(a===this.previousWidth&&b===this.previousHeight)){this.previousWidth=a;this.previousHeight=
b;var a=this.columnConfig,c=this,b=this.el,d=a.top;d&&(b.select(".sch-header-row-top").setWidth(this.lastBox.width),b.select(".sch-header-row-top td").each(function(a,b,e){b=c.getHeaderGroupCellWidth(d[e].start,d[e].end);a.setVisibilityMode(Ext.Element.DISPLAY);b?(a.show(),a.setWidth(b)):a.hide()}));var e=a.middle;e&&(b.select(".sch-header-row-middle").setWidth(this.lastBox.width),b.select(".sch-header-row-middle td").each(function(a,b,d){b=c.getHeaderGroupCellWidth(e[d].start,e[d].end);a.setVisibilityMode(Ext.Element.DISPLAY);
b?(a.show(),a.setWidth(b)):a.hide()}))}},getHeaderGroupCellWidth:function(a,b){var c=this.timeAxis.increment,d=Sch.util.Date.getMeasuringUnit(this.timeAxis.unit),e=Sch.util.Date.getDurationInUnit(a,b,d),f=this.getSchedulingView();return this.timeAxis.isContinuous()?e*f.getSingleUnitInPixels(d)/c:f.getXYFromDate(b)[0]-f.getXYFromDate(a)[0]},onElDblClick:function(a,b){this.callParent(arguments);var c=a.getTarget(".sch-column-header");if(c){var d=Ext.fly(c).getAttribute("headerPosition"),c=Ext.fly(c).getAttribute("headerIndex"),
d=this.columnConfig[d][c];this.fireEvent("timeheaderdblclick",this,d.start,d.end,a)}},getTimeColumnWidth:function(){null===this.columnWidth&&(this.columnWidth=this.items.get(0).getWidth());return this.columnWidth},setTimeColumnWidth:function(a){this.suspendEvents();this.items.each(function(b){b.setWidth(a)});this.resumeEvents()}});
Ext.define("Sch.column.timeAxis.HorizontalSingle",{extend:"Sch.column.Time",alias:"widget.singletimeaxiscolumn",requires:["Ext.Date","Ext.XTemplate","Sch.preset.Manager"],cls:"sch-simple-timeaxis",timeAxis:null,trackHeaderOver:!0,compactCellWidthThreshold:16,renderTpl:'\x3cdiv id\x3d"{id}-titleEl" class\x3d"'+Ext.baseCSSPrefix+'column-header-inner"\x3e\x3cspan id\x3d"{id}-textEl" style\x3d"display:none" class\x3d"'+Ext.baseCSSPrefix+'column-header-text"\x3e\x3c/span\x3e\x3ctpl if\x3d"topHeaderCells"\x3e{topHeaderCells}\x3c/tpl\x3e\x3ctpl if\x3d"middleHeaderCells"\x3e{middleHeaderCells}\x3c/tpl\x3e\x3ctpl if\x3d"bottomHeaderCells"\x3e{bottomHeaderCells}\x3c/tpl\x3e\x3c/div\x3e{%this.renderContainer(out,values)%}',
headerRowTpl:'\x3ctable border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" style\x3d"{tstyle}" class\x3d"sch-header-row sch-header-row-{position}"\x3e\x3cthead\x3e\x3ctr\x3e\x3ctpl for\x3d"cells"\x3e\x3ctd class\x3d"sch-column-header x-column-header {headerCls}" style\x3d"position : static; text-align: {align}; {style}" tabIndex\x3d"0" id\x3d"{headerId}" headerPosition\x3d"{parent.position}" headerIndex\x3d"{[xindex-1]}"\x3e\x3cdiv class\x3d"sch-simple-timeheader"\x3e{header}\x3c/div\x3e\x3c/td\x3e\x3c/tpl\x3e\x3c/tr\x3e\x3c/thead\x3e\x3c/table\x3e',
columnConfig:{},columnWidth:null,nbrTimeColumns:null,initComponent:function(){this.tdCls+=" sch-singletimetd";this.headerRowTpl instanceof Ext.Template||(this.headerRowTpl=Ext.create("Ext.XTemplate",this.headerRowTpl));this.addEvents("timeheaderdblclick","timeaxiscolumnreconfigured");this.enableBubble("timeheaderdblclick");this.callParent(arguments);this.onTimeAxisReconfigure();this.mon(this.timeAxis,"reconfigure",this.onTimeAxisReconfigure,this);this.on("resize",this.refreshHeaderSizes,this);this.ownHoverCls=
this.hoverCls;this.hoverCls=""},getSchedulingView:function(){return this.getOwnerHeaderCt().view},onTimeAxisReconfigure:function(){var a=this.timeAxis,b=a.preset.timeColumnWidth,c=this.rendered&&this.getSchedulingView(),d=a.headerConfig;a.getStart();a.getEnd();a=this.rendered?c.calculateTimeColumnWidth(b):b;d=this.columnConfig=this.createHeaderRows(d);b=d.bottom||d.middle;if(this.rendered){var e,f=this.el.child(".x-column-header-inner"),g=f.dom,h=g.style.display,k=g.parentNode;g.style.display="none";
k.removeChild(g);g.innerHTML="";var l=this.initRenderData();d.top&&(e=Ext.core.DomHelper.append(f,l.topHeaderCells),this.refreshHeaderRow("top",e));d.middle&&(e=Ext.core.DomHelper.append(f,l.middleHeaderCells),this.refreshHeaderRow("middle",e));d.bottom&&(e=Ext.core.DomHelper.append(f,l.bottomHeaderCells),this.refreshHeaderRow("bottom",e));!d.top&&!d.middle?this.addCls("sch-header-single-row"):this.removeCls("sch-header-single-row");k.appendChild(g);g.style.display=h;if(a!==this.columnWidth||this.nbrTimeColumns!==
b.length)this.nbrTimeColumns=b.length,this.setTimeColumnWidth(a);!1!==this.fireEvent("timeaxiscolumnreconfigured",this)&&c.refreshKeepingResourceScroll(!0)}else if(a!==this.columnWidth||this.nbrTimeColumns!==b.length)this.nbrTimeColumns=b.length,this.setTimeColumnWidth(a)},beforeRender:function(){var a=this.columnConfig;!a.middle&&!a.top&&this.addCls("sch-header-single-row");this.callParent(arguments)},afterRender:function(){this.trackHeaderOver&&(this.el.on({mousemove:this.highlightCell,delegate:"div.sch-simple-timeheader",
scope:this}),this.el.on({mouseleave:this.clearHighlight,scope:this}));this.callParent(arguments)},initRenderData:function(){var a=this.columnConfig,b=a.top?this.headerRowTpl.apply({cells:a.top,position:"top",tstyle:"border-top : 0; width : 100px"}):"",c=a.middle?this.headerRowTpl.apply({cells:a.middle,position:"middle",tstyle:a.top?"width : 100px":"border-top : 0; width : 100px"}):"",a=a.bottom?this.headerRowTpl.apply({cells:a.bottom,position:"bottom",tstyle:"width : 100px"}):"";return Ext.apply(this.callParent(arguments),
{topHeaderCells:b,middleHeaderCells:c,bottomHeaderCells:a})},defaultRenderer:function(a,b,c){return Ext.Date.format(a,c)},createHeaderRows:function(a){var b={},c;for(c in a)b[c]=a[c].cellGenerator?a[c].cellGenerator.call(this,this.timeAxis.getStart(),this.timeAxis.getEnd()):this.createHeaderRow(c,a[c]);return b},createHeaderRow:function(a,b){var c=[],d=this,e,f=b.align||"center";this.timeAxis.forEachInterval(a,function(a,h,k){e={align:f,start:a,end:h,headerCls:""};e.header=b.renderer?b.renderer.call(b.scope||
d,a,h,e,k):d.defaultRenderer(a,h,b.dateFormat,e,k);if(b.unit===Sch.util.Date.DAY&&(!b.increment||1===b.increment))e.headerCls+=" sch-dayheadercell-"+a.getDay();c.push(e)});return c},afterLayout:function(){this.callParent(arguments);this.refreshHeaderSizes()},refreshHeaderSizes:function(){var a=this.columnConfig;a.top&&this.refreshHeaderRow("top");a.middle&&this.refreshHeaderRow("middle");a.bottom&&this.refreshHeaderRow("bottom")},refreshHeaderRow:function(a,b){var c=this.el,d=this.columnConfig[a],
e=this,f;b=b||c.down(".sch-header-row-"+a,!0);Ext.fly(b).setWidth(e.getTotalWidth());Ext.fly(b).select(" thead \x3e tr \x3e td").each(function(a,b,c){f=e.getHeaderGroupCellWidth(d[c].start,d[c].end);a.setVisibilityMode(Ext.Element.DISPLAY);f?(a.show(),a.setWidth(f-(19===Ext.chromeVersion?c?1:0:0))):a.hide()});"bottom"===a&&(f<this.compactCellWidthThreshold?Ext.fly(b).addCls("sch-header-row-compact"):Ext.fly(b).removeCls("sch-header-row-compact"))},getHeaderGroupCellWidth:function(a,b){var c=this.timeAxis.increment,
d=Sch.util.Date.getMeasuringUnit(this.timeAxis.unit),e=Sch.util.Date.getDurationInUnit(a,b,d),f=this.getSchedulingView();return this.timeAxis.isContinuous()?e*f.getSingleUnitInPixels(d)/c:f.getXYFromDate(b)[0]-f.getXYFromDate(a)[0]},onElDblClick:function(a,b){var c=a.getTarget(".sch-column-header");if(c){var d=Ext.fly(c).getAttribute("headerPosition"),c=Ext.fly(c).getAttribute("headerIndex"),d=this.columnConfig[d][c];this.fireEvent("timeheaderdblclick",this,d.start,d.end,a)}},getTimeColumnWidth:function(){null===
this.columnWidth&&(this.columnWidth=this.getWidth()/this.nbrTimeColumns);return this.columnWidth},setTimeColumnWidth:function(a){this.columnWidth=a;this.rendered?(Ext.suspendLayouts(),this.setWidth(a*this.nbrTimeColumns),Ext.resumeLayouts(),this.refreshHeaderSizes(),this.ownerCt.updateLayout()):this.setWidth(a*this.nbrTimeColumns)},getTotalWidth:function(){return this.columnWidth*this.nbrTimeColumns},highlightCell:function(a,b){b!==this.highlightedCell&&(this.clearHighlight(),this.highlightedCell=
b,Ext.fly(b).addCls(this.ownHoverCls))},clearHighlight:function(){var a=this.highlightedCell;a&&(Ext.fly(a).removeCls(this.ownHoverCls),delete this.highlightedCell)}});
Ext.define("Sch.column.timeAxis.Vertical",{extend:"Ext.grid.column.Column",alias:"widget.verticaltimeaxis",align:"right",draggable:!1,groupable:!1,hideable:!1,sortable:!1,menuDisabled:!0,dataIndex:"start",timeAxis:null,initComponent:function(){this.callParent(arguments);this.tdCls=(this.tdCls||"")+" sch-verticaltimeaxis-cell";this.scope=this},renderer:function(a,b,c){var d=this.timeAxis.headerConfig,d=d.bottom||d.middle;return d.renderer?d.renderer.call(d.scope||this,a,c.data.end,b,0):Ext.Date.format(a,
d.dateFormat)}});
Ext.define("Sch.mixin.Lockable",{extend:"Ext.grid.Lockable",requires:["Sch.column.timeAxis.Horizontal","Sch.column.timeAxis.HorizontalSingle"],findEditingPlugin:function(){var a=this.plugins||[],b;Ext.each(a,function(c,d){if(Ext.grid.plugin&&Ext.grid.plugin.CellEditing&&c instanceof Ext.grid.plugin.CellEditing)return b=c,Ext.Array.remove(a,c),!1});return b},processSchedulerPlugins:function(){for(var a=[],b=[],c=[],d=this.plugins||[],e=d.length-1;0<=e;e--){var f=d[e];if(f.lockableScope){switch(f.lockableScope){case "top":c.push(f);break;
case "locked":a.push(f);break;case "normal":b.push(f)}Ext.Array.remove(d,f)}}0<a.length&&(this.lockedGridConfig.plugins=(this.lockedGridConfig.plugins||[]).concat(a));0<b.length&&(this.normalGridConfig.plugins=(this.normalGridConfig.plugins||[]).concat(b));this.topPlugins=c},injectLockable:function(){var a=this.findEditingPlugin(),b=this,c=Ext.data.TreeStore&&b.store instanceof Ext.data.TreeStore,d=b.store.buffered,e=b.getEventSelectionModel?b.getEventSelectionModel():b.getSelectionModel();b.lockedGridConfig=
b.lockedGridConfig||{};b.normalGridConfig=b.schedulerConfig||b.normalGridConfig||{};var f=b.lockedGridConfig,g=b.normalGridConfig;Ext.applyIf(b.lockedGridConfig,{enableLocking:!1,lockable:!1,useArrows:!0,xtype:b.lockedXType,columnLines:b.columnLines,rowLines:b.rowLines,stateful:b.stateful,id:b.id+"_locked",delayScroll:function(){if(this.rendered)return this.self.prototype.delayScroll.apply(this,arguments)},split:!0,animCollapse:!1,collapseDirection:"left",region:"west"});a&&(b.lockedGridConfig.plugins=
(b.lockedGridConfig.plugins||[]).concat(a));b.processSchedulerPlugins();Ext.applyIf(b.normalGridConfig,{layout:"fit",xtype:b.normalXType,viewType:b.viewType,enableLocking:!1,lockable:!1,sortableColumns:!1,enableColumnMove:!1,enableColumnResize:!1,enableColumnHide:!1,selModel:e,eventSelModel:e,_top:b,orientation:b.orientation,viewPreset:b.viewPreset,timeAxis:b.timeAxis,columnLines:b.columnLines,rowLines:b.rowLines,collapseDirection:"right",animCollapse:!1,region:"center"});b.bothCfgCopy=b.bothCfgCopy||
Ext.grid.Panel&&Ext.grid.Panel.prototype.bothCfgCopy||"invalidateScrollerOnRefresh hideHeaders enableColumnHide enableColumnMove enableColumnResize sortableColumns".split(" ");"vertical"===b.orientation&&(f.store=g.store=b.timeAxis.tickStore,b.mon(b.resourceStore,{clear:b.refreshResourceColumns,datachanged:b.refreshResourceColumns,load:b.refreshResourceColumns,scope:b}));f.width&&(b.syncLockedWidth=Ext.emptyFn,f.scroll="horizontal",f.scrollerOwner=!0);b.resourceStore&&(g.resourceStore=b.resourceStore);
b.eventStore&&(g.eventStore=b.eventStore);b.dependencyStore&&(g.dependencyStore=b.dependencyStore);b.lockedViewConfig=b.lockedViewConfig||{};b.normalViewConfig=b.normalViewConfig||{};c&&(d&&0===Ext.getScrollbarSize().width)&&(b.lockedGridConfig.scroll=!1);b.lockedViewConfig.enableAnimations=b.normalViewConfig.enableAnimations=!1;c&&(b.normalViewConfig.providedStore=b.lockedViewConfig.providedStore=b.createNodeStore(d,b.store));a=b.layout;this.callParent(arguments);b.topPlugins&&(b.plugins=b.topPlugins);
f.width?(b.lockedGrid.setWidth(f.width),b.normalGrid.getView().addCls("sch-timeline-horizontal-scroll")):b.normalGrid.collapsed&&(b.normalGrid.collapsed=!1,b.normalGrid.view.on("boxready",function(){b.normalGrid.collapse()},b,{delay:10}));f=b.lockedGrid.getView();e=b.normalGrid.getView();if(d&&(f.on("render",this.onLockedViewRender,this),this.fixPagingScroller(b.normalGrid.verticalScroller),0<Ext.getScrollbarSize().width))f.on({scroll:{fn:b.onLockedViewScroll,element:"el",scope:b}});0===Ext.getScrollbarSize().width&&
f.addCls("sch-ganttpanel-force-locked-scroll");c&&this.setupLockableTree();if(!e.deferInitialRefresh){var h=e.onRender;e.onRender=function(){this.doFirstRefresh=function(){};h.apply(this,arguments);delete this.doFirstRefresh}}d&&(e.el={un:function(){}},b.normalGrid.verticalScroller.bindView(e),delete e.el);b.view.clearListeners();f.on({itemadd:b.onViewItemAdd,refresh:b.updateSpacer,scope:b});b.view=Ext.create("Sch.view.Locking",{locked:b.lockedGrid,normal:b.normalGrid,panel:b});b.syncRowHeight&&(f.on("refresh",
this.onLockedViewRefresh,this),e.on({itemadd:b.onViewItemAdd,itemupdate:b.onNormalViewItemUpdate,groupexpand:b.onNormalViewGroupExpand,scope:b}),Ext.isIE9&&Ext.isStrict&&(b.onNormalViewItemUpdate=function(a,c,d){if(b.lockedGridDependsOnSchedule){var e=b.lockedGrid.getView();e.suspendEvents();e.onUpdate(b.lockedGrid.store,a);e.resumeEvents()}b.normalGrid.getView().getNode(c).style.height=d.style.height;b.normalHeights[c]=d.style.height;b.syncRowHeights()}));"fit"!==a&&(b.layout=a);b.normalGrid.on({collapse:b.onNormalGridCollapse,
expand:b.onNormalGridExpand,scope:b});b.lockedGrid.on({collapse:b.onLockedGridCollapse,scope:b});this.lockedGrid.view.store!==this.normalGrid.view.store&&Ext.Error.raise("Sch.mixin.lockable setup failed, not sharing store between the two views")},onLockedGridCollapse:function(){this.normalGrid.collapsed&&this.normalGrid.expand()},onNormalGridCollapse:function(){this.normalGrid.reExpander||(this.normalGrid.reExpander=this.normalGrid.placeholder);if(this.lockedGrid.rendered)this.lastLockedWidth=this.lockedGrid.getWidth(),
this.lockedGrid.setWidth(this.getWidth()-35),this.lockedGrid.collapsed&&this.lockedGrid.expand(),this.addCls("sch-normalgrid-collapsed");else this.lockedGrid.on("render",this.onNormalGridCollapse,this,{delay:1})},onNormalGridExpand:function(){this.removeCls("sch-normalgrid-collapsed");this.lockedGrid.setWidth(this.lastLockedWidth)},fixPagingScroller:function(a){var b=a.onViewRefresh;a.onViewRefresh=function(){b.apply(this,arguments);var a=this.store;(a.getCount()===a.getTotalCount()||a.isFiltered()&&
!a.remoteFilter)&&this.stretcher.setHeight(this.getScrollHeight())};var c=a.view.lockingPartner;if(c){var d=a.onLockRefresh,e=function(a){a.table.dom&&d.apply(this,arguments)};c.un("refresh",d,a);c.on("refresh",e,a);a.onLockRefresh=e}a.view.un("render",a.onViewRender,a);a.onViewRender=function(){var a=this.view.el;a.setStyle("position","relative");this.stretcher=a.createChild({style:{position:"absolute",width:"1px",height:0,top:0,left:0}},a.dom.firstChild)};a.view.on("render",a.onViewRender,a)},createNodeStore:function(a,
b){return new Ext.data.NodeStore({buffered:a,purgePageCount:0,pageSize:1E10,treeStore:b,recursive:!0,refreshFromTree:function(){var a=this.eventsSuspended;this.suspendEvents();this.removeAll();var d=b.getRootNode(),e=[],f=function(a){a!=d&&(e[e.length]=a);if(a.isExpanded()){a=a.childNodes;for(var b=a.length,c=0;c<b;c++)f(a[c])}};f(d);this.totalCount=e.length;this.cachePage(e,1);(Ext.isNumber(this.eventsSuspended)||!a)&&this.resumeEvents()}})},setupLockableTree:function(){var a,b=this,c=b.store.buffered,
d=b.getView(),e=b.lockedGrid.getView(),f=b.normalGrid.getView(),g=f.store,h=b.store,k=b.normalGrid.verticalScroller,l=function(a,b){var c=h.viewSize||50,d=g.getTotalCount();if(d){var e=b-a+1;e<c&&d>=e&&(b=a+c-1);b>=d&&(a=d-(b-a),b=d-1,a=Math.max(0,a));g.guaranteeRange(a,b)}};this.mon(h,"root-fill-start",function(){a=!0;g.suspendEvents();c&&g.setNode()});this.mon(h,"root-fill-end",function(){a=!1;c?(g.refreshFromTree(),g.resumeEvents(),l(0,h.viewSize||50)):(g.resumeEvents(),d.refresh())});if(c){var p,
m;this.mon(g,"guaranteedrange",function(a,b,c){p=b;m=c});var n=function(){if(!a&&(g.refreshFromTree(),l(p||0,m||50),f.rendered))b.onNormalViewScroll()};this.mon(h,{append:n,insert:n,remove:n,move:n,expand:n,collapse:n,sort:n,buffer:1})}this.mon(h,"filter",function(a,b){g.filter.apply(g,b);d.refresh()});this.mon(h,"clearfilter",function(a){g.clearFilter();d.refresh()});this.mon(h,"beforecascade",function(a){g.suspendEvents()});this.mon(h,"cascade",function(a,b){g.resumeEvents();0<b.nbrAffected&&(f.refreshKeepingScroll(!0),
setTimeout(function(){e.saveScrollState();e.refresh();e.restoreScrollState()},0))});if(c&&k){var q=k.onGuaranteedRange;k.onGuaranteedRange=function(){q.apply(this,arguments);Ext.suspendLayouts();d.refresh();Ext.resumeLayouts()}}},onNormalViewItemUpdate:function(a,b,c){if(this.lockedGridDependsOnSchedule){var d=this.lockedGrid.getView();d.suspendEvents();d.onUpdate(this.lockedGrid.store,a);d.resumeEvents()}a=this.normalGrid.getView().getNode(b);d=a.style.height!==c.style.height;a.style.height=c.style.height;
this.normalHeights[b]=c.style.height;this.syncRowHeights(d)},onViewItemAdd:function(a,b,c){var d=this.normalHeights,e=this.normalGrid.getView();Ext.each(a,function(a,b){var c=e.getNode(a);c&&(d[c.viewIndex]=c.style.height)});this.syncRowHeights()},processColumns:function(a){var b=this.callParent(arguments),c=[];Ext.each(a,function(a){"right"==a.position&&(a.processed=!0,Ext.isNumber(a.width)||Ext.Error.raise('"Right" columns must have a fixed width'),c.push(a),Ext.Array.remove(b.locked.items,a),b.lockedWidth-=
a.width)});"horizontal"===this.orientation?b.normal.items=[{xtype:this.lightWeight?"singletimeaxiscolumn":"timeaxiscolumn",timeAxis:this.timeAxis,timeCellRenderer:this.timeCellRenderer,timeCellRendererScope:this.timeCellRendererScope,trackHeaderOver:this.trackHeaderOver}].concat(c):(b.locked.items=[Ext.apply({xtype:"verticaltimeaxis",width:100,timeAxis:this.timeAxis},this.timeAxisColumnCfg||{})],b.lockedWidth=b.locked.items[0].width);return b},prepareFullRowHeightSync:function(){var a=this.normalGrid.getView(),
b=this.lockedGrid.getView();if(a.rendered&&b.rendered){var c=b.el,a=a.el.query(a.getItemSelector()),b=c.query(b.getItemSelector()),c=a.length,d=0;this.lockedHeights=[];this.normalHeights=[];if(b.length===c)for(;d<c;d++)this.normalHeights[d]=a[d].style.height}},onLockedViewRefresh:function(){this.prepareFullRowHeightSync();this.syncRowHeights()},onNormalViewRefresh:function(){var a=this.lockedGrid.getView();this.lockedGridDependsOnSchedule&&(a.un("refresh",this.onLockedViewRefresh,this),this.lockedGrid.getView().refresh(),
a.on("refresh",this.onLockedViewRefresh,this));this.prepareFullRowHeightSync();this.syncRowHeights()},syncRowHeights:function(a){if(this.lockedGrid.getView().rendered&&this.normalGrid.getView().rendered){var b=this.lockedHeights,c=this.normalHeights,d=b.length||c.length,e=0,f;if(b.length||c.length){b=this.lockedGrid.getView();f=this.normalGrid.getView();if(!b.rendered||!f.rendered)return;b=b.el.query(b.getItemSelector());if(!b.length)return;for(;e<d;e++)b[e]&&c[e]&&(b[e].style.height=c[e]);this.lockedHeights=
[];this.normalHeights=[]}!1!==a&&this.updateSpacer()}},getMenuItems:function(){return function(){return Ext.grid.header.Container.prototype.getMenuItems.call(this)}},applyColumnsState:Ext.emptyFn,updateSpacer:function(){var a=this.lockedGrid.getView(),b=this.normalGrid.getView();if(a.rendered&&b.rendered&&a.el.child("table")&&!this.getSchedulingView().__lightRefresh){var a=a.el,c=b.el.dom,b=a.dom.id+"-spacer",c=c.offsetHeight-c.clientHeight+"px";(this.spacerEl=Ext.getDom(b))?this.spacerEl.style.height=
c:(a=this.store.buffered?this.normalGrid.verticalScroller.stretcher.item(0).dom.parentNode===a.dom?this.normalGrid.verticalScroller.stretcher.item(0):this.normalGrid.verticalScroller.stretcher.item(1):a,Ext.core.DomHelper.append(a,{id:b,cls:this.store.buffered?"sch-locked-buffered-spacer":"",style:"height: "+c}))}},onLockedViewRender:function(){var a=this.normalGrid;if(!this.lockedStretcher){var b=this.lockedGrid.getView().el;this.lockedStretcher=b.createChild({cls:"x-stretcher",style:{position:"absolute",
width:"1px",height:0,top:0,left:0}},b.dom.firstChild)}if(a.rendered)a.getView().el.un("scroll",this.onNormalViewScroll,this),a.getView().el.on("scroll",this.onNormalViewScroll,this),a=a.verticalScroller,a.stretcher.addCls("x-stretcher"),a.stretcher=new Ext.dom.CompositeElement([this.lockedStretcher,a.stretcher]);else a.getView().on("render",this.onLockedViewRender,this)},onNormalViewGroupExpand:function(){this.prepareFullRowHeightSync();this.syncRowHeights()}});
Ext.define("Sch.model.Customizable",{extend:"Ext.data.Model",customizableFields:null,onClassExtended:function(a,b,c){var d=c.onBeforeCreated;c.onBeforeCreated=function(a,b){d.call(this,a,b);var c=a.prototype;if(c.customizableFields){c.customizableFields=(a.superclass.customizableFields||[]).concat(c.customizableFields);var h=c.customizableFields,k={};Ext.Array.each(h,function(a){"string"==typeof a&&(a={name:a});k[a.name]=a});var l=c.fields,p=[];l.each(function(a){a.isCustomizableField&&p.push(a)});
l.removeAll(p);Ext.Object.each(k,function(a,b){b.isCustomizableField=!0;var d=b.name,e="Id"===d?"idProperty":d.charAt(0).toLowerCase()+d.substr(1)+"Field",f=c[e]||d;l.containsKey(f)?(l.getByKey(f).isCustomizableField=!0,h.push(new Ext.data.Field(Ext.applyIf({name:d,isCustomizableField:!0},l.getByKey(f))))):l.add(new Ext.data.Field(Ext.applyIf({name:f,isCustomizableField:!0},b)));e=Ext.String.capitalize(d);if("Id"!=e){d="get"+e;e="set"+e;if(!c[d]||c[d].__getterFor__&&c[d].__getterFor__!=f)c[d]=function(){return this.data[f]},
c[d].__getterFor__=f;if(!c[e]||c[e].__setterFor__&&c[e].__setterFor__!=f)c[e]=function(a){return this.set(f,a)},c[e].__setterFor__=f}})}}},set:function(a,b){if(2===arguments.length){this.previous=this.previous||{};var c=this.get(a);c!==b&&(this.previous[a]=c)}this.callParent(arguments)},afterEdit:function(){this.callParent(arguments);delete this.previous},reject:function(){var a=this.modified,b;this.previous=this.previous||{};for(b in a)a.hasOwnProperty(b)&&"function"!=typeof a[b]&&(this.previous[b]=
this.get(b));this.callParent(arguments);delete this.previous}});Ext.define("Sch.patches.Model",{extend:"Sch.util.Patch",requires:"Sch.model.Customizable",reportURL:"http://www.sencha.com/forum/showthread.php?198250-4.1-Ext.data.Model-regression",description:"In Ext 4.1 Models cannot be subclassed",maxVersion:"4.1.0",applyFn:function(){try{Ext.define("Sch.foo",{extend:"Ext.data.Model",fields:["a"]}),Ext.define("Sch.foo.Sub",{extend:"Sch.foo",fields:["a"]})}catch(a){Ext.data.Types.AUTO.convert=function(a){return a}}}});
Ext.define("Sch.model.Range",{extend:"Sch.model.Customizable",requires:["Sch.util.Date","Sch.patches.DataOperation"],startDateField:"StartDate",endDateField:"EndDate",nameField:"Name",clsField:"Cls",customizableFields:[{name:"StartDate",type:"date",dateFormat:"c"},{name:"EndDate",type:"date",dateFormat:"c"},{name:"Cls",type:"string"},{name:"Name",type:"string"}],setStartEndDate:function(a,b){this.beginEdit();this.set(this.startDateField,a);this.set(this.endDateField,b);this.endEdit()},getDates:function(){for(var a=
[],b=this.getEndDate(),c=Ext.Date.clearTime(this.getStartDate(),!0);c<b;c=Sch.util.Date.add(c,Sch.util.Date.DAY,1))a.push(c);return a},forEachDate:function(a,b){return Ext.each(this.getDates(),a,b)},isValid:function(){var a=this.callParent(arguments);if(a)var a=this.getStartDate(),b=this.getEndDate(),a=!a||!b||0<=b-a;return a},shift:function(a,b){this.setStartEndDate(Sch.util.Date.add(this.getStartDate(),a,b),Sch.util.Date.add(this.getEndDate(),a,b))}});
Ext.define("Sch.model.Event",{extend:"Sch.model.Range",idProperty:"Id",customizableFields:[{name:"Id"},{name:"ResourceId"},{name:"Draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"Resizable",persist:!1}],resourceIdField:"ResourceId",draggableField:"Draggable",resizableField:"Resizable",getResource:function(a){if(0<this.stores.length){var b=this.stores[0].resourceStore;a=a||this.get(this.resourceIdField);return Ext.data.TreeStore&&b instanceof Ext.data.TreeStore?b.getNodeById(a)||b.getRootNode().findChildBy(function(b){return b.internalId===
a}):b.getById(a)||b.data.map[a]}return null},setResource:function(a){this.set(this.resourceIdField,a instanceof Sch.model.Resource?a.getId()||a.internalId:a)},assign:function(a){this.setResource.apply(this,arguments)},unassign:function(a){},isDraggable:function(){return this.getDraggable()},isResizable:function(){return this.getResizable()},isPersistable:function(){return!this.getResource().phantom},forEachResource:function(a,b){for(var c=this.getResources(),d=0;d<c.length&&!1!==a.call(b||this,c[d]);d++);
}});Ext.define("Sch.model.Resource",{extend:"Sch.model.Customizable",idProperty:"Id",nameField:"Name",customizableFields:["Id",{name:"Name",type:"string"}],getEventStore:function(){return this.stores[0]&&this.stores[0].eventStore||this.parentNode&&this.parentNode.getEventStore()},getEvents:function(a){var b=[],c,d=this.getId()||this.internalId;a=a||this.getEventStore();for(var e=0,f=a.getCount();e<f;e++)c=a.getAt(e),c.data[c.resourceIdField]===d&&b.push(c);return b}});
Ext.define("Sch.data.EventStore",{extend:"Ext.data.Store",model:"Sch.model.Event",requires:["Sch.util.Date"],setResourceStore:function(a){this.resourceStore&&this.resourceStore.un({beforesync:this.onResourceStoreBeforeSync,write:this.onResourceStoreWrite,scope:this});if(this.resourceStore=a)a.on({beforesync:this.onResourceStoreBeforeSync,write:this.onResourceStoreWrite,scope:this})},onResourceStoreBeforeSync:function(a,b){var c=a.create;if(c)for(var d,e=c.length-1;0<=e;e--)d=c[e],d._phantomId=d.internalId},
onResourceStoreWrite:function(a,b){if(b.wasSuccessful()){var c=this,d=b.getRecords();Ext.each(d,function(a){a._phantomId&&!a.phantom&&c.each(function(b){b.getResourceId()===a._phantomId&&b.assign(a)})})}},isDateRangeAvailable:function(a,b,c,d){var e=!0,f=Sch.util.Date;this.each(function(g){if(f.intersectSpans(a,b,g.getStartDate(),g.getEndDate())&&d===g.getResource()&&(!c||c!==g))return e=!1});return e},getEventsInTimeSpan:function(a,b,c){if(!1!==c){var d=Sch.util.Date;return this.queryBy(function(c){var f=
c.getStartDate();c=c.getEndDate();return f&&c&&d.intersectSpans(f,c,a,b)})}return this.queryBy(function(c){var d=c.getStartDate();c=c.getEndDate();return d&&c&&0<=d-a&&0<=b-c})},getTotalTimeSpan:function(){var a=new Date(9999,0,1),b=new Date(0),c=Sch.util.Date;this.each(function(d){d.getStartDate()&&(a=c.min(d.getStartDate(),a));d.getEndDate()&&(b=c.max(d.getEndDate(),b))});a=a<new Date(9999,0,1)?a:null;b=b>new Date(0)?b:null;return{start:a||null,end:b||a||null}},getEventsForResource:function(a){for(var b=
[],c=a.getId()||a.internalId,d=0,e=this.getCount();d<e;d++)a=this.getAt(d),a.data[a.resourceIdField]===c&&b.push(a);return b},getClosestSuccessor:function(a,b){var c=Infinity,d=a.getEnd(),e,f;b=b||this.getRange();for(var g=0,h=b.length;g<h;g++)f=b[g].getStart()-d,0<=f&&f<c&&(e=b[g],c=f);return e}});Ext.define("Sch.data.mixin.ResourceStore",{});Ext.define("Sch.data.ResourceStore",{extend:"Ext.data.Store",model:"Sch.model.Resource",mixins:["Sch.data.mixin.ResourceStore"]});
Ext.define("Sch.data.ResourceTreeStore",{extend:"Ext.data.TreeStore",model:"Sch.model.Resource",mixins:["Sch.data.mixin.ResourceStore"]});
Ext.define("Sch.data.TimeAxis",{extend:"Ext.util.Observable",requires:["Ext.data.JsonStore","Sch.util.Date"],continuous:!0,autoAdjust:!0,constructor:function(a){Ext.apply(this,a);this.originalContinuous=this.continuous;this.addEvents("beforereconfigure","reconfigure");this.tickStore=new Ext.data.JsonStore({fields:["start","end"]});this.tickStore.on("datachanged",function(){this.fireEvent("reconfigure",this)},this);this.callParent(arguments)},reconfigure:function(a){Ext.apply(this,a);a=this.tickStore;
var b=this.generateTicks(this.start,this.end,this.unit,this.increment||1,this.mainUnit);!1!==this.fireEvent("beforereconfigure",this,this.start,this.end)&&(a.suspendEvents(!0),a.loadData(b),0===a.getCount()&&Ext.Error.raise("Invalid time axis configuration or filter, please check your input data."),a.resumeEvents())},setTimeSpan:function(a,b){this.reconfigure({start:a,end:b})},filterBy:function(a,b){this.continuous=!1;b=b||this;var c=this.tickStore;c.clearFilter(!0);c.suspendEvents(!0);c.filter([{filterFn:function(c,
e){return a.call(b,c.data,e)}}]);0===c.getCount()&&(Ext.Error.raise("Invalid time axis filter - no columns passed through the filter. Please check your filter method."),this.clearFilter());c.resumeEvents()},isContinuous:function(){return this.continuous&&!this.tickStore.isFiltered()},clearFilter:function(){this.continuous=this.originalContinuous;this.tickStore.clearFilter()},generateTicks:function(a,b,c,d){var e=[],f,g=Sch.util.Date,h=0;c=c||this.unit;d=d||this.increment;this.autoAdjust&&(a=this.floorDate(a||
this.getStart(),!1),b=this.ceilDate(b||g.add(a,this.mainUnit,this.defaultSpan),!1));for(;a<b;)f=this.getNext(a,c,d),c===g.HOUR&&(1<d&&0<e.length&&0===h)&&(h=e[e.length-1],h=(h.start.getHours()+d)%24-h.end.getHours(),0!==h&&(f=g.add(f,g.HOUR,h))),e.push({start:a,end:f}),a=f;return e},getTickFromDate:function(a){if(this.getStart()>a||this.getEnd()<a)return-1;var b=this.tickStore.getRange(),c,d,e;d=0;for(e=b.length;d<e;d++)if(c=b[d].data.end,a<=c)return b=b[d].data.start,d+(a>b?(a-b)/(c-b):0);return-1},
getDateFromTick:function(a,b){var c=this.tickStore.getCount();if(a===c)return this.getEnd();var d=Math.floor(a),c=a-d,d=this.getAt(d),c=Sch.util.Date.add(d.start,Sch.util.Date.MILLI,c*(d.end-d.start));b&&(c=this[b+"Date"](c));return c},getAt:function(a){return this.tickStore.getAt(a).data},getCount:function(){return this.tickStore.getCount()},getTicks:function(){var a=[];this.tickStore.each(function(b){a.push(b.data)});return a},getStart:function(){return Ext.Date.clone(this.tickStore.first().data.start)},
getEnd:function(){return Ext.Date.clone(this.tickStore.last().data.end)},roundDate:function(a){var b=Ext.Date.clone(a);a=this.getStart();var c=this.resolutionIncrement;switch(this.resolutionUnit){case Sch.util.Date.MILLI:b=Sch.util.Date.getDurationInMilliseconds(a,b);c*=Math.round(b/c);b=Sch.util.Date.add(a,Sch.util.Date.MILLI,c);break;case Sch.util.Date.SECOND:b=Sch.util.Date.getDurationInSeconds(a,b);c*=Math.round(b/c);b=Sch.util.Date.add(a,Sch.util.Date.MILLI,1E3*c);break;case Sch.util.Date.MINUTE:b=
Sch.util.Date.getDurationInMinutes(a,b);c*=Math.round(b/c);b=Sch.util.Date.add(a,Sch.util.Date.SECOND,60*c);break;case Sch.util.Date.HOUR:b=Sch.util.Date.getDurationInHours(this.getStart(),b);c*=Math.round(b/c);b=Sch.util.Date.add(a,Sch.util.Date.MINUTE,60*c);break;case Sch.util.Date.DAY:b=Sch.util.Date.getDurationInDays(a,b);c*=Math.round(b/c);b=Sch.util.Date.add(a,Sch.util.Date.DAY,c);break;case Sch.util.Date.WEEK:Ext.Date.clearTime(b);a=b.getDay()-this.weekStartDay;0>a&&(a=7+a);a=1===Math.round(a/
7)?7-a:-a;b=Sch.util.Date.add(b,Sch.util.Date.DAY,a);break;case Sch.util.Date.MONTH:b=Sch.util.Date.getDurationInMonths(a,b)+b.getDate()/Ext.Date.getDaysInMonth(b);c*=Math.round(b/c);b=Sch.util.Date.add(a,Sch.util.Date.MONTH,c);break;case Sch.util.Date.QUARTER:Ext.Date.clearTime(b);b.setDate(1);b=Sch.util.Date.add(b,Sch.util.Date.MONTH,3-b.getMonth()%3);break;case Sch.util.Date.YEAR:b=Sch.util.Date.getDurationInYears(a,b),c*=Math.round(b/c),b=Sch.util.Date.add(a,Sch.util.Date.YEAR,c)}return b},floorDate:function(a,
b){b=!1!==b;var c=Ext.Date.clone(a),d=b?this.getStart():null,e=this.resolutionIncrement;switch(b?this.resolutionUnit:this.mainUnit){case Sch.util.Date.MILLI:b&&(c=Sch.util.Date.getDurationInMilliseconds(d,c),c=Sch.util.Date.add(d,Sch.util.Date.MILLI,Math.floor(c/e)*e));break;case Sch.util.Date.SECOND:b?(c=Sch.util.Date.getDurationInSeconds(d,c),c=Sch.util.Date.add(d,Sch.util.Date.MILLI,1E3*Math.floor(c/e)*e)):c.setMilliseconds(0);break;case Sch.util.Date.MINUTE:b?(c=Sch.util.Date.getDurationInMinutes(d,
c),c=Sch.util.Date.add(d,Sch.util.Date.SECOND,60*Math.floor(c/e)*e)):(c.setSeconds(0),c.setMilliseconds(0));break;case Sch.util.Date.HOUR:b?(c=Sch.util.Date.getDurationInHours(this.getStart(),c),c=Sch.util.Date.add(d,Sch.util.Date.MINUTE,60*Math.floor(c/e)*e)):(c.setMinutes(0),c.setSeconds(0),c.setMilliseconds(0));break;case Sch.util.Date.DAY:b?(c=Sch.util.Date.getDurationInDays(d,c),c=Sch.util.Date.add(d,Sch.util.Date.DAY,Math.floor(c/e)*e)):Ext.Date.clearTime(c);break;case Sch.util.Date.WEEK:d=
c.getDay();Ext.Date.clearTime(c);d!==this.weekStartDay&&(c=Sch.util.Date.add(c,Sch.util.Date.DAY,-(d>this.weekStartDay?d-this.weekStartDay:7-d-this.weekStartDay)));break;case Sch.util.Date.MONTH:b?(c=Sch.util.Date.getDurationInMonths(d,c),c=Sch.util.Date.add(d,Sch.util.Date.MONTH,Math.floor(c/e)*e)):(Ext.Date.clearTime(c),c.setDate(1));break;case Sch.util.Date.QUARTER:Ext.Date.clearTime(c);c.setDate(1);c=Sch.util.Date.add(c,Sch.util.Date.MONTH,-(c.getMonth()%3));break;case Sch.util.Date.YEAR:b?(c=
Sch.util.Date.getDurationInYears(d,c),c=Sch.util.Date.add(d,Sch.util.Date.YEAR,Math.floor(c/e)*e)):c=new Date(a.getFullYear(),0,1)}return c},ceilDate:function(a,b){var c=Ext.Date.clone(a),d=(b=!1!==b)?this.resolutionIncrement:1,e=b?this.resolutionUnit:this.mainUnit,f=!1;switch(e){case Sch.util.Date.DAY:if(0<c.getMinutes()||0<c.getSeconds()||0<c.getMilliseconds())f=!0;break;case Sch.util.Date.WEEK:Ext.Date.clearTime(c);c.getDay()!==this.weekStartDay&&(f=!0);break;case Sch.util.Date.MONTH:Ext.Date.clearTime(c);
1!==c.getDate()&&(f=!0);break;case Sch.util.Date.QUARTER:Ext.Date.clearTime(c);0!==c.getMonth()%3&&(f=!0);break;case Sch.util.Date.YEAR:Ext.Date.clearTime(c),0!==c.getMonth()&&1!==c.getDate()&&(f=!0)}return f?this.getNext(c,e,d):c},getNext:function(a,b,c){return Sch.util.Date.getNext(a,b,c,this.weekStartDay)},getResolution:function(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}},setResolution:function(a,b){this.resolutionUnit=a;this.resolutionIncrement=b||1},shiftNext:function(a){a=
a||this.getShiftIncrement();var b=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),b,a),Sch.util.Date.add(this.getEnd(),b,a))},shiftPrevious:function(a){a=-(a||this.getShiftIncrement());var b=this.getShiftUnit();this.setTimeSpan(Sch.util.Date.add(this.getStart(),b,a),Sch.util.Date.add(this.getEnd(),b,a))},getShiftUnit:function(){return this.shiftUnit||this.getMainUnit()},getShiftIncrement:function(){return this.shiftIncrement||1},getUnit:function(){return this.unit},getIncrement:function(){return this.increment},
timeSpanInAxis:function(a,b){return this.continuous?Sch.util.Date.intersectSpans(a,b,this.getStart(),this.getEnd()):b>a&&this.getTickFromDate(a)!==this.getTickFromDate(b)},forEachInterval:function(a,b,c){c=c||this;"top"===a||"middle"===a&&this.headerConfig.bottom?this.forEachAuxInterval(a,b,c):this.tickStore.each(function(a,e){return b.call(c,a.data.start,a.data.end,e)})},forEachMainInterval:function(a,b){this.forEachInterval("middle",a,b)},forEachAuxInterval:function(a,b,c){c=c||this;for(var d=this.getEnd(),
e=this.getStart(),f=0,g;e<d;)g=Sch.util.Date.min(this.getNext(e,this.headerConfig[a].unit,this.headerConfig[a].increment||1),d),b.call(c,e,g,f),e=g,f++}});
Ext.define("Sch.view.Horizontal",{props:{translateToScheduleCoordinate:function(a){return a-this.el.getX()+this.el.getScroll().left},translateToPageCoordinate:function(a){return a+this.el.getX()-this.el.getScroll().left},getDateFromXY:function(a,b){var c;c=this.translateToScheduleCoordinate(a[0]);var d=c/this.getActualTimeColumnWidth(),e=this.timeAxis.getCount();if(0>d||d>e)c=null;else{if(2<d-this.resolveColumnIndex(c)&&d>=e)return null;c=this.timeAxis.getDateFromTick(d,b)}return c},getXYFromDate:function(a,
b){var c,d=this.timeAxis.getTickFromDate(a);0<=d&&(c=this.getActualTimeColumnWidth()*d);!1===b&&(c=this.translateToPageCoordinate(c));return[c,0]},getEventBox:function(a,b){var c=Math.floor(this.getXYFromDate(a)[0]),d=Math.floor(this.getXYFromDate(b)[0]),e=Math;return this.managedEventSizing?{top:Math.max(0,this.barMargin-(Ext.isIE&&!Ext.isStrict)?0:this.eventBorderWidth-this.cellBorderWidth),left:e.min(c,d),width:e.max(1,e.abs(c-d)),height:this.rowHeight-2*this.barMargin-this.eventBorderWidth}:{left:e.min(c,
d),width:e.max(1,e.abs(c-d))}},layoutEvents:function(a){a=Ext.Array.clone(a);a.sort(this.sortEvents);return this.layoutEventsInBands(0,a)},layoutEventsInBands:function(a,b){var c=b[0],d=0===a?this.barMargin:a*this.rowHeight-(a-1)*this.barMargin;for(d>=this.cellBorderWidth&&(d-=this.cellBorderWidth);c;)c.top=d,Ext.Array.remove(b,c),c=this.findClosestSuccessor(c,b);a++;return 0<b.length?this.layoutEventsInBands(a,b):a},getScheduleRegion:function(a,b){var c=a?Ext.fly(this.getNodeByRecord(a)).getRegion():
this.el.down(".x-grid-table").getRegion(),d=this.timeAxis.getStart(),e=this.timeAxis.getEnd(),e=this.getDateConstraints(a,b)||{start:d,end:e},d=this.translateToPageCoordinate(this.getXYFromDate(e.start)[0]),e=this.translateToPageCoordinate(this.getXYFromDate(e.end)[0]),f=c.bottom-this.barMargin-this.eventBorderWidth;return new Ext.util.Region(c.top+this.barMargin,Math.max(d,e),f,Math.min(d,e))},getResourceRegion:function(a,b,c){a=Ext.fly(this.getNodeByRecord(a)).getRegion();var d=this.timeAxis.getStart(),
e=this.timeAxis.getEnd();b=b?Sch.util.Date.max(d,b):d;e=c?Sch.util.Date.min(e,c):e;c=this.getXYFromDate(b)[0];b=this.getXYFromDate(e)[0];var e=this.el.getTop(),d=this.el.getScroll(),f=a.bottom-1-e+d.top;return new Ext.util.Region(a.top+1-e+d.top,Math.max(c,b),f,Math.min(c,b))},collectRowData:function(a,b,c){var d=this.eventStore.getEventsForResource(b);if(0===d.length||0===this.headerCt.getColumnCount())return a.rowHeight=this.rowHeight,a;var e=this.timeAxis,f=e.getStart(),g=e.getEnd(),h=[],k,l;k=
0;for(l=d.length;k<l;k++){var p=d[k],m=p.getStartDate(),n=p.getEndDate();m&&(n&&e.timeSpanInAxis(m,n))&&(p=this.generateTplData(p,f,g,b,c),h[h.length]=p)}b=1;this.dynamicRowHeight&&(b=this.layoutEvents(h));a.rowHeight=b*this.rowHeight-(b-1)*this.barMargin;a[this.getFirstTimeColumn().id]+="\x26#160;"+this.eventTpl.apply(h);return a},resolveResource:function(a){return(a=this.findItemByChild(a))?this.getRecord(a):null},getTimeSpanRegion:function(a,b,c){var d=this.getXYFromDate(a)[0];a=this.getXYFromDate(b||
a)[0];var e;this.store.buffered&&(b=this.panel.verticalScroller.stretcher instanceof Ext.CompositeElement?this.panel.verticalScroller.stretcher.first():this.el.down(".x-stretcher"),b.dom.clientHeight&&(e=b));e||(e=this.el.down(".x-grid-table"));c=c?Math.max(e?e.dom.clientHeight:0,this.el.dom.clientHeight):e?e.dom.clientHeight:0;return new Ext.util.Region(0,Math.max(d,a),c,Math.min(d,a))},getStartEndDatesFromRegion:function(a,b){var c=this.getDateFromXY([a.left,0],b),d=this.getDateFromXY([a.right,
0],b);return d&&c?{start:Sch.util.Date.min(c,d),end:Sch.util.Date.max(c,d)}:null},onEventAdd:function(a,b){for(var c={},d=0,e=b.length;d<e;d++){var f=b[d].getResource();f&&(c[f.getId()]=f)}Ext.Object.each(c,function(a,b){this.onUpdate(this.resourceStore,b)},this)},onEventRemove:function(a,b){var c=this.getElementFromEventRecord(b);if(c){var d=this.resolveResource(c);c.fadeOut({callback:function(){if(Ext.tree.View&&this instanceof Ext.tree.View&&this.store.indexOf(d))this.onUpdate(this.store,d);else if(0<=
this.resourceStore.indexOf(d))this.onUpdate(this.resourceStore,d)},scope:this})}},onEventUpdate:function(a,b,c){if((a=b.previous)&&a[b.resourceIdField])if(a=b.getResource(a[b.resourceIdField]))this.onUpdate(this.resourceStore,a);if(a=b.getResource())this.onUpdate(this.resourceStore,a)},getSingleTickInPixels:function(){return this.getActualTimeColumnWidth()},setColumnWidth:function(a,b){this.getTimeAxisColumn()&&(this.getTimeAxisColumn().setTimeColumnWidth(a),b||this.refreshKeepingScroll());this.fireEvent("columnwidthchange",
this,a)},getVisibleDateRange:function(){if(!this.rendered)return null;var a=this.getEl().getScroll(),b=this.panel.getStart(),c=this.panel.getEnd(),d=this.getWidth();if(Ext.query(".x-grid-table",this.getEl().dom)[0].clientWidth<d)return{startDate:b,endDate:c};var c=this.getSingleTickInPixels(),e=this.timeAxis.getUnit();return{startDate:Sch.util.Date.add(b,e,a.left/c),endDate:Sch.util.Date.add(b,e,a.left/c+d/c)}}}});
Ext.define("Sch.view.Vertical",{props:{translateToScheduleCoordinate:function(a){return a-this.el.getY()+this.el.getScroll().top},translateToPageCoordinate:function(a){var b=this.el,c=b.getScroll();return a+b.getY()-c.top},getDateFromXY:function(a,b){var c=this.translateToScheduleCoordinate(a[1])/this.rowHeight,d=this.timeAxis.getCount();return 0>c||c>d?null:this.timeAxis.getDateFromTick(c,b)},getXYFromDate:function(a,b){var c=-1,d=this.timeAxis.getTickFromDate(a);0<=d&&(c=this.rowHeight*d);!1===
b&&(c=this.translateToPageCoordinate(c));return[0,c]},getEventBox:function(a,b){var c=Math.floor(this.getXYFromDate(a)[1]),d=Math.floor(this.getXYFromDate(b)[1]),e=Math;return this.managedEventSizing?{left:this.barMargin,width:this.panel.resourceColumnWidth-2*this.barMargin-this.eventBorderWidth,top:e.max(0,e.min(c,d)-this.eventBorderWidth),height:e.max(1,e.abs(c-d))}:{top:e.min(c,d),height:e.max(1,e.abs(c-d))}},getScheduleRegion:function(a,b){var c=a?Ext.fly(this.getCellByPosition({column:this.resourceStore.indexOf(a),
row:0})).getRegion():this.el.down(".x-grid-table").getRegion(),d=this.timeAxis.getStart(),e=this.timeAxis.getEnd(),f=this.getDateConstraints(a,b)||{start:d,end:e},d=this.translateToPageCoordinate(this.getXYFromDate(Sch.util.Date.min(d,f.start))[1]),e=this.translateToPageCoordinate(this.getXYFromDate(Sch.util.Date.max(e,f.end))[1]),f=c.left+this.barMargin,c=(a?c.left+this.panel.resourceColumnWidth:c.right)-this.barMargin;return new Ext.util.Region(Math.min(d,e),c,Math.max(d,e),f)},getResourceRegion:function(a,
b,c){a=this.resourceStore.indexOf(a)*this.panel.resourceColumnWidth;var d=this.timeAxis.getStart(),e=this.timeAxis.getEnd();b=b?Sch.util.Date.max(d,b):d;e=c?Sch.util.Date.min(e,c):e;c=this.getXYFromDate(b)[1];b=this.getXYFromDate(e)[1];e=a+this.barMargin+this.cellBorderWidth;a=a+this.panel.resourceColumnWidth-this.barMargin-this.cellBorderWidth;return new Ext.util.Region(Math.min(c,b),a,Math.max(c,b),e)},layoutEvents:function(a){if(0!==a.length){a.sort(this.sortEvents);for(var b,c=this.panel.resourceColumnWidth-
2*this.barMargin,d,e,f=0,g=a.length;f<g;f++){d=a[f];b=this.findStartSlot(a,d);var h=this.getCluster(a,f);if(1<h.length){d.left=b.start;d.width=b.end-b.start;for(e=1;e<h.length-1&&0===h[e+1].start-d.start;)e++;(d=this.findStartSlot(a,h[e]))&&0.8>d.start&&(h=h.slice(0,e))}d=h.length;var k=(b.end-b.start)/d;for(e=0;e<d;e++)h[e].width=k,h[e].left=b.start+e*k;f+=d-1}f=0;for(g=a.length;f<g;f++)a[f].width*=c,a[f].left=this.barMargin+a[f].left*c}},findStartSlot:function(a,b){Ext.Array.indexOf(a,b);var c=
this.getPriorOverlappingEvents(a,b),d;if(0===c.length)return{start:0,end:1};for(d=0;d<c.length;d++){if(0===d&&0<c[0].left)return{start:0,end:c[0].left};if(c[d].left+c[d].width<(d<c.length-1?c[d+1].left:1))return{start:c[d].left+c[d].width,end:d<c.length-1?c[d+1].left:1}}return!1},getPriorOverlappingEvents:function(a,b){for(var c=Sch.util.Date,d=b.start,e=b.end,f=[],g=0,h=Ext.Array.indexOf(a,b);g<h;g++)c.intersectSpans(d,e,a[g].start,a[g].end)&&f.push(a[g]);f.sort(function(a,b){return a.left<b.left?
-1:1});return f},getCluster:function(a,b){if(b>=a.length-1)return[a[b]];for(var c=[a[b]],d=a.length,e=a[b].start,f=a[b].end,g=Sch.util.Date,h=b+1;h<d&&g.intersectSpans(e,f,a[h].start,a[h].end);)c.push(a[h]),e=g.max(e,a[h].start),f=g.min(a[h].end,f),h++;return c},collectRowData:function(a,b,c){if(0===c){b=this.timeAxis;c=b.getStart();for(var d=b.getEnd(),e=this.headerCt.getColumnCount(),f,g,h,k,l,p,m=0;m<e;m++){k=this.getHeaderAtIndex(m);g=[];f=this.resourceStore.getAt(m);h=this.eventStore.getEventsForResource(f);
l=0;for(p=h.length;l<p;l++){var n=h[l],q=n.getStartDate(),r=n.getEndDate();q&&(r&&b.timeSpanInAxis(q,r))&&g.push(this.generateTplData(n,c,d,f,m))}this.layoutEvents(g);a[k.id]+="\x26#160;"+this.eventTpl.apply(g)}}a.rowHeight=this.rowHeight;return a},resolveResource:function(a){return(a=this.getHeaderByCell(a))?this.resourceStore.getAt(this.headerCt.getHeaderIndex(a)):null},onEventUpdate:function(a,b){this.renderSingle(b);var c=b.previous,d=b.getResource();c&&c[b.resourceIdField]&&(c=b.getResource(c[b.resourceIdField]))&&
this.relayoutRenderedEvents(c);d&&this.relayoutRenderedEvents(d)},onEventAdd:function(a,b){if(1===b.length)this.renderSingle(b[0]),this.relayoutRenderedEvents(b[0].getResource());else this.onUpdate(this.store,this.store.first())},onEventRemove:function(a,b){if(1===b.length)this.relayoutRenderedEvents(this.getResourceByEventRecord(b[0]));else this.onUpdate(this.store,this.store.first())},relayoutRenderedEvents:function(a){var b=[],c,d,e,f=this.eventStore.getEventsForResource(a);if(0<f.length){a=0;
for(c=f.length;a<c;a++)d=f[a],(e=this.getEventNodeByRecord(d))&&b.push({start:d.getStartDate(),end:d.getEndDate(),id:e.id});this.layoutEvents(b);for(a=0;a<b.length;a++)d=b[a],Ext.fly(d.id).setStyle({left:d.left+"px",width:d.width+"px"})}},renderSingle:function(a){var b=a.getResource(),c=this.getEventNodeByRecord(a),d=this.resourceStore.indexOf(b);c&&Ext.fly(c).remove();0>d||(c=this.getCell(this.store.getAt(0),this.headerCt.getHeaderAtIndex(d)).first(),a=this.generateTplData(a,this.timeAxis.getStart(),
this.timeAxis.getEnd(),b,d),this.eventTpl.append(c,[a]))},getTimeSpanRegion:function(a,b){var c=this.getXYFromDate(a)[1],d=this.getXYFromDate(b||a)[1],e=(this.el.down(".x-grid-table")||this.el).dom.clientWidth;return new Ext.util.Region(Math.min(c,d),e,Math.max(c,d),0)},getStartEndDatesFromRegion:function(a,b){var c=this.getDateFromXY([0,a.top],b),d=this.getDateFromXY([0,a.bottom],b);return top&&d?{start:Sch.util.Date.min(c,d),end:Sch.util.Date.max(c,d)}:null},getSingleTickInPixels:function(){return this.rowHeight},
timeColumnRenderer:function(a,b,c,d,e,f){a="";if(this.timeCellRenderer){c=this.timeAxis.getAt(d);a=c.start;c=c.end;f=this.resourceStore;var g=f.getAt(e);a=this.timeCellRenderer.call(this.timeCellRendererScope||this,b,g,d,e,f,a,c)}Ext.isIE&&(b.style+=";z-index:"+(this.store.getCount()-d));1===e%2&&(b.tdCls+=" "+this.altColCls);return a},setColumnWidth:function(a,b){this.panel&&(this.panel.resourceColumnWidth=a);var c=this.headerCt;c.suspendLayout=!0;c.items.each(function(b){b.rendered&&(b.minWidth=
void 0,b.setWidth(a))});c.suspendLayout=!1;c.doLayout();b||this.refresh();this.fireEvent("columnwidthchange",this,a)},getVisibleDateRange:function(){if(!this.rendered)return null;var a=this.getEl().getScroll(),b=this.panel.getStart(),c=this.panel.getEnd(),d=this.getHeight();if(Ext.query(".x-grid-table",this.getEl().dom)[0].clientWidth<d)return{startDate:b,endDate:c};var c=this.getSingleTickInPixels(),e=this.timeAxis.getUnit();return{startDate:Sch.util.Date.add(b,e,a.top/c),endDate:Sch.util.Date.add(b,
e,a.top/c+d/c)}}}});
Ext.define("Sch.selection.EventModel",{extend:"Ext.selection.Model",alias:"selection.eventmodel",requires:["Ext.util.KeyNav"],deselectOnContainerClick:!0,constructor:function(a){this.addEvents("beforedeselect","beforeselect","deselect","select");this.callParent(arguments)},bindStore:function(a,b){this.callParent([this.view.getEventStore(),b])},bindComponent:function(a){var b={refresh:this.refresh,scope:this};this.view=a;this.bindStore(a.getEventStore());a.on({eventclick:this.onEventClick,itemclick:this.onItemClick,
scope:this});a.on(b)},onEventClick:function(a,b,c){this.selectWithEvent(b,c)},onItemClick:function(){this.deselectOnContainerClick&&this.deselectAll()},onSelectChange:function(a,b,c,d){var e=this.view,f=b?"select":"deselect";if(!1!==(c||this.fireEvent("before"+f,this,a))&&!1!==d()){if(b)e.onEventSelect(a,c);else e.onEventDeselect(a,c);c||this.fireEvent(f,this,a)}},selectRange:function(){},selectNode:function(a,b,c){(a=this.view.resolveEventRecord(a))&&this.select(a,b,c)},deselectNode:function(a,b,
c){(a=this.view.resolveEventRecord(a))&&this.deselect(a,c)}});
Ext.define("Sch.plugin.Printable",{extend:"Ext.AbstractPlugin",lockableScope:"top",docType:"\x3c!DOCTYPE HTML\x3e",printableEventTpl:null,beforePrint:Ext.emptyFn,afterPrint:Ext.emptyFn,autoPrintAndClose:!0,fakeBackgroundColor:!0,scheduler:null,constructor:function(a){Ext.apply(this,a)},init:function(a){this.scheduler=a;a.print=Ext.Function.bind(this.print,this)},mainTpl:'{docType}\x3chtml class\x3d"x-border-box {htmlClasses}"\x3e\x3chead\x3e\x3cmeta content\x3d"text/html; charset\x3dUTF-8" http-equiv\x3d"Content-Type" /\x3e\x3ctitle\x3e{title}\x3c/title\x3e{styles}\x3c/head\x3e\x3cbody class\x3d"sch-print-body {bodyClasses}"\x3e\x3cdiv class\x3d"sch-print-ct {componentClasses}" style\x3d"width:{totalWidth}px"\x3e\x3cdiv class\x3d"sch-print-headerbg" style\x3d"border-left-width:{totalWidth}px;height:{headerHeight}px;"\x3e\x3c/div\x3e\x3cdiv class\x3d"sch-print-header-wrap"\x3e\x3cdiv style\x3d"left:-{lockedScroll}px;margin-right:-{lockedScroll}px;width:{[values.lockedWidth + values.lockedScroll]}px" class\x3d"sch-print-lockedheader x-grid-header-ct x-grid-header-ct-default x-docked x-docked-top x-grid-header-ct-docked-top x-grid-header-ct-default-docked-top x-box-layout-ct x-docked-noborder-top x-docked-noborder-right x-docked-noborder-left"\x3e{lockedHeader}\x3c/div\x3e\x3cdiv style\x3d"left:{lockedWidth}px;width:{normalWidth}px;" class\x3d"sch-print-normalheader x-grid-header-ct x-grid-header-ct-default x-docked x-docked-top x-grid-header-ct-docked-top x-grid-header-ct-default-docked-top x-box-layout-ct x-docked-noborder-top x-docked-noborder-right x-docked-noborder-left"\x3e\x3cdiv style\x3d"margin-left:-{normalScroll}px"\x3e{normalHeader}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"lockedRowsCt" style\x3d"left:-{lockedScroll}px;margin-right:-{lockedScroll}px;width:{[values.lockedWidth + values.lockedScroll]}px;top:{headerHeight}px;" class\x3d"sch-print-locked-rows-ct {innerLockedClasses} x-grid-inner-locked"\x3e{lockedRows}\x3c/div\x3e\x3cdiv id\x3d"normalRowsCt" style\x3d"left:{lockedWidth}px;top:{headerHeight}px;width:{normalWidth}px" class\x3d"sch-print-normal-rows-ct {innerNormalClasses}"\x3e\x3cdiv style\x3d"position:relative;overflow:visible;margin-left:-{normalScroll}px"\x3e{normalRows}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cscript type\x3d"text/javascript"\x3e{setupScript}\x3c/script\x3e\x3c/body\x3e\x3c/html\x3e',getGridContent:function(a){var b=
a.normalGrid,c=a.lockedGrid,d=c.getView(),e=b.getView(),f,g;this.beforePrint(a);g=d.store.getRange();f=d.tpl.apply(d.collectData(g,0));g=e.tpl.apply(e.collectData(g,0));d=d.el.getScroll().left;e=e.el.getScroll().left;if(a.columnLinesFeature){var h=a.columnLinesFeature,k=h.containerEl;h.containerEl=Ext.get(document.createElement("div"));h.renderElementsInternal();g=h.containerEl.dom.innerHTML+g;h.containerEl=k}this.afterPrint(a);return{normalHeader:b.headerCt.el.dom.innerHTML,lockedHeader:c.headerCt.el.dom.innerHTML,
lockedRows:f,normalRows:g,lockedScroll:d,normalScroll:e,lockedWidth:c.getWidth(),normalWidth:b.getWidth(),headerHeight:b.headerCt.getHeight(),innerLockedClasses:c.view.el.dom.className,innerNormalClasses:b.view.el.dom.className+(this.fakeBackgroundColor?" sch-print-fake-background":""),width:a.getWidth()}},getStylesheets:function(){return Ext.getDoc().select('link[rel\x3d"stylesheet"]')},print:function(){var a=this.scheduler;this.mainTpl instanceof Ext.Template||(this.mainTpl=Ext.create("Ext.XTemplate",
this.mainTpl,{compiled:!0,disableFormats:!0}));a.getView();var b=this.getStylesheets(),c=Ext.get(Ext.core.DomHelper.createDom({tag:"div"}));b.each(function(a){c.appendChild(a.dom.cloneNode(!0))});var b=c.dom.innerHTML+"",d=this.getGridContent(a),a=this.mainTpl.apply(Ext.apply({waitText:this.waitText,docType:this.docType,htmlClasses:"",bodyClasses:Ext.getBody().dom.className,componentClasses:a.el.dom.className,title:a.title||"",styles:b,totalWidth:a.getWidth(),setupScript:"("+this.setupScript.toString()+
")();"},d)),b=window.open("","printgrid");b.document.write(a);b.document.close();this.autoPrintAndClose&&(b.print(),Ext.isChrome||b.close())},setupScript:function(){for(var a=document.getElementById("lockedRowsCt"),b=document.getElementById("normalRowsCt"),a=a.getElementsByTagName("tr"),b=b.getElementsByTagName("tr"),c=b.length,d=0;d<c;d++)a[d].style.height=b[d].style.height}});
Ext.define("Sch.plugin.Lines",{extend:"Sch.feature.AbstractTimeSpan",cls:"sch-timeline",showTip:!0,init:function(a){this.callParent(arguments);var b=this.schedulerView;this.template||(this.template=new Ext.XTemplate('\x3ctpl for\x3d"."\x3e','\x3cdiv id\x3d"'+this.uniqueCls+'-{id}"'+(this.showTip?'title\x3d"{[this.getTipText(values)]}" ':"")+'class\x3d"'+this.cls+" "+this.uniqueCls+' {Cls}" style\x3d"left:{left}px;top:{top}px;height:{height}px;width:{width}px"\x3e\x3c/div\x3e',"\x3c/tpl\x3e",{getTipText:function(a){return b.getFormattedDate(a.Date)+
" "+(a.Text||"")}}))},getElementData:function(a,b,c){var d=this.store,e=this.schedulerView;c=c||d.getRange();var f=[];this.containerEl.lastBox||this.containerEl.getHeight();for(var g,h=0,k=d.getCount();h<k;h++)if(d=c[h],(g=d.get("Date"))&&Ext.Date.between(g,a,b))g=e.getTimeSpanRegion(g,null,this.expandToFitView),f[f.length]=Ext.apply({id:d.internalId,left:g.left,top:g.top,width:Math.max(1,g.right-g.left),height:g.bottom-g.top},d.data);return f}});
Ext.define("Sch.plugin.CurrentTimeLine",{extend:"Sch.plugin.Lines",tooltipText:"Current time",updateInterval:6E4,autoUpdate:!0,init:function(a){var b=Ext.create("Ext.data.JsonStore",{model:Ext.define("TimeLineEvent",{extend:"Ext.data.Model",fields:["Date","Cls","Text"]}),data:[{Date:new Date,Cls:"sch-todayLine",Text:this.tooltipText}]}),c=b.first();this.autoUpdate&&(this.runner=Ext.create("Ext.util.TaskRunner"),this.runner.start({run:function(){c.set("Date",new Date)},interval:this.updateInterval}));
a.on("destroy",this.onHostDestroy,this);this.store=b;this.callParent(arguments)},onHostDestroy:function(){this.runner&&this.runner.stopAll();this.store.autoDestroy&&this.store.destroy()}});
Ext.define("Sch.plugin.DragSelector",{extend:"Sch.util.DragTracker",mixins:["Ext.AbstractPlugin"],lockableScope:"normal",constructor:function(a){a=a||{};Ext.applyIf(a,{onBeforeStart:this.onBeforeStart,onStart:this.onStart,onDrag:this.onDrag,onEnd:this.onEnd});this.callParent(arguments)},init:function(a){a.on({afterrender:this.onSchedulerRender,destroy:this.onSchedulerDestroy,scope:this});this.scheduler=a},onBeforeStart:function(a){return a.ctrlKey},onStart:function(a){a=this.schedulerView;this.proxy?
this.proxy.show():this.proxy=a.el.createChild({cls:"sch-drag-selector x-view-selector"});this.bodyRegion=a.getScheduleRegion();var b=[];a.getEventNodes().each(function(a){b[b.length]={region:a.getRegion(),node:a.dom}},this);this.eventData=b;this.sm.deselectAll()},onDrag:function(a){a=this.sm;var b=this.eventData,c=this.getRegion().constrainTo(this.bodyRegion),d,e,f,g;this.proxy.setRegion(c);d=0;for(f=b.length;d<f;d++)e=b[d],(g=c.intersect(e.region))&&!e.selected?(e.selected=!0,a.selectNode(e.node,
!0)):!g&&e.selected&&(e.selected=!1,a.deselectNode(e.node))},onEnd:function(a){this.proxy&&this.proxy.setDisplayed(!1)},onSchedulerRender:function(a){this.sm=a.getEventSelectionModel();this.schedulerView=a.getSchedulingView();this.initEl(a.el)},onSchedulerDestroy:function(){Ext.destroy(this.proxy);this.destroy()}});
Ext.define("Sch.plugin.EventEditor",{extend:"Ext.form.FormPanel",mixins:["Ext.AbstractPlugin"],lockableScope:"normal",requires:["Sch.util.Date"],saveText:"Save",deleteText:"Delete",cancelText:"Cancel",hideOnBlur:!0,startDateField:null,startTimeField:null,durationField:null,timeConfig:null,dateConfig:null,durationConfig:null,durationUnit:null,durationText:null,triggerEvent:"eventdblclick",fieldsPanelConfig:null,dateFormat:"Y-m-d",timeFormat:"H:i",cls:"sch-eventeditor",border:!1,dynamicForm:!0,eventRecord:null,
hidden:!0,collapsed:!0,currentForm:null,scheduler:null,schedulerView:null,preventHeader:!0,floating:!0,hideMode:"offsets",layout:{type:"vbox",align:"stretch"},constrain:!1,constructor:function(a){a=a||{};this.durationUnit=a.durationUnit||Sch.util.Date.HOUR;this.addEvents("beforeeventdelete","beforeeventsave");this.callParent(arguments)},initComponent:function(){if(!this.fieldsPanelConfig)throw"Must define a fieldsPanelConfig property";Ext.apply(this,{fbar:this.buttons||this.buildButtons(),items:[{layout:"hbox",
height:35,border:!1,cls:"sch-eventeditor-timefields",items:this.buildDurationFields()},Ext.applyIf(this.fieldsPanelConfig,{flex:1,activeItem:0})]});this.callParent(arguments)},init:function(a){this.scheduler=a;this.schedulerView=a.getSchedulingView();this.eventStore=a.getEventStore();this.schedulerView.on({afterrender:this.onSchedulerRender,destroy:this.onSchedulerDestroy,dragcreateend:this.onDragCreateEnd,scope:this});if(this.triggerEvent)this.schedulerView.on(this.triggerEvent,this.onActivateEditor,
this);this.schedulerView.registerEventEditor(this)},onSchedulerRender:function(){this.render(Ext.getBody());this.hideOnBlur&&this.mon(Ext.getDoc(),"mousedown",this.onMouseDown,this)},show:function(a,b){this.deleteButton&&this.deleteButton.setVisible(0<=this.eventStore.indexOf(a));this.eventRecord=a;this.durationField.setValue(Sch.util.Date.getDurationInUnit(a.getStartDate(),a.getEndDate(),this.durationUnit));var c=a.getStartDate();this.startDateField.setValue(c);this.startTimeField.setValue(c);this.callParent();
b=b||this.schedulerView.getElementFromEventRecord(a);this.alignTo(b,"horizontal"==this.scheduler.orientation?"bl":"tl-tr",this.getConstrainOffsets(b));this.expand(!this.constrain);this.constrain&&this.doConstrain(Ext.util.Region.getRegion(Ext.getBody()));var d;if((d=a.get("EventType"))&&this.dynamicForm){var c=this.items.getAt(1),e=c.query("\x3e component[EventType\x3d"+d+"]");if(!e.length)throw"Can't find form for EventType\x3d"+d;if(!c.getLayout().setActiveItem)throw"Can't switch active component in the 'fieldsPanel'";
d=e[0];if(!(d instanceof Ext.form.Panel))throw"Each child component of 'fieldsPanel' should be a 'form'";c.getLayout().setActiveItem(d)}else d=this;this.currentForm=d;d.getForm().loadRecord(a)},getConstrainOffsets:function(a){return[0,0]},onSaveClick:function(){var a=this.eventRecord,b=this.currentForm.getForm();if(b.isValid()&&!1!==this.fireEvent("beforeeventsave",this,a)){var c=this.startDateField.getValue(),d;d=this.startTimeField.getValue();var e=this.durationField.getValue();if(c&&0<=e&&(d&&
Sch.util.Date.copyTimeValues(c,d),d=Sch.util.Date.add(c,this.durationUnit,e),e=a.getResource()||this.resourceRecord,this.schedulerView.allowOverlap||this.schedulerView.isDateRangeAvailable(c,d,a,e)))a.beginEdit(),e=a.endEdit,a.endEdit=Ext.emptyFn,b.updateRecord(a),a.endEdit=e,a.setStartDate(c),a.setEndDate(d),a.endEdit(),0>this.eventStore.indexOf(this.eventRecord)&&!1!==this.schedulerView.fireEvent("beforeeventadd",this.schedulerView,a)&&this.eventStore.add(a),this.collapse(null,!0)}},onDeleteClick:function(){!1!==
this.fireEvent("beforeeventdelete",this,this.eventRecord)&&this.eventStore.remove(this.eventRecord);this.collapse(null,!0)},onCancelClick:function(){this.collapse(null,!0)},buildButtons:function(){this.saveButton=new Ext.Button({text:this.saveText,scope:this,handler:this.onSaveClick});this.deleteButton=new Ext.Button({text:this.deleteText,scope:this,handler:this.onDeleteClick});this.cancelButton=new Ext.Button({text:this.cancelText,scope:this,handler:this.onCancelClick});return[this.saveButton,this.deleteButton,
this.cancelButton]},buildDurationFields:function(){this.startDateField=new Ext.form.field.Date(Ext.apply({width:90,allowBlank:!1,format:this.dateFormat},this.dateConfig||{}));this.startTimeField=new Ext.form.field.Time(Ext.apply({width:70,style:"margin-left : 5px",allowBlank:!1,format:this.timeFormat},this.timeConfig||{}));this.durationField=new Ext.form.field.Number(Ext.apply({width:45,value:0,minValue:0,allowNegative:!1,style:"margin-left : 15px"},this.durationConfig||{}));this.durationLabel=Ext.create("Ext.form.Label",
{text:this.getDurationText(),style:"margin-left : 5px"});return[this.startDateField,this.startTimeField,this.durationField,this.durationLabel]},onActivateEditor:function(a,b){this.show(b)},onMouseDown:function(a){!this.collapsed&&(!a.within(this.getEl())&&!a.getTarget(".x-layer")&&!a.getTarget(".sch-event-editor-ignore-click")&&!a.getTarget(".sch-event"))&&this.collapse()},onSchedulerDestroy:function(){this.destroy()},onDragCreateEnd:function(a,b,c){!this.dragProxyEl&&this.schedulerView.dragCreator&&
(this.dragProxyEl=this.schedulerView.dragCreator.getProxy());this.resourceRecord=c;this.schedulerView.onEventCreated(b);this.show(b,this.dragProxyEl)},hide:function(){this.callParent(arguments);var a=this.dragProxyEl;a&&a.hide()},afterCollapse:function(){this.hide();this.callParent(arguments)},getDurationText:function(){return this.durationText?this.durationText:Sch.util.Date.getShortNameOfUnit(Sch.util.Date.getNameOfUnit(this.durationUnit))}});
Ext.define("Sch.plugin.EventTools",{extend:"Ext.Container",mixins:["Ext.AbstractPlugin"],lockableScope:"normal",hideDelay:500,align:"right",defaults:{xtype:"tool",baseCls:"sch-tool",overCls:"sch-tool-over",width:20,height:20,visibleFn:Ext.emptyFn},fadeOutTimer:null,lastTarget:null,lastPosition:null,cachedSize:null,offset:{x:0,y:1},autoRender:!0,floating:!0,hideMode:"offsets",getRecord:function(){return this.record},init:function(a){if(!this.items)throw"Must define items property for this plugin to function correctly";
this.addCls("sch-event-tools");this.scheduler=a;a.on({eventresizestart:this.onOperationStart,eventresizeend:this.onOperationEnd,eventdragstart:this.onOperationStart,eventdrop:this.onOperationEnd,eventmouseenter:this.onEventMouseEnter,eventmouseleave:this.onContainerMouseLeave,scope:this})},onRender:function(){this.callParent(arguments);this.scheduler.mon(this.el,{mouseenter:this.onContainerMouseEnter,mouseleave:this.onContainerMouseLeave,scope:this})},onEventMouseEnter:function(a,b,c){this.rendered||
(this.doAutoRender(),this.hide());var d=c.getTarget(a.eventSelector);a=Ext.fly(d).getBox();this.lastTarget=d;this.record=b;this.items.each(function(a){a.setVisible(!1!==a.visibleFn(b))},this);this.doLayout();d=this.getSize();this.lastPosition=[c.getXY()[0]-d.width/2,a.y-d.height-this.offset.y];this.onContainerMouseEnter()},onContainerMouseEnter:function(){window.clearTimeout(this.fadeOutTimer);this.setPosition.apply(this,this.lastPosition);this.el.fadeIn()},onContainerMouseLeave:function(){window.clearTimeout(this.fadeOutTimer);
this.fadeOutTimer=Ext.defer(this.el.fadeOut,this.hideDelay,this.el)},onOperationStart:function(){this.scheduler.un("eventmouseenter",this.onEventMouseEnter,this);window.clearTimeout(this.fadeOutTimer);this.hide()},hide:function(){this.el.hide()},onOperationEnd:function(){this.scheduler.on("eventmouseenter",this.onEventMouseEnter,this)}});
Ext.define("Sch.plugin.Pan",{alias:"plugin.pan",extend:"Ext.AbstractPlugin",lockableScope:"normal",enableVerticalPan:!0,panel:null,constructor:function(a){Ext.apply(this,a)},init:function(a){this.panel=a.normalGrid||a;this.view=a.getSchedulingView();this.view.on("afterrender",this.onRender,this)},onRender:function(a){this.view.el.on("mousedown",this.onMouseDown,this,{delegate:"."+this.view.timeCellCls})},onMouseDown:function(a,b){a.getTarget("."+this.view.timeCellCls)&&!a.getTarget(this.view.eventSelector)&&
(this.mouseX=a.getPageX(),this.mouseY=a.getPageY(),Ext.getBody().on("mousemove",this.onMouseMove,this),Ext.getDoc().on("mouseup",this.onMouseUp,this))},onMouseMove:function(a){a.stopEvent();var b=a.getPageX();a=a.getPageY();var c=a-this.mouseY;this.panel.scrollByDeltaX(-(b-this.mouseX));this.mouseX=b;this.mouseY=a;this.enableVerticalPan&&this.panel.scrollByDeltaY(-c)},onMouseUp:function(a){Ext.getBody().un("mousemove",this.onMouseMove,this);Ext.getDoc().un("mouseup",this.onMouseUp,this)}});
Ext.define("Sch.plugin.SimpleEditor",{extend:"Ext.Editor",mixins:["Ext.AbstractPlugin"],lockableScope:"normal",cls:"sch-simpleeditor",allowBlur:!1,newEventText:"New booking...",delegate:".sch-event-inner",dataIndex:null,completeOnEnter:!0,cancelOnEsc:!0,ignoreNoChange:!0,height:19,autoSize:{width:"boundEl"},constructor:function(a){a=a||{};a.field=a.field||Ext.create("Ext.form.TextField",{selectOnFocus:!0});this.callParent(arguments)},init:function(a){this.scheduler=a.getSchedulingView();a.on("afterrender",
this.onSchedulerRender,this);this.scheduler.registerEventEditor(this);this.dataIndex=this.dataIndex||this.scheduler.getEventStore().model.prototype.nameField},edit:function(a,b){b=b||this.scheduler.getElementFromEventRecord(a);this.startEdit(b.child(this.delegate));this.record=a;this.setValue(this.record.get(this.dataIndex))},onSchedulerRender:function(a){this.on({complete:function(a,c,d){a=this.record;d=this.scheduler.eventStore;a.set(this.dataIndex,c);0>d.indexOf(a)&&!1!==this.scheduler.fireEvent("beforeeventadd",
this.scheduler,a)&&d.add(a)},hide:function(){this.dragProxyEl&&this.dragProxyEl.hide()},scope:this});a.on({eventdblclick:function(a,c,d){this.edit(c)},dragcreateend:this.onDragCreateEnd,scope:this});a.el.on("mousedown",function(){this.cancelEdit()},this)},onDragCreateEnd:function(a,b){!this.dragProxyEl&&this.scheduler.dragCreator&&(this.dragProxyEl=this.scheduler.dragCreator.getProxy());this.scheduler.onEventCreated(b);""===b.get(this.dataIndex)&&b.set(this.dataIndex,this.newEventText);this.edit(b,
this.dragProxyEl)}});
Ext.define("Sch.plugin.SummaryColumn",{extend:"Ext.grid.column.Column",mixins:["Ext.AbstractPlugin"],lockableScope:"top",alias:"widget.summarycolumn",showPercent:!1,nbrDecimals:1,sortable:!1,fixed:!0,menuDisabled:!0,width:80,dataIndex:"_sch_not_used",constructor:function(a){this.scope=this;this.callParent(arguments)},init:function(a){"eventStore"in a&&(this.scheduler=a,this.scheduler.lockedGridDependsOnSchedule=!0,this.eventStore=a.eventStore)},renderer:function(a,b,c){b=this.scheduler;a=b.getStart();
b=b.getEnd();c=this.calculate(c.getEvents(),a,b);return 0>=c?"":this.showPercent?(a=Sch.util.Date.getDurationInMinutes(a,b),Math.round(100*c/a)+" %"):1440<c?(c/1440).toFixed(this.nbrDecimals)+" "+Sch.util.Date.getShortNameOfUnit("DAY"):30<=c?(c/60).toFixed(this.nbrDecimals)+" "+Sch.util.Date.getShortNameOfUnit("HOUR"):c+" "+Sch.util.Date.getShortNameOfUnit("MINUTE")},calculate:function(a,b,c){var d=0,e,f,g=Sch.util.Date;Ext.each(a,function(a){e=a.getStartDate();f=a.getEndDate();g.intersectSpans(b,
c,e,f)&&(d+=g.getDurationInMinutes(g.max(e,b),g.min(f,c)))});return d}});
Ext.define("Sch.plugin.Zones",{extend:"Sch.feature.AbstractTimeSpan",requires:["Sch.model.Range"],cls:"sch-zone",init:function(a){this.template||(this.template=new Ext.XTemplate('\x3ctpl for\x3d"."\x3e','\x3cdiv id\x3d"'+this.uniqueCls+'-{id}" class\x3d"'+this.cls+" "+this.uniqueCls+' {Cls}" style\x3d"left:{left}px;top:{top}px;height:{height}px;width:{width}px"\x3e\x3c/div\x3e',"\x3c/tpl\x3e"));this.callParent(arguments)},getElementData:function(a,b,c){var d=this.store,e=this.schedulerView;c=c||d.getRange();
for(var f=[],g,h,k=0,l=d.getCount();k<l;k++)d=c[k],g=d.getStartDate(),h=d.getEndDate(),g&&(h&&Sch.util.Date.intersectSpans(g,h,a,b))&&(g=e.getTimeSpanRegion(Sch.util.Date.max(g,a),Sch.util.Date.min(h,b),this.expandToFitView),f[f.length]=Ext.apply({id:d.internalId,left:g.left,top:g.top,width:g.right-g.left,height:g.bottom-g.top,Cls:d.getCls()},d.data));return f}});
Ext.define("Sch.plugin.TimeGap",{extend:"Sch.plugin.Zones",getZoneCls:Ext.emptyFn,init:function(a){this.store=new Ext.data.JsonStore({model:"Sch.model.Range"});this.scheduler=a;a.mon(a.eventStore,{load:this.populateStore,update:this.populateStore,remove:this.populateStore,add:this.populateStore,datachanged:this.populateStore,scope:this});a.on("viewchange",this.populateStore,this);this.schedulerView=a.getSchedulingView();this.callParent(arguments)},populateStore:function(a){a=this.schedulerView.getEventsInView();
var b=[],c=this.scheduler.getStart(),d=this.scheduler.getEnd(),e=a.getCount(),f,g=0,h;a.sortBy(function(a,b){return a.getStartDate()-b.getStartDate()});for(h=a.getAt(0);c<d&&g<e;)f=h.getStartDate(),!Sch.util.Date.betweenLesser(c,f,h.getEndDate())&&c<f&&b.push(new this.store.model({StartDate:c,EndDate:f,Cls:this.getZoneCls(c,f)||""})),c=Sch.util.Date.max(h.getEndDate(),c),g++,h=a.getAt(g);c<d&&b.push(new this.store.model({StartDate:c,EndDate:d,Cls:this.getZoneCls(c,d)||""}));this.store.removeAll(0<
b.length);this.store.add(b)}});
Ext.define("Sch.plugin.TreeCellEditing",{extend:"Ext.grid.plugin.CellEditing",init:function(a){this._grid=a;this.on("beforeedit",this.checkReadOnly,this);this.callParent(arguments)},checkReadOnly:function(){var a=this._grid;a instanceof Sch.panel.TimelineTreePanel||(a=a.up("tablepanel"));return!a.isReadOnly()},startEditByClick:function(a,b,c,d,e,f,g){g.getTarget(a.expanderSelector)||this.callParent(arguments)},startEdit:function(a,b){if(a&&b){var c=this.getEditor(a,b),d=a.get(b.dataIndex),e=this.getEditingContext(a,
b);a=e.record;b=e.column;this.completeEdit();if(b&&!b.getEditor(a))return!1;if(c){e.originalValue=e.value=d;if(!1===this.beforeEdit(e)||!1===this.fireEvent("beforeedit",e)||e.cancel)return!1;this.context=e;this.setActiveEditor(c);this.setActiveRecord(a);this.setActiveColumn(b);this.grid.view.focusCell({column:e.colIdx,row:e.rowIdx});this.editTask.delay(15,c.startEdit,c,[this.getCell(a,b),e.value,e])}else this.grid.getView().getEl(b).focus(Ext.isWebKit||Ext.isIE?10:!1)}},getEditingContext:function(a,
b){var c=this.grid,d=c.store,e,f=c.getView(),g;Ext.isNumber(a)?(e=a,a=d.getAt(e)):e=d.indexOf?d.indexOf(a):f.indexOf(f.getNode(a));Ext.isNumber(b)?(d=b,b=c.headerCt.getHeaderAtIndex(d)):d=b.getIndex();g=a.get(b.dataIndex);return{grid:c,record:a,field:b.dataIndex,value:g,row:f.getNode(e),column:b,rowIdx:e,colIdx:d}},startEditByPosition:function(a){var b=this.grid,c=b.getSelectionModel(),d=this.view,e=this.view.getNode(a.row),b=b.headerCt.getHeaderAtIndex(a.column),d=d.getRecord(e);c.selectByPosition&&
c.selectByPosition(a);this.startEdit(d,b)}});
Ext.define("Sch.plugin.ResourceZones",{extend:"Sch.plugin.Zones",store:null,cls:"sch-resourcezone",getElementData:function(a,b,c){var d=this.store,e=this.schedulerView,f=[],g,h,k;0<e.getNodes().length&&Ext.each(c||d.getRange(),function(c){var d=c.getResource();g=c.getStartDate();h=c.getEndDate();if(d&&0<=(e.resourceStore.indexOf?e.resourceStore:e.store).indexOf(d)&&Sch.util.Date.intersectSpans(g,h,a,b))k=e.getResourceRegion(d,g,h),f[f.length]=Ext.apply({id:c.internalId,left:k.left,top:k.top,width:k.right-
k.left,height:k.bottom-k.top,Cls:c.getCls()},c.data)});return f}});
Ext.define("Sch.feature.ColumnLines",{extend:"Sch.plugin.Lines",cls:"sch-column-line",showTip:!1,requires:["Ext.data.Store"],init:function(a){this.timeAxis=a.getTimeAxis();this.store=Ext.create("Ext.data.JsonStore",{model:Ext.define("Sch.model.TimeLine",{extend:"Ext.data.Model",fields:["start",{name:"Date",convert:function(a,c){return c.data.start}}]}),data:"horizontal"===a.getOrientation()?this.getData():[]});this.callParent(arguments);this.schedulerView.timeAxis.on("reconfigure",this.populate,this)},
populate:function(){var a=this.schedulerView,a="horizontal"===a.getOrientation()&&0<a.store.getCount();this.store.removeAll(a);a&&this.store.add(this.getData())},getElementData:function(){var a=this.schedulerView;return"horizontal"===a.getOrientation()&&0<a.store.getCount()?this.callParent(arguments):[]},getData:function(){var a=[];this.timeAxis.forEachMainInterval(function(b,c,d){0<d&&a.push({start:b})});a.push({start:this.timeAxis.getEnd()});return a}});
Ext.define("Sch.mixin.TimelineView",{requires:["Sch.column.Time","Sch.data.TimeAxis"],orientation:"horizontal",overScheduledEventClass:"sch-event-hover",selectedEventCls:"sch-event-selected",altColCls:"sch-col-alt",timeCellCls:"sch-timetd",timeCellSelector:".sch-timetd",ScheduleEventMap:{click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu",keydown:"KeyDown"},suppressFitCheck:0,forceFit:!1,inheritables:function(){return{cellBorderWidth:1,initComponent:function(){this.setOrientation(this.panel._top.orientation||
this.orientation);this.addEvents("beforetooltipshow","scheduleclick","scheduledblclick","schedulecontextmenu","columnwidthchange");this.enableBubble("columnwidthchange");var a={},b=Sch.util.Date;a[b.DAY]=a[b.WEEK]=a[b.MONTH]=a[b.QUARTER]=a[b.YEAR]=null;Ext.applyIf(this,{eventPrefix:this.id+"-",largeUnits:a});this.callParent(arguments);if("horizontal"===this.orientation)this.getTimeAxisColumn().on("timeaxiscolumnreconfigured",this.checkHorizontalFit,this);a=this.panel._top;Ext.apply(this,{eventRendererScope:a.eventRendererScope,
eventRenderer:a.eventRenderer,eventBorderWidth:a.eventBorderWidth,timeAxis:a.timeAxis,dndValidatorFn:a.dndValidatorFn||Ext.emptyFn,resizeValidatorFn:a.resizeValidatorFn||Ext.emptyFn,createValidatorFn:a.createValidatorFn||Ext.emptyFn,tooltipTpl:a.tooltipTpl,validatorFnScope:a.validatorFnScope||this,snapToIncrement:a.snapToIncrement,timeCellRenderer:a.timeCellRenderer,timeCellRendererScope:a.timeCellRendererScope,readOnly:a.readOnly,eventResizeHandles:a.eventResizeHandles,enableEventDragDrop:a.enableEventDragDrop,
enableDragCreation:a.enableDragCreation,dragConfig:a.dragConfig,dropConfig:a.dropConfig,resizeConfig:a.resizeConfig,createConfig:a.createConfig,tipCfg:a.tipCfg,orientation:a.orientation,getDateConstraints:a.getDateConstraints||Ext.emptyFn});this.emptyText&&(this.emptyText='\x3cspan class\x3d"sch-empty-text"\x3e'+this.emptyText+"\x3c/span\x3e")},onDestroy:function(){this.tip&&this.tip.destroy();this.callParent(arguments)},afterComponentLayout:function(){this.callParent(arguments);var a=this.getWidth(),
b=this.getHeight();a===this.__prevWidth&&b===this.__prevHeight||(this.__prevWidth=a,this.__prevHeight=b,!this.lockable&&!this.suppressFitCheck&&this.checkHorizontalFit())},beforeRender:function(){this.callParent(arguments);this.addCls("sch-timelineview");this.readOnly&&this.addCls(this._cmpCls+"-readonly")},afterRender:function(){this.callParent(arguments);this.overScheduledEventClass&&this.mon(this.el,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,delegate:this.eventSelector,scope:this});if(this.tooltipTpl)this.el.on("mousemove",
this.setupTooltip,this,{single:!0});this.setupTimeCellEvents()},processUIEvent:function(a){var b=a.getTarget(this.eventSelector),c=this.ScheduleEventMap,d=a.type;b&&d in c?this.fireEvent(this.scheduledEventName+d,this,this.resolveEventRecord(b),a):this.callParent(arguments)},refresh:function(){this.fixedNodes=0;this.callParent(arguments)},clearViewEl:function(){var a=this.getTargetEl();a.down("table").remove();this.emptyText&&(a=a.down(".sch-empty-text"))&&a.remove()},onMouseOver:function(a,b){b!==
this.lastItem&&(this.lastItem=b,Ext.fly(b).addCls(this.overScheduledEventClass),this.fireEvent("eventmouseenter",this,this.resolveEventRecord(b),a))},onMouseOut:function(a,b){this.lastItem&&!a.within(this.lastItem,!0,!0)&&(Ext.fly(this.lastItem).removeCls(this.overScheduledEventClass),this.fireEvent("eventmouseleave",this,this.resolveEventRecord(this.lastItem),a),delete this.lastItem)},highlightItem:function(a){a&&(this.clearHighlight(),this.highlightedItem=a,Ext.fly(a).addCls(this.overItemCls))},
shouldUpdateCell:function(){return!0}}},hasRightColumns:function(){return 1<this.headerCt.items.getCount()},checkHorizontalFit:function(){if("horizontal"===this.orientation){var a=this.getActualTimeColumnWidth(),b=this.getFittingColumnWidth();this.forceFit?b!=a&&this.fitColumns():this.snapToIncrement?(b=this.calculateTimeColumnWidth(a),0<b&&b!==a&&this.setColumnWidth(b)):a<b&&this.fitColumns()}},getTimeAxisColumn:function(){return this.headerCt.items.get(0)},getFirstTimeColumn:function(){return this.headerCt.getGridColumns()[0]},
getFormattedDate:function(a){return Ext.Date.format(a,this.getDisplayDateFormat())},getFormattedEndDate:function(a,b){this.timeAxis.getResolution().unit in this.largeUnits&&(0===a.getHours()&&0===a.getMinutes()&&!(a.getYear()===b.getYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate()))&&(a=Sch.util.Date.add(a,Sch.util.Date.DAY,-1));return Ext.Date.format(a,this.getDisplayDateFormat())},getDisplayDateFormat:function(){return this.displayDateFormat},setDisplayDateFormat:function(a){this.displayDateFormat=
a},getSingleUnitInPixels:function(a){return Sch.util.Date.getUnitToBaseUnitRatio(this.timeAxis.getUnit(),a)*this.getSingleTickInPixels()},getSingleTickInPixels:function(){throw"Must be implemented by horizontal/vertical";},scrollEventIntoView:function(a,b){var c=this.getOuterElementFromEventRecord(a);c&&(c.scrollIntoView(this.el),b&&("boolean"===typeof b?c.highlight():c.highlight(null,b)))},calculateTimeColumnWidth:function(a){if(!this.panel.rendered)return a;var b=this.forceFit,c=0,c=this.timeAxis.getUnit(),
d=this.timeAxis.getCount(),e=Number.MAX_VALUE;if(this.snapToIncrement)var e=this.timeAxis.getResolution(),f=e.increment,e=Sch.util.Date.getUnitToBaseUnitRatio(c,e.unit)*f;f=Sch.util.Date.getMeasuringUnit(c);e=Math.min(e,Sch.util.Date.getUnitToBaseUnitRatio(c,f));c=Math.floor(this.getAvailableWidthForSchedule()/d);c=b||a<c?c:a;if(0<e&&(!b||1>e))c=Math.round(Math.max(1,Math[b?"floor":"round"](e*c))/e);return c},getFittingColumnWidth:function(){var a=Math.floor(this.getAvailableWidthForSchedule()/this.timeAxis.getCount());
return this.calculateTimeColumnWidth(a)},fitColumns:function(a){var b=0,b="horizontal"===this.orientation?this.getFittingColumnWidth():Math.floor((this.panel.getWidth()-Ext.getScrollbarSize().width-1)/this.headerCt.getColumnCount());this.setColumnWidth(b,a)},getAvailableWidthForSchedule:function(){for(var a=this.lastBox&&this.lastBox.width||this.getWidth(),b=this.headerCt.items.items,c=1;c<b.length;c++)a-=b[c].getWidth();return a-Ext.getScrollbarSize().width-1},getRightColumnsWidth:function(){for(var a=
0,b=this.headerCt.items.items,c=1;c<b.length;c++)a+=b[c].getWidth();return a},fixRightColumnsPositions:function(){for(var a=this.headerCt.items.items,b=a[0].getWidth(),c=1;c<a.length;c++){var d=a[c];d.el.setLeft(b);b+=d.getWidth()}},getElementFromEventRecord:function(a){return Ext.get(this.eventPrefix+a.internalId)},getEventNodeByRecord:function(a){return document.getElementById(this.eventPrefix+a.internalId)},getOuterElementFromEventRecord:function(a){return Ext.get(this.eventPrefix+a.internalId)},
resolveColumnIndex:function(a){return Math.floor(a/this.getActualTimeColumnWidth())},getStartEndDatesFromRegion:function(a,b){throw"Must be implemented by horizontal/vertical";},setupTooltip:function(){var a=Ext.apply({renderTo:Ext.getBody(),delegate:this.eventSelector,target:this.el,anchor:"b"},this.tipCfg);this.tip=Ext.create("Ext.ToolTip",a);this.tip.on({beforeshow:function(a){if(!a.triggerElement||!a.triggerElement.id)return!1;var c=this.resolveEventRecord(a.triggerElement);if(!c||!1===this.fireEvent("beforetooltipshow",
this,c))return!1;a.update(this.tooltipTpl.apply(this.getDataForTooltipTpl(c)));return!0},scope:this})},getDataForTooltipTpl:function(a){return a.data},getTimeResolution:function(){return this.timeAxis.getResolution()},setTimeResolution:function(a,b){this.timeAxis.setResolution(a,b);this.snapToIncrement&&this.refreshKeepingScroll()},getEventIdFromDomNodeId:function(a){return a.substring(this.eventPrefix.length)},getDateFromDomEvent:function(a,b){return this.getDateFromXY(a.getXY(),b)},handleScheduleEvent:function(a){var b=
a.getTarget("."+this.timeCellCls,2);if(b){var c=this.getDateFromDomEvent(a,"floor");this.fireEvent("schedule"+a.type,this,c,this.indexOf(this.findItemByChild(b)),a)}},setupTimeCellEvents:function(){this.mon(this.el,{click:this.handleScheduleEvent,dblclick:this.handleScheduleEvent,contextmenu:this.handleScheduleEvent,scope:this},this)},getSnapPixelAmount:function(){if(this.snapToIncrement){var a=this.timeAxis.getResolution();return(a.increment||1)*this.getSingleUnitInPixels(a.unit)}return 1},getActualTimeColumnWidth:function(){return this.headerCt.items.get(0).getTimeColumnWidth()},
setSnapEnabled:function(a){(this.snapToIncrement=a)&&this.refreshKeepingScroll()},setReadOnly:function(a){this.readOnly=a;this[a?"addCls":"removeCls"](this._cmpCls+"-readonly")},isReadOnly:function(){return this.readOnly},setOrientation:function(a){this.orientation=a;Ext.apply(this,Sch.view[Ext.String.capitalize(a)].prototype.props)},getOrientation:function(){return this.orientation},translateToScheduleCoordinate:function(a){throw"Abstract method call!";},translateToPageCoordinate:function(a){throw"Abstract method call!";
},getDateFromXY:function(a,b){throw"Abstract method call!";},getXYFromDate:function(a,b){throw"Abstract method call!";},getTimeSpanRegion:function(a,b){throw"Abstract method call!";},getStart:function(){return this.timeAxis.getStart()},getEnd:function(){return this.timeAxis.getEnd()},setBarMargin:function(a,b){this.barMargin=a;b||this.refreshKeepingScroll()},setRowHeight:function(a,b){this.rowHeight=a||24;this.rendered&&!b&&this.refreshKeepingScroll()},refreshKeepingScroll:function(a){this.saveScrollState();
this.lightRefresh?this.lightRefresh():this.refresh();this.restoreScrollState()},refreshKeepingResourceScroll:function(a){a=this.el.dom;var b=a.scrollTop,c=a.scrollLeft;this.lightRefresh?this.lightRefresh():this.refresh();"horizontal"===this.getOrientation()?a.scrollTop=b:a.scrollLeft=c},lightRefresh:function(){var a=this.refreshSize;Ext.suspendLayouts();this.refreshSize=Ext.emptyFn;this.__lightRefresh=!0;this.refresh();delete this.__lightRefresh;this.refreshSize=a;Ext.resumeLayouts()}});
Ext.apply(Sch,{VERSION:"2.1.4"});Ext.define("Sch.view.TimelineGridView",{extend:"Ext.grid.View",mixins:["Sch.mixin.TimelineView"]},function(){this.override(Sch.mixin.TimelineView.prototype.inheritables()||{})});
Ext.define("Sch.mixin.SchedulerView",{uses:["Sch.tooltip.Tooltip"],requires:"Sch.feature.DragCreator Sch.feature.DragDrop Sch.feature.ResizeZone Sch.feature.Scheduling Sch.column.Resource Sch.view.Horizontal Sch.view.Vertical".split(" "),_cmpCls:"sch-schedulerview",scheduledEventName:"event",barMargin:1,eventResizeHandles:"end",allowOverlap:!0,constrainDragToResource:!1,readOnly:!1,dynamicRowHeight:!0,managedEventSizing:!0,eventAnimations:!0,eventSelector:".sch-event",eventTpl:'\x3ctpl for\x3d"."\x3e,\x3cdiv unselectable\x3d"on" id\x3d"{{evt-prefix}}{id}" style\x3d"left:{left}px;top:{top}px;height:{height}px;width:{width}px;{style}" class\x3d"sch-event x-unselectable {internalcls} {cls}"\x3e,\x3cdiv unselectable\x3d"on" class\x3d"sch-event-inner {iconCls}"\x3e,{body},\x3c/div\x3e,\x3c/div\x3e,\x3c/tpl\x3e'.split(","),
dndValidatorFn:function(a,b,c,d,e){return!0},resizeValidatorFn:function(a,b,c,d,e){return!0},createValidatorFn:function(a,b,c,d){return!0},inheritables:function(){return{loadingText:"Loading events...",trackOver:!1,overItemCls:"",initComponent:function(){this.addEvents("eventclick","eventdblclick","eventcontextmenu","eventmouseenter","eventmouseout","beforeeventresize","eventresizestart","eventpartialresize","eventresizeend","beforeeventdrag","eventdragstart","eventdrop","aftereventdrop","beforedragcreate",
"dragcreatestart","dragcreateend","afterdragcreate","beforeeventadd");this.callParent(arguments);var a=this.panel._top;Ext.apply(this,{eventStore:a.eventStore,resourceStore:a.resourceStore,eventBodyTemplate:a.eventBodyTemplate,eventTpl:a.eventTpl||this.eventTpl,eventBarTextField:a.eventBarTextField||a.eventStore.model.prototype.nameField,allowOverlap:a.allowOverlap,eventBarIconClsField:a.eventBarIconClsField,onEventCreated:a.onEventCreated||Ext.emptyFn,constrainDragToResource:a.constrainDragToResource});
Ext.isArray(this.eventTpl)&&(a=Ext.Array.clone(this.eventTpl),("start"===this.eventResizeHandles||"both"===this.eventResizeHandles)&&a.splice(2,0,Ext.String.format('\x3cdiv class\x3d"sch-resizable-handle sch-resizable-handle-{0}"\x3e\x3c/div\x3e',"start")),("end"===this.eventResizeHandles||"both"===this.eventResizeHandles)&&a.splice(2,0,Ext.String.format('\x3cdiv class\x3d"sch-resizable-handle sch-resizable-handle-{0}"\x3e\x3c/div\x3e',"end")),a=a.join("").replace("{{evt-prefix}}",this.eventPrefix),
this.eventTpl=Ext.create("Ext.XTemplate",a))},setReadOnly:function(a){this.dragCreator&&this.dragCreator.setDisabled(a);this.callParent(arguments)},prepareData:function(a,b,c){var d=this.callParent(arguments);return d=this.collectRowData(d,c,b)},initFeatures:function(){this.features=this.features||[];this.features.push({ftype:"scheduling"});this.callParent(arguments)},beforeRender:function(){this.callParent(arguments);this.addCls(this._cmpCls);this.eventAnimations&&this.addCls("sch-animations-enabled")},
afterRender:function(){this.callParent(arguments);this.bindEventStore(this.eventStore,!0);this.setupEventListeners();this.configureFunctionality();var a=this.headerCt.resizer;a&&(a.doResize=Ext.Function.createSequence(a.doResize,this.afterHeaderResized,this))},onDestroy:function(){this.bindEventStore(null);this.callParent(arguments)}}},getRowHeight:function(){return this.rowHeight},translateToScheduleCoordinate:function(a){throw"Must be defined by horizontal/vertical class";},getEventBox:function(a,
b){throw"Must be defined by horizontal/vertical class";},generateTplData:function(a,b,c,d,e){var f=a.getStartDate(),g=a.getEndDate(),h=this.getEventBox(Sch.util.Date.max(f,b),Sch.util.Date.min(g,c));b=Ext.apply(h,{id:a.internalId,internalcls:a.getCls()+(a.dirty?" sch-dirty ":"")+(g>c?" sch-event-endsoutside ":"")+(f<b?" sch-event-startsoutside ":"")+(this.eventBarIconClsField?" sch-event-withicon ":""),start:f,end:g,iconCls:a.data[this.eventBarIconClsField]||""});this.eventRenderer?(a=this.eventRenderer.call(this.eventRendererScope||
this,a,d,b,e),Ext.isObject(a)&&this.eventBodyTemplate?b.body=this.eventBodyTemplate.apply(a):b.body=a):this.eventBodyTemplate?b.body=this.eventBodyTemplate.apply(a.data):this.eventBarTextField&&(b.body=a.data[this.eventBarTextField]);return b},sortEvents:function(a,b){return 0===a.start-b.start?a.end>b.end?-1:1:a.start<b.start?-1:1},layoutEvents:function(a){throw"Must be defined by horizontal/vertical class";},findClosestSuccessor:function(a,b){for(var c=Infinity,d,e=a.end,f,g=0,h=b.length;g<h;g++)f=
b[g].start-e,0<=f&&f<c&&(d=b[g],c=f);return d},resolveResource:function(a){throw"Must be defined by horizontal/vertical class";},getScheduleRegion:function(a,b){throw"Must be defined by horizontal/vertical class";},resolveEventRecord:function(a){a=Ext.get(a);a.is(this.eventSelector)||(a=a.up(this.eventSelector));return this.getEventRecordFromDomId(a.id)},getResourceByEventRecord:function(a){return a.getResource()},getEventRecordFromDomId:function(a){a=this.getEventIdFromDomNodeId(a);return this.eventStore.data.getByKey(a)},
configureFunctionality:function(){var a=this.validatorFnScope||this;"none"!==this.eventResizeHandles&&Sch.feature.ResizeZone&&(this.resizePlug=Ext.create("Sch.feature.ResizeZone",Ext.applyIf({schedulerView:this,validatorFn:function(b,c,d,e){return(this.allowOverlap||this.isDateRangeAvailable(d,e,c,b))&&!1!==this.resizeValidatorFn.apply(a,arguments)},validatorFnScope:this},this.resizeConfig||{})));!1!==this.enableEventDragDrop&&Sch.feature.DragDrop&&(this.dragdropPlug=Ext.create("Sch.feature.DragDrop",
this,{validatorFn:function(b,c,d,e,f){return(this.allowOverlap||this.isDateRangeAvailable(d,Sch.util.Date.add(d,Sch.util.Date.MILLI,e),b[0],c))&&!1!==this.dndValidatorFn.apply(a,arguments)},validatorFnScope:this,dragConfig:this.dragConfig||{},dropConfig:this.dropConfig||{}}));!1!==this.enableDragCreation&&Sch.feature.DragCreator&&(this.dragCreator=Ext.create("Sch.feature.DragCreator",Ext.applyIf({schedulerView:this,disabled:this.readOnly,validatorFn:function(b,c,d){return(this.allowOverlap||this.isDateRangeAvailable(c,
d,null,b))&&!1!==this.createValidatorFn.apply(a,arguments)},validatorFnScope:this},this.createConfig||{})))},isDateRangeAvailable:function(a,b,c,d){return this.eventStore.isDateRangeAvailable(a,b,c,d)},getEventsInView:function(){var a=this.timeAxis.getStart(),b=this.timeAxis.getEnd();return this.eventStore.getEventsInTimeSpan(a,b)},getEventNodes:function(){return this.el.select(this.eventSelector)},onBeforeDragDrop:function(a,b,c){return!this.readOnly&&!c.getTarget().className.match("sch-resizable-handle")},
onDragDropStart:function(){this.dragCreator&&this.dragCreator.setDisabled(!0);this.tip&&(this.tip.hide(),this.tip.disable())},onDragDropEnd:function(){this.dragCreator&&this.dragCreator.setDisabled(!1);this.tip&&this.tip.enable()},onBeforeDragCreate:function(a,b,c,d){return!this.readOnly&&!d.ctrlKey},onDragCreateStart:function(){if(this.overClass){var a=this.getView().mainBody;this.mun(a,"mouseover",this.onMouseOver,this);this.mun(a,"mouseout",this.onMouseOut,this)}this.tip&&(this.tip.hide(),this.tip.disable())},
onDragCreateEnd:function(a,b,c){this.eventEditor||(!1!==this.fireEvent("beforeeventadd",this,b)&&(this.onEventCreated(b),this.eventStore.add(b)),this.dragCreator.getProxy().hide())},onEventCreated:function(a){},onAfterDragCreate:function(){this.overClass&&this.mon(this.getView().mainBody,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,scope:this});this.tip&&this.tip.enable()},onBeforeResize:function(a,b,c){return!this.readOnly},onResizeStart:function(){this.tip&&(this.tip.hide(),this.tip.disable());
this.dragCreator&&this.dragCreator.setDisabled(!0)},onResizeEnd:function(){this.tip&&this.tip.enable();this.dragCreator&&this.dragCreator.setDisabled(!1)},getEventStore:function(){return this.eventStore},registerEventEditor:function(a){this.eventEditor=a},getEventEditor:function(){return this.eventEditor},setupEventListeners:function(){this.on({beforeeventdrag:this.onBeforeDragDrop,eventdragstart:this.onDragDropStart,aftereventdrop:this.onDragDropEnd,beforedragcreate:this.onBeforeDragCreate,dragcreatestart:this.onDragCreateStart,
dragcreateend:this.onDragCreateEnd,afterdragcreate:this.onAfterDragCreate,beforeeventresize:this.onBeforeResize,eventresizestart:this.onResizeStart,eventresizeend:this.onResizeEnd,scope:this})},_onEventUpdate:function(a,b,c){this.onEventUpdate.apply(this,arguments)},_onEventAdd:function(a,b){this.onEventAdd.apply(this,arguments)},_onEventRemove:function(a,b){this.onEventRemove.apply(this,arguments)},bindEventStore:function(a,b){!b&&this.eventStore&&(a!==this.eventStore&&this.eventStore.autoDestroy?
this.eventStore.destroy():this.mun(this.eventStore,{scope:this,refresh:this.onEventDataRefresh,add:this._onEventAdd,remove:this._onEventRemove,update:this._onEventUpdate,clear:this.refresh}),a||(this.loadMask&&this.loadMask.bindStore&&this.loadMask.bindStore(null),this.eventStore=null));a&&(a=Ext.data.StoreManager.lookup(a),this.mon(a,{scope:this,refresh:this.onEventDataRefresh,add:this._onEventAdd,remove:this._onEventRemove,update:this._onEventUpdate,clear:this.refresh}),this.loadMask&&this.loadMask.bindStore&&
this.loadMask.bindStore(a));(this.eventStore=a)&&!b&&this.refresh()},onEventDataRefresh:function(){this.refreshKeepingScroll()},afterHeaderResized:function(){var a=this.headerCt.resizer;a&&a.dragHd instanceof Sch.column.Resource&&(a=a.dragHd.getWidth(),this.setColumnWidth(a))},onEventSelect:function(a){(a=this.getEventNodeByRecord(a))&&Ext.fly(a).addCls(this.selectedEventCls)},onEventDeselect:function(a){(a=this.getEventNodeByRecord(a))&&Ext.fly(a).removeCls(this.selectedEventCls)}});
Ext.define("Sch.view.SchedulerGridView",{extend:"Sch.view.TimelineGridView",mixins:["Sch.mixin.SchedulerView"],alias:"widget.schedulergridview",alternateClassName:"Sch.HorizontalSchedulerView"},function(){this.override(Sch.mixin.SchedulerView.prototype.inheritables()||{})});
Ext.define("Sch.mixin.TimelinePanel",{requires:"Sch.util.Patch Sch.patches.LoadMask Sch.patches.Model Sch.data.TimeAxis Sch.feature.ColumnLines Sch.view.Locking Sch.mixin.Lockable Sch.preset.Manager".split(" "),orientation:"horizontal",weekStartDay:1,snapToIncrement:!1,readOnly:!1,eventResizeHandles:"both",viewPreset:"weekAndDay",trackHeaderOver:!0,startDate:null,endDate:null,eventBorderWidth:1,syncCellHeight:Ext.emptyFn,tooltipTpl:null,tipCfg:{cls:"sch-tip",showDelay:1E3,hideDelay:0,autoHide:!0,
anchor:"b"},lightWeight:!0,timeCellRenderer:null,timeCellRendererScope:null,inheritables:function(){return{columnLines:!0,enableColumnMove:!1,enableLocking:!0,lockable:!0,lockedXType:null,normalXType:null,initComponent:function(){this.lightWeight=this.lightWeight&&!this.timeCellRenderer;this.addEvents("timeheaderdblclick","beforeviewchange","viewchange");this.timeAxis||(this.timeAxis=Ext.create("Sch.data.TimeAxis"));!this.columns&&!this.colModel&&(this.columns=[]);if(this.enableLocking){this.self.mixin("lockable",
Sch.mixin.Lockable);for(var a=0,b=this.columns.length,c;a<b;++a)c=this.columns[a],!1!==c.locked&&(c.locked=!0);this.timeAxis.on("reconfigure",this.onTimeAxisReconfigure,this);this.switchViewPreset(this.viewPreset,this.startDate,this.endDate,!0)}this.callParent(arguments);if(this.lockable){this.applyViewSettings(this.timeAxis.preset);if(!this.viewPreset)throw"You must define a valid view preset object. See Sch.preset.Manager class for reference";this.lightWeight&&this.columnLines&&(this.columnLinesFeature=
new Sch.feature.ColumnLines,this.columnLinesFeature.init(this))}this.relayEvents(this.getView(),["beforetooltipshow","scheduleclick","scheduledblclick","schedulecontextmenu"])},getState:function(){var a=this.callParent(arguments);Ext.apply(a,{viewPreset:this.viewPreset,startDate:this.getStart(),endDate:this.getEnd()});return a},getOrientation:function(){return this.orientation},applyState:function(a){this.callParent(arguments);a&&a.viewPreset&&this.switchViewPreset(a.viewPreset,a.startDate,a.endDate)},
beforeRender:function(){this.callParent(arguments);this.lockable&&this.addCls("sch-"+this.orientation)},afterRender:function(){this.callParent(arguments);if(this.lockable)this.lockedGrid.on("itemdblclick",function(a,c,d,e,f){"vertical"==this.orientation&&c&&this.fireEvent("timeheaderdblclick",this,c.get("start"),c.get("end"),e,f)},this);else{var a=this.headerCt;a&&(a.reorderer&&a.reorderer.dropZone)&&(a=a.reorderer.dropZone,a.positionIndicator=Ext.Function.createSequence(a.positionIndicator,function(){this.valid=
!1}))}},delayScroll:function(){var a=this.getScrollTarget().el;a&&this.scrollTask.delay(10,function(){a.dom&&this.syncHorizontalScroll(a.dom.scrollLeft)},this)}}},setReadOnly:function(a){this.getSchedulingView().setReadOnly(a)},isReadOnly:function(){return this.getSchedulingView().isReadOnly()},switchViewPreset:function(a,b,c,d){if(!1!==this.fireEvent("beforeviewchange",this,a,b,c)){Ext.isString(a)&&(this.viewPreset=a,a=Sch.preset.Manager.getPreset(a));if(!a)throw"View preset not found";var e=a.headerConfig,
e={unit:e.bottom?e.bottom.unit:e.middle.unit,increment:(e.bottom?e.bottom.increment:e.middle.increment)||1,resolutionUnit:a.timeResolution.unit,resolutionIncrement:a.timeResolution.increment,weekStartDay:this.weekStartDay,mainUnit:e.middle.unit,shiftUnit:a.shiftUnit,headerConfig:a.headerConfig,shiftIncrement:a.shiftIncrement||1,preset:a,defaultSpan:a.defaultSpan||1};e.start=d?b||new Date:b||this.timeAxis.getStart();e.end=c;d||this.applyViewSettings(a);this.timeAxis.reconfigure(e)}},applyViewSettings:function(a){var b=
this.getSchedulingView();b.setDisplayDateFormat(a.displayDateFormat);"horizontal"===this.orientation&&b.setRowHeight(this.rowHeight||a.rowHeight,!0)},getStart:function(){return this.timeAxis.getStart()},getEnd:function(){return this.timeAxis.getEnd()},setTimeColumnWidth:function(a,b){this.getSchedulingView().setColumnWidth(a,b)},onTimeAxisReconfigure:function(){this.fireEvent("viewchange",this);this.stateful&&this.lockedGrid&&this.saveState()},getColumnsState:function(){return this.lockedGrid.headerCt.getColumnsState()},
shiftNext:function(a){this.timeAxis.shiftNext(a)},shiftPrevious:function(a){this.timeAxis.shiftPrevious(a)},goToNow:function(){this.setTimeSpan(new Date)},setTimeSpan:function(a,b){this.timeAxis&&this.timeAxis.setTimeSpan(a,b)},setStart:function(a){this.setTimeSpan(a)},setEnd:function(a){this.setTimeSpan(null,a)},getTimeAxis:function(){return this.timeAxis},getResourceByEventRecord:function(a){return a.getResource()},scrollToDate:function(a,b){var c=this.getSchedulingView(),d=c.getXYFromDate(a,!0);
"horizontal"==this.orientation?c.getEl().scrollTo("left",Math.max(0,d[0]),b):c.getEl().scrollTo("top",Math.max(0,d[1]),b)},getSchedulingView:function(){return this.lockable?this.normalGrid.getView():this.getView()},setOrientation:function(a){this.removeCls("sch-"+this.orientation);this.addCls("sch-"+a);this.orientation=a}});
Ext.define("Sch.mixin.SchedulerPanel",{requires:"Sch.view.SchedulerGridView Sch.model.Event Sch.model.Resource Sch.data.EventStore Sch.data.ResourceStore Sch.selection.EventModel Sch.plugin.ResourceZones Sch.util.Date Sch.column.timeAxis.Vertical".split(" "),resourceColumnWidth:null,eventBarIconClsField:"",eventSelModelType:"eventmodel",eventSelModel:null,enableEventDragDrop:!0,enableDragCreation:!0,dragConfig:null,dropConfig:null,eventBarTextField:null,allowOverlap:!0,startParamName:"startDate",
endParamName:"endDate",passStartEndParameters:!1,eventRenderer:null,eventRendererScope:null,eventStore:null,resourceStore:null,eventTpl:null,eventBodyTemplate:null,resourceZones:null,componentCls:"sch-schedulerpanel",lockedGridDependsOnSchedule:!1,initStores:function(){var a=this.resourceStore;a||Ext.Error.raise("You must specify a resourceStore config");this.eventStore||Ext.Error.raise("You must specify an eventStore config");this.eventStore=Ext.StoreManager.lookup(this.eventStore);this.resourceStore=
Ext.StoreManager.lookup(a);this.eventStore instanceof Sch.data.EventStore||Ext.Error.raise("Your eventStore should be a Sch.data.EventStore (or inherit from it)");Ext.applyIf(this,{store:a,resourceStore:a});this.resourceStore.eventStore=this.eventStore;this.eventStore.setResourceStore(this.resourceStore);if(this.lockable&&(this.resourceZones&&(this.plugins=this.plugins||[],a=Ext.StoreManager.lookup(this.resourceZones),a.setResourceStore(this.resourceStore),this.resourceZonesPlug=Ext.create("Sch.plugin.ResourceZones",
{store:a}),this.plugins.push(this.resourceZonesPlug)),this.passStartEndParameters))this.eventStore.on("beforeload",this.applyStartEndParameters,this)},inheritables:function(){return{initComponent:function(){this.initStores();this.eventBodyTemplate&&Ext.isString(this.eventBodyTemplate)&&(this.eventBodyTemplate=Ext.create("Ext.XTemplate",this.eventBodyTemplate));this.callParent(arguments);this.relayEvents(this.getView(),"eventclick eventdblclick eventcontextmenu eventmouseenter eventmouseleave beforeeventresize eventresizestart eventpartialresize eventresizeend beforeeventdrag eventdragstart eventdrop aftereventdrop beforedragcreate dragcreatestart dragcreateend afterdragcreate beforeeventadd".split(" "));
this.addEvents("orientationchange")},setOrientation:function(a,b){if(a!==this.orientation||b){this.callParent(arguments);var c=this.normalGrid,d=this.lockedGrid,e=this.getSchedulingView(),f=c.headerCt;e.setOrientation(a);f.suspendLayouts();f.items.each(function(a){f.remove(a)});f.resumeLayouts();"horizontal"===a?(this.mun(this.resourceStore,{clear:this.refreshResourceColumns,datachanged:this.refreshResourceColumns,load:this.refreshResourceColumns,scope:this}),e.suspendEvents(),e.setRowHeight(this.rowHeight||
this.timeAxis.preset.rowHeight,!0),e.suppressFitCheck++,this.reconfigureLockable(this.resourceStore,this.columns),e.suppressFitCheck--,e.resumeEvents(),e.setColumnWidth(this.timeAxis.preset.timeColumnWidth||60,!0),e.checkHorizontalFit(),e.getTimeAxisColumn().on({timeaxiscolumnreconfigured:e.checkHorizontalFit,scope:e})):(e.setRowHeight(this.timeAxis.preset.timeColumnWidth||60,!0),e.setColumnWidth(this.timeAxis.preset.resourceColumnWidth||100,!0),this.mon(this.resourceStore,{clear:this.refreshResourceColumns,
datachanged:this.refreshResourceColumns,load:this.refreshResourceColumns,scope:this}),e=this.processColumns(this.columns),this.reconfigureLockable(this.timeAxis.tickStore,e.locked.items),c.reconfigure(this.timeAxis.tickStore,this.createResourceColumns()));c.view.refresh();d.view.refresh();this.fireEvent("orientationchange",this,a)}},applyViewSettings:function(a){this.callParent(arguments);var b=this.getSchedulingView(),c;"horizontal"===this.orientation?c=this.rowHeight=this.rowHeight||a.rowHeight:
(c=this.timeColumnWidth=this.timeColumnWidth||a.timeColumnWidth||60,b.setColumnWidth(a.resourceColumnWidth||100,!0));b.setRowHeight(c,!0)},afterRender:function(){this.callParent(arguments);if(this.lockable&&this.lockedGridDependsOnSchedule){if(!this.syncRowHeight)this.normalGrid.getView().on("refresh",this.onNormalViewRefresh,this);this.normalGrid.getView().on("itemupdate",this.onNormalViewItemUpdate,this)}}}},getResourceStore:function(){return this.resourceStore},getEventStore:function(){return this.eventStore},
getEventSelectionModel:function(){if(this.eventSelModel&&this.eventSelModel.events)return this.eventSelModel;this.eventSelModel||(this.eventSelModel={});var a=this.eventSelModel,b="SINGLE";this.simpleSelect?b="SIMPLE":this.multiSelect&&(b="MULTI");Ext.applyIf(a,{allowDeselect:this.allowDeselect,mode:b});a.events||(a=this.eventSelModel=Ext.create("selection."+this.eventSelModelType,a));a.hasRelaySetup||(this.relayEvents(a,["selectionchange","deselect","select"]),a.hasRelaySetup=!0);this.disableSelection&&
(a.locked=!0);return a},applyStartEndParameters:function(a,b){b.params=b.params||{};b.params[this.startParamName]=this.getStart();b.params[this.endParamName]=this.getEnd()},refreshResourceColumns:function(){var a=this.normalGrid.headerCt;0<a.getColumnCount()&&a.removeAll();a.add(this.createResourceColumns());this.getView().refresh()},createResourceColumns:function(){var a=[],b=this.getSchedulingView(),c=this;this.resourceStore.each(function(d){a.push(Ext.create("Sch.column.Resource",{tdCls:b.timeCellCls,
renderer:b.timeColumnRenderer,scope:b,width:c.resourceColumnWidth||c.timeAxis.preset.resourceColumnWidth||100,text:d.getName()}))});return a}});Ext.define("Sch.view.TimelineTreeView",{extend:"Ext.tree.View",mixins:["Sch.mixin.TimelineView"],requires:["Sch.patches.TreeView"],cellBorderWidth:0,beforeRender:function(){this.addCls("sch-timelinetreeview");this.callParent(arguments)}},function(){this.override(Sch.mixin.TimelineView.prototype.inheritables()||{})});
Ext.define("Sch.view.SchedulerTreeView",{extend:"Sch.view.TimelineTreeView",alias:"widget.schedulertreeview",mixins:["Sch.mixin.SchedulerView"]},function(){this.override(Sch.mixin.SchedulerView.prototype.inheritables()||{})});Ext.define("Sch.panel.TimelineGridPanel",{extend:"Ext.grid.Panel",mixins:["Sch.mixin.TimelinePanel"]},function(){this.override(Sch.mixin.TimelinePanel.prototype.inheritables()||{})});
Ext.define("Sch.panel.TimelineTreePanel",{extend:"Ext.tree.Panel",requires:["Ext.data.TreeStore"],mixins:["Sch.mixin.TimelinePanel"],useArrows:!0,rootVisible:!1,constructor:function(a){a=a||{};a.animate=!1;this.callParent(arguments)},initComponent:function(){this.callParent(arguments);this.lockable&&0===this.lockedGrid.headerCt.query("treecolumn").length&&Ext.Error.raise("You must define an Ext.tree.Column (or use xtype : 'treecolumn').")},onRootChange:function(a){this.lockable||this.callParent(arguments)}},
function(){this.override(Sch.mixin.TimelinePanel.prototype.inheritables()||{})});
Ext.define("Sch.panel.SchedulerGrid",{extend:"Sch.panel.TimelineGridPanel",mixins:["Sch.mixin.SchedulerPanel"],alias:["widget.schedulergrid","widget.schedulerpanel"],alternateClassName:"Sch.SchedulerPanel",viewType:"schedulergridview",lockedXType:"gridpanel",normalXType:"schedulergrid",onRender:function(){this.callParent(arguments);this.lockable&&"vertical"===this.orientation&&this.refreshResourceColumns(!0)}},function(){this.override(Sch.mixin.SchedulerPanel.prototype.inheritables()||{})});
Ext.define("Sch.panel.SchedulerTree",{extend:"Sch.panel.TimelineTreePanel",mixins:["Sch.mixin.SchedulerPanel"],alias:["widget.schedulertree"],requires:["Sch.view.SchedulerTreeView"],lockedXType:"treepanel",normalXType:"schedulertree",viewType:"schedulertreeview",setOrientation:function(a){"vertical"==a&&Ext.Error.raise("Sch.panel.SchedulerTree does not support vertical orientation")},initComponent:function(){this.callParent(arguments);!this.lockable&&this.resourceStore instanceof Ext.data.TreeStore&&
(this.getView().store.eventStore=this.eventStore)}},function(){this.override(Sch.mixin.SchedulerPanel.prototype.inheritables()||{})});

//# sourceMappingURL=/javascript/1568710058000/sfdc/source/ExtUX_Ext4.js.map
